<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ETAPA 1 - Análise Descritiva da Exposição de IA Generativa com ILO Index e PNADc</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/clipboard/clipboard.min.js"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/popper.min.js"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/anchor.min.js"></script>
<link href="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="etapa_1a_preparacao_dados_ilo_pnadc_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preparação-dos-dados" id="toc-preparação-dos-dados" class="nav-link active" data-scroll-target="#preparação-dos-dados"><span class="header-section-number">1</span> PREPARAÇÃO DOS DADOS</a>
  <ul class="collapse">
  <li><a href="#contextualização" id="toc-contextualização" class="nav-link" data-scroll-target="#contextualização"><span class="header-section-number">1.1</span> Contextualização</a></li>
  <li><a href="#objetivo" id="toc-objetivo" class="nav-link" data-scroll-target="#objetivo"><span class="header-section-number">1.2</span> Objetivo</a></li>
  <li><a href="#referências-principais" id="toc-referências-principais" class="nav-link" data-scroll-target="#referências-principais"><span class="header-section-number">1.3</span> Referências principais</a></li>
  <li><a href="#configuração-do-ambiente" id="toc-configuração-do-ambiente" class="nav-link" data-scroll-target="#configuração-do-ambiente"><span class="header-section-number">1.4</span> 1. Configuração do ambiente</a></li>
  <li><a href="#a.-download-dos-microdados-pnad" id="toc-a.-download-dos-microdados-pnad" class="nav-link" data-scroll-target="#a.-download-dos-microdados-pnad"><span class="header-section-number">1.5</span> 2a. Download dos microdados PNAD</a></li>
  <li><a href="#b.-verificar-dados-microdados-pnad-checkpoint" id="toc-b.-verificar-dados-microdados-pnad-checkpoint" class="nav-link" data-scroll-target="#b.-verificar-dados-microdados-pnad-checkpoint"><span class="header-section-number">1.6</span> 2b. Verificar dados microdados PNAD (CHECKPOINT)</a></li>
  <li><a href="#a.-processar-índice-de-exposição-ilo" id="toc-a.-processar-índice-de-exposição-ilo" class="nav-link" data-scroll-target="#a.-processar-índice-de-exposição-ilo"><span class="header-section-number">1.7</span> 3a. Processar índice de exposição ILO</a></li>
  <li><a href="#b.-verificar-índice-de-exposição-ilo" id="toc-b.-verificar-índice-de-exposição-ilo" class="nav-link" data-scroll-target="#b.-verificar-índice-de-exposição-ilo"><span class="header-section-number">1.8</span> 3b. Verificar índice de exposição ILO</a></li>
  <li><a href="#notas-sobre-terminologia" id="toc-notas-sobre-terminologia" class="nav-link" data-scroll-target="#notas-sobre-terminologia"><span class="header-section-number">1.9</span> Notas sobre terminologia</a></li>
  <li><a href="#a.-limpeza-e-variáveis-derivadas-pnad" id="toc-a.-limpeza-e-variáveis-derivadas-pnad" class="nav-link" data-scroll-target="#a.-limpeza-e-variáveis-derivadas-pnad"><span class="header-section-number">1.10</span> 4a. Limpeza e variáveis derivadas – PNAD</a></li>
  <li><a href="#b.-verificar-limpeza-e-variáveis-derivadas-pnad" id="toc-b.-verificar-limpeza-e-variáveis-derivadas-pnad" class="nav-link" data-scroll-target="#b.-verificar-limpeza-e-variáveis-derivadas-pnad"><span class="header-section-number">1.11</span> 4b. Verificar Limpeza e variáveis derivadas – PNAD</a></li>
  <li><a href="#a.-crosswalk-cod-isco-08" id="toc-a.-crosswalk-cod-isco-08" class="nav-link" data-scroll-target="#a.-crosswalk-cod-isco-08"><span class="header-section-number">1.12</span> 5a. Crosswalk COD → ISCO-08</a></li>
  <li><a href="#a.-verificar-crosswalk-cod-isco-08" id="toc-a.-verificar-crosswalk-cod-isco-08" class="nav-link" data-scroll-target="#a.-verificar-crosswalk-cod-isco-08"><span class="header-section-number">1.13</span> 5a. Verificar Crosswalk COD → ISCO-08</a></li>
  <li><a href="#merge-final-pnad-índice-ilo" id="toc-merge-final-pnad-índice-ilo" class="nav-link" data-scroll-target="#merge-final-pnad-índice-ilo"><span class="header-section-number">1.14</span> 6. Merge final – PNAD + índice ILO</a></li>
  <li><a href="#limitações-desta-etapa" id="toc-limitações-desta-etapa" class="nav-link" data-scroll-target="#limitações-desta-etapa"><span class="header-section-number">1.15</span> Limitações desta etapa</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="etapa_1a_preparacao_dados_ilo_pnadc.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ETAPA 1 - Análise Descritiva da Exposição de IA Generativa com ILO Index e PNADc</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="preparação-dos-dados" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="preparação-dos-dados"><span class="header-section-number">1</span> PREPARAÇÃO DOS DADOS</h2>
<p><strong>Dissertação:</strong> Inteligência Artificial Generativa e o Mercado de Trabalho Brasileiro: Uma Análise de Exposição Ocupacional e seus Efeitos Distributivos.</p>
<p><strong>Aluno:</strong> Manoel Brasil Orlandi</p>
<section id="contextualização" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="contextualização"><span class="header-section-number">1.1</span> Contextualização</h3>
<p>A rápida difusão de modelos de IA generativa (LLMs, geradores de imagem/código) levanta questões centrais sobre seus impactos no mercado de trabalho. Para mensurar esse potencial de impacto, a Organização Internacional do Trabalho (OIT) criou índice de exposição ocupacional à IA generativa, publicado como <em>Working Paper</em> 140 (WP140). O índice atribui scores de exposição a cada ocupação da classificação ISCO-08, com base na avaliação de suas tarefas constituintes por modelos de linguagem e validação humana.</p>
<p>Este notebook prepara uma base de dados que junta os microdados da <strong>PNAD Contínua</strong> (Pesquisa Nacional por Amostra de Domicílios Contínua, IBGE, 3º trimestre de 2025) ao <strong>índice de exposição à IA generativa da OIT</strong>, para depois ser aplicada para caracterizar a exposição do mercado de trabalho brasileiro a essa tecnologia.</p>
</section>
<section id="objetivo" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="objetivo"><span class="header-section-number">1.2</span> Objetivo</h3>
<p>Construir a base analítica que une PNAD Contínua e o índice de exposição à IA (ILO), com ocupações em COD e ISCO-08.</p>
<p><strong>Entradas:</strong> Microdados PNAD (BigQuery), planilha ILO (Gmyrek et al., 2025), estrutura COD.<br>
<strong>Saída principal:</strong> <code>data/output/pnad_ilo_merged.csv</code></p>
</section>
<section id="referências-principais" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="referências-principais"><span class="header-section-number">1.3</span> Referências principais</h3>
<ul>
<li>Gmyrek, P., Berg, J. &amp; Cappelli, D. (2025). <em>Generative AI and Jobs: An updated global assessment of potential effects on job quantity and quality</em>. ILO Working Paper 140.</li>
<li>IBGE. <em>Pesquisa Nacional por Amostra de Domicílios Contínua</em> (PNADc), 3º trimestre de 2025.</li>
</ul>
</section>
<section id="configuração-do-ambiente" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="configuração-do-ambiente"><span class="header-section-number">1.4</span> 1. Configuração do ambiente</h3>
<p>Definir caminhos, importar bibliotecas e configurar logs.</p>
<div id="8bseat3wbbf" class="cell" data-execution_count="50">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar dependências no kernel atual (executar apenas uma vez)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install pandas numpy pyarrow openpyxl basedosdados <span class="op">--</span>quiet</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> A new release of pip is available: <span class="ansi-red-fg">24.2</span> -&gt; <span class="ansi-green-fg">26.0.1</span>

<span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> To update, run: <span class="ansi-green-fg">python3.10 -m pip install --upgrade pip</span>

Note: you may need to restart the kernel to use updated packages.
</pre>
</div>
</div>
</div>
<div id="80796a93" class="cell" data-execution_count="51">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.1 - Preparação de Dados - Configuração do ambiente</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Caminhos (relativos ao diretório do notebook)</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>DATA_INPUT     <span class="op">=</span> Path(<span class="st">"data/input"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>DATA_RAW       <span class="op">=</span> Path(<span class="st">"data/raw"</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>DATA_PROCESSED <span class="op">=</span> Path(<span class="st">"data/processed"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>DATA_OUTPUT    <span class="op">=</span> Path(<span class="st">"data/output"</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> [DATA_RAW, DATA_PROCESSED, DATA_OUTPUT]:</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    d.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Parâmetros PNAD / GCP</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>GCP_PROJECT_ID  <span class="op">=</span> <span class="st">"mestrado-pnad-2026"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>PNAD_ANO        <span class="op">=</span> <span class="dv">2025</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>PNAD_TRIMESTRE  <span class="op">=</span> <span class="dv">3</span>  </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>SALARIO_MINIMO  <span class="op">=</span> <span class="dv">1518</span>  <span class="co"># Valor vigente em Q3/2025 (R$)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Arquivo ILO (já copiado para data/input)</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>ILO_FILE <span class="op">=</span> DATA_INPUT <span class="op">/</span> <span class="st">"Final_Scores_ISCO08_Gmyrek_et_al_2025.xlsx"</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapeamentos</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>REGIAO_MAP <span class="op">=</span> {</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RO'</span>: <span class="st">'Norte'</span>, <span class="st">'AC'</span>: <span class="st">'Norte'</span>, <span class="st">'AM'</span>: <span class="st">'Norte'</span>, <span class="st">'RR'</span>: <span class="st">'Norte'</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PA'</span>: <span class="st">'Norte'</span>, <span class="st">'AP'</span>: <span class="st">'Norte'</span>, <span class="st">'TO'</span>: <span class="st">'Norte'</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MA'</span>: <span class="st">'Nordeste'</span>, <span class="st">'PI'</span>: <span class="st">'Nordeste'</span>, <span class="st">'CE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'RN'</span>: <span class="st">'Nordeste'</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PB'</span>: <span class="st">'Nordeste'</span>, <span class="st">'PE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'AL'</span>: <span class="st">'Nordeste'</span>, <span class="st">'SE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'BA'</span>: <span class="st">'Nordeste'</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MG'</span>: <span class="st">'Sudeste'</span>, <span class="st">'ES'</span>: <span class="st">'Sudeste'</span>, <span class="st">'RJ'</span>: <span class="st">'Sudeste'</span>, <span class="st">'SP'</span>: <span class="st">'Sudeste'</span>,</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PR'</span>: <span class="st">'Sul'</span>, <span class="st">'SC'</span>: <span class="st">'Sul'</span>, <span class="st">'RS'</span>: <span class="st">'Sul'</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MS'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'MT'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'GO'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'DF'</span>: <span class="st">'Centro-Oeste'</span>,</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>GRANDES_GRUPOS <span class="op">=</span> {</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1'</span>: <span class="st">'Dirigentes e gerentes'</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2'</span>: <span class="st">'Profissionais das ciências'</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3'</span>: <span class="st">'Técnicos nível médio'</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4'</span>: <span class="st">'Apoio administrativo'</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5'</span>: <span class="st">'Serviços e vendedores'</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6'</span>: <span class="st">'Agropecuária qualificada'</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7'</span>: <span class="st">'Indústria qualificada'</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8'</span>: <span class="st">'Operadores de máquinas'</span>,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9'</span>: <span class="st">'Ocupações elementares'</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>RACA_AGREGADA_MAP <span class="op">=</span> {</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1'</span>: <span class="st">'Branca'</span>,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2'</span>: <span class="st">'Negra'</span>,   <span class="co"># Preta</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4'</span>: <span class="st">'Negra'</span>,   <span class="co"># Parda</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3'</span>: <span class="st">'Outras'</span>,  <span class="co"># Amarela</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5'</span>: <span class="st">'Outras'</span>,  <span class="co"># Indígena</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9'</span>: <span class="st">'Outras'</span>,  <span class="co"># Sem declaração</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>POSICAO_FORMAL <span class="op">=</span> [<span class="st">'1'</span>, <span class="st">'3'</span>, <span class="st">'5'</span>]  <span class="co"># Empregado c/ carteira, Militar, Empregador</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>IDADE_BINS   <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">25</span>, <span class="dv">35</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">100</span>]</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>IDADE_LABELS <span class="op">=</span> [<span class="st">'18-24'</span>, <span class="st">'25-34'</span>, <span class="st">'35-44'</span>, <span class="st">'45-54'</span>, <span class="st">'55+'</span>]</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapeamento CNAE Domiciliar 2.0 → Setor agregado</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Seções A-T conforme classificação oficial IBGE.</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Fonte: IBGE, Classificação Nacional de Atividades Econômicas (CNAE 2.0)</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>CNAE_SETOR_MAP <span class="op">=</span> {</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A - Agropecuária</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">'01'</span>: <span class="st">'Agropecuária'</span>, <span class="st">'02'</span>: <span class="st">'Agropecuária'</span>, <span class="st">'03'</span>: <span class="st">'Agropecuária'</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># B - Indústria Extrativa</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">'05'</span>: <span class="st">'Ind. Extrativa'</span>, <span class="st">'06'</span>: <span class="st">'Ind. Extrativa'</span>, <span class="st">'07'</span>: <span class="st">'Ind. Extrativa'</span>,</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'08'</span>: <span class="st">'Ind. Extrativa'</span>, <span class="st">'09'</span>: <span class="st">'Ind. Extrativa'</span>,</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># C - Indústria de Transformação</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">'10'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'11'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'12'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">'13'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'14'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'15'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">'16'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'17'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'18'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">'19'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'20'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'21'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">'22'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'23'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'24'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'25'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'26'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'27'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="st">'28'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'29'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'30'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    <span class="st">'31'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'32'</span>: <span class="st">'Ind. Transformação'</span>, <span class="st">'33'</span>: <span class="st">'Ind. Transformação'</span>,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># D+E - Utilidades (Eletricidade, Gás, Água, Esgoto, Resíduos)</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'35'</span>: <span class="st">'Utilidades'</span>, <span class="st">'36'</span>: <span class="st">'Utilidades'</span>, <span class="st">'37'</span>: <span class="st">'Utilidades'</span>,</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'38'</span>: <span class="st">'Utilidades'</span>, <span class="st">'39'</span>: <span class="st">'Utilidades'</span>,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="co"># F - Construção</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">'41'</span>: <span class="st">'Construção'</span>, <span class="st">'42'</span>: <span class="st">'Construção'</span>, <span class="st">'43'</span>: <span class="st">'Construção'</span>,</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="co"># G - Comércio</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">'45'</span>: <span class="st">'Comércio'</span>, <span class="st">'46'</span>: <span class="st">'Comércio'</span>, <span class="st">'47'</span>: <span class="st">'Comércio'</span>,</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>    <span class="co"># H - Transporte, Armazenagem e Correio</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">'49'</span>: <span class="st">'Transporte'</span>, <span class="st">'50'</span>: <span class="st">'Transporte'</span>, <span class="st">'51'</span>: <span class="st">'Transporte'</span>,</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">'52'</span>: <span class="st">'Transporte'</span>, <span class="st">'53'</span>: <span class="st">'Transporte'</span>,</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># I - Alojamento e Alimentação</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    <span class="st">'55'</span>: <span class="st">'Alojamento e Alimentação'</span>, <span class="st">'56'</span>: <span class="st">'Alojamento e Alimentação'</span>,</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># J - Informação e Comunicação</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    <span class="st">'58'</span>: <span class="st">'Informação e Comunicação'</span>, <span class="st">'59'</span>: <span class="st">'Informação e Comunicação'</span>,</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="st">'60'</span>: <span class="st">'Informação e Comunicação'</span>, <span class="st">'61'</span>: <span class="st">'Informação e Comunicação'</span>,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">'62'</span>: <span class="st">'Informação e Comunicação'</span>, <span class="st">'63'</span>: <span class="st">'Informação e Comunicação'</span>,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># K - Atividades Financeiras</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    <span class="st">'64'</span>: <span class="st">'Finanças e Seguros'</span>, <span class="st">'65'</span>: <span class="st">'Finanças e Seguros'</span>, <span class="st">'66'</span>: <span class="st">'Finanças e Seguros'</span>,</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># L - Atividades Imobiliárias</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="st">'68'</span>: <span class="st">'Atividades Imobiliárias'</span>,</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># M - Atividades Profissionais, Científicas e Técnicas</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    <span class="st">'69'</span>: <span class="st">'Serviços Profissionais'</span>, <span class="st">'70'</span>: <span class="st">'Serviços Profissionais'</span>,</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="st">'71'</span>: <span class="st">'Serviços Profissionais'</span>, <span class="st">'72'</span>: <span class="st">'Serviços Profissionais'</span>,</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>    <span class="st">'73'</span>: <span class="st">'Serviços Profissionais'</span>, <span class="st">'74'</span>: <span class="st">'Serviços Profissionais'</span>,</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="st">'75'</span>: <span class="st">'Serviços Profissionais'</span>,</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    <span class="co"># N - Atividades Administrativas e Serviços Complementares</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="st">'77'</span>: <span class="st">'Serviços Administrativos'</span>, <span class="st">'78'</span>: <span class="st">'Serviços Administrativos'</span>,</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    <span class="st">'79'</span>: <span class="st">'Serviços Administrativos'</span>, <span class="st">'80'</span>: <span class="st">'Serviços Administrativos'</span>,</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    <span class="st">'81'</span>: <span class="st">'Serviços Administrativos'</span>, <span class="st">'82'</span>: <span class="st">'Serviços Administrativos'</span>,</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># O - Administração Pública</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="st">'84'</span>: <span class="st">'Administração Pública'</span>,</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>    <span class="co"># P - Educação</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>    <span class="st">'85'</span>: <span class="st">'Educação'</span>,</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Q - Saúde Humana e Serviços Sociais</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    <span class="st">'86'</span>: <span class="st">'Saúde'</span>, <span class="st">'87'</span>: <span class="st">'Saúde'</span>, <span class="st">'88'</span>: <span class="st">'Saúde'</span>,</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="co"># R - Artes, Cultura, Esporte e Recreação</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    <span class="st">'90'</span>: <span class="st">'Artes e Cultura'</span>, <span class="st">'91'</span>: <span class="st">'Artes e Cultura'</span>,</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    <span class="st">'92'</span>: <span class="st">'Artes e Cultura'</span>, <span class="st">'93'</span>: <span class="st">'Artes e Cultura'</span>,</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># S - Outras Atividades de Serviços</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="st">'94'</span>: <span class="st">'Outros Serviços'</span>, <span class="st">'95'</span>: <span class="st">'Outros Serviços'</span>, <span class="st">'96'</span>: <span class="st">'Outros Serviços'</span>,</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    <span class="co"># T - Serviços Domésticos</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="st">'97'</span>: <span class="st">'Serviços Domésticos'</span>,</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Setores com maior proporção de tarefas expostas à IA generativa</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: Gmyrek et al. (2024); Eloundou et al. (2023)</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>SETORES_CRITICOS_IA <span class="op">=</span> [</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Informação e Comunicação'</span>,</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Finanças e Seguros'</span>,</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Serviços Profissionais'</span>,</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="co"># Funções utilitárias – estatísticas ponderadas</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_mean(values, weights):</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Média ponderada (ignora NaN)."""</span></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.average(values[mask], weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_std(values, weights):</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Desvio-padrão ponderado (ignora NaN)."""</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> np.average(values[mask], weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    variance <span class="op">=</span> np.average((values[mask] <span class="op">-</span> avg) <span class="op">**</span> <span class="dv">2</span>, weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(variance)</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_quantile(values, weights, quantile):</span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Quantil ponderado por pesos amostrais (ignora NaN).</span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a><span class="co">    Fonte: adaptado de etapa1_ia_generativa/src/utils/weighted_stats.py</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    sorted_idx <span class="op">=</span> np.argsort(values[mask])</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>    sorted_values <span class="op">=</span> values[mask].iloc[sorted_idx]</span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    sorted_weights <span class="op">=</span> weights[mask].iloc[sorted_idx]</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    cumsum <span class="op">=</span> np.cumsum(sorted_weights)</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    cutoff <span class="op">=</span> quantile <span class="op">*</span> cumsum.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sorted_values.iloc[np.searchsorted(cumsum, cutoff)]</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_qcut(values, weights, q, labels<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Classificação em quantis ponderados por peso amostral.</span></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="co">    Diferente de pd.qcut (que divide por contagem de linhas), esta função</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="co">    calcula os breakpoints de modo que cada faixa represente ~1/q da</span></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="co">    POPULAÇÃO (soma dos pesos), não da amostra.</span></span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a><span class="co">    Parâmetros:</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a><span class="co">        values  : pd.Series com os valores a classificar</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a><span class="co">        weights : pd.Series com os pesos amostrais</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a><span class="co">        q       : int, número de quantis (5 = quintis, 10 = decis)</span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a><span class="co">        labels  : lista de labels (len == q), ou None para retornar inteiros 1..q</span></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="co">    Retorna:</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="co">        pd.Series (Categorical) com os labels atribuídos</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> values.notna() <span class="op">&amp;</span> weights.notna()</span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    breakpoints <span class="op">=</span> [values[mask].<span class="bu">min</span>() <span class="op">-</span> <span class="fl">1e-10</span>]  <span class="co"># incluir mínimo</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, q):</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>        bp <span class="op">=</span> weighted_quantile(values[mask], weights[mask], i <span class="op">/</span> q)</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>        breakpoints.append(bp)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>    breakpoints.append(values[mask].<span class="bu">max</span>() <span class="op">+</span> <span class="fl">1e-10</span>)  <span class="co"># incluir máximo</span></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remover duplicatas mantendo ordem (pode acontecer com valores concentrados)</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>    breakpoints <span class="op">=</span> <span class="bu">sorted</span>(<span class="bu">set</span>(breakpoints))</span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> labels <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> <span class="bu">len</span>(labels) <span class="op">!=</span> <span class="bu">len</span>(breakpoints) <span class="op">-</span> <span class="dv">1</span>:</span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>        labels <span class="op">=</span> <span class="va">None</span>  <span class="co"># fallback se breakpoints colapsaram</span></span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> pd.cut(values, bins<span class="op">=</span>breakpoints, labels<span class="op">=</span>labels, include_lowest<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Configuração carregada com sucesso."</span>)</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  PNAD: </span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Projeto GCP: </span><span class="sc">{</span>GCP_PROJECT_ID<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Salário mínimo: R$ </span><span class="sc">{</span>SALARIO_MINIMO<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  ILO file: </span><span class="sc">{</span>ILO_FILE<span class="sc">}</span><span class="ss"> (existe: </span><span class="sc">{</span>ILO_FILE<span class="sc">.</span>exists()<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Setores CNAE mapeados: </span><span class="sc">{</span><span class="bu">len</span>(<span class="bu">set</span>(CNAE_SETOR_MAP.values()))<span class="sc">}</span><span class="ss"> categorias"</span>)</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Setores críticos IA: </span><span class="sc">{</span>SETORES_CRITICOS_IA<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Configuração carregada com sucesso.
  PNAD: 2025 Q3
  Projeto GCP: mestrado-pnad-2026
  Salário mínimo: R$ 1518
  ILO file: data/input/Final_Scores_ISCO08_Gmyrek_et_al_2025.xlsx (existe: True)
  Setores CNAE mapeados: 19 categorias
  Setores críticos IA: ['Informação e Comunicação', 'Finanças e Seguros', 'Serviços Profissionais']</code></pre>
</div>
</div>
</section>
<section id="a.-download-dos-microdados-pnad" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="a.-download-dos-microdados-pnad"><span class="header-section-number">1.5</span> 2a. Download dos microdados PNAD</h3>
<p>Extrair da PNAD Contínua (BigQuery) as variáveis necessárias para o trimestre/ano definido. <strong>Saída:</strong> <code>data/raw/pnad_*.parquet</code></p>
<section id="ficha-técnica-dos-dados" class="level4" data-number="1.5.1">
<h4 data-number="1.5.1" class="anchored" data-anchor-id="ficha-técnica-dos-dados"><span class="header-section-number">1.5.1</span> Ficha técnica dos dados</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 35%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th>Item</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Fonte</strong></td>
<td>PNAD Contínua (PNADc), IBGE</td>
</tr>
<tr class="even">
<td><strong>Período</strong></td>
<td>3º trimestre de 2025</td>
</tr>
<tr class="odd">
<td><strong>Acesso</strong></td>
<td>Base dos Dados (BigQuery)</td>
</tr>
<tr class="even">
<td><strong>Peso amostral</strong></td>
<td>V1028 (projeção de população para dados trimestrais)</td>
</tr>
<tr class="odd">
<td><strong>Universo</strong></td>
<td>População ocupada com código de ocupação válido</td>
</tr>
</tbody>
</table>
</section>
<section id="variáveis-selecionadas" class="level4" data-number="1.5.2">
<h4 data-number="1.5.2" class="anchored" data-anchor-id="variáveis-selecionadas"><span class="header-section-number">1.5.2</span> Variáveis selecionadas</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 39%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Variável IBGE</th>
<th>Nome no dataset</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>V2007</td>
<td><code>sexo</code></td>
<td>Sexo biológico</td>
</tr>
<tr class="even">
<td>V2009</td>
<td><code>idade</code></td>
<td>Idade em anos</td>
</tr>
<tr class="odd">
<td>V2010</td>
<td><code>raca_cor</code></td>
<td>Cor ou raça (autoclassificação)</td>
</tr>
<tr class="even">
<td>VD3004</td>
<td><code>nivel_instrucao</code></td>
<td>Nível de instrução mais elevado alcançado</td>
</tr>
<tr class="odd">
<td>V4010</td>
<td><code>cod_ocupacao</code></td>
<td>Código de ocupação (COD, 4 dígitos)</td>
</tr>
<tr class="even">
<td>V4013</td>
<td><code>grupamento_atividade</code></td>
<td>Grupamento de atividade (CNAE Domiciliar 2.0)</td>
</tr>
<tr class="odd">
<td>VD4009</td>
<td><code>posicao_ocupacao</code></td>
<td>Posição na ocupação</td>
</tr>
<tr class="even">
<td>VD4016</td>
<td><code>rendimento_habitual</code></td>
<td>Rendimento mensal habitual do trabalho principal</td>
</tr>
<tr class="odd">
<td>VD4020</td>
<td><code>rendimento_efetivo</code></td>
<td>Rendimento mensal efetivo do trabalho principal</td>
</tr>
<tr class="even">
<td>VD4031</td>
<td><code>horas_habituais</code></td>
<td>Horas habitualmente trabalhadas (todos os trabalhos)</td>
</tr>
<tr class="odd">
<td>VD4035</td>
<td><code>horas_efetivas</code></td>
<td>Horas efetivamente trabalhadas na semana de referência</td>
</tr>
<tr class="even">
<td>V1028</td>
<td><code>peso</code></td>
<td>Peso amostral (projeção de população)</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Variáveis de renda:</strong> O rendimento mensal habitual (<code>VD4016</code>) é a variável primária para análises estruturais de exposição ocupacional, por ser menos volátil que o rendimento efetivo (<code>VD4020</code>), que captura flutuações mensais por horas extras, bônus, etc. (Cf. IBGE, Notas Metodológicas PNAD Contínua, 2023). Ambas são mantidas na base.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Horas trabalhadas:</strong> Utiliza-se <code>VD4031</code> (horas habitualmente trabalhadas em todos os trabalhos, variável derivada IBGE) como variável principal de jornada, por ter cobertura superior à variável bruta <code>V4019</code> (~30% de preenchimento na versão anterior). <code>VD4035</code> (horas efetivamente trabalhadas na semana de referência) é incluída para análises de sazonalidade e produtividade.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Inclusão de todos os ocupados:</strong> A query inclui <strong>todos os ocupados com código de ocupação válido</strong>, independentemente de terem renda declarada. O filtro de renda é aplicado via flag <code>tem_renda</code> na etapa de limpeza (4a).</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Variáveis indisponíveis:</strong> As variáveis <code>V4040</code> (tempo no emprego atual) e <code>V4018</code> (porte da empresa) não estão populadas na fonte utilizada (Base dos Dados/BigQuery) para o período analisado (Q3/2025), sendo portanto excluídas desta análise.</p>
</blockquote>
<div id="1dae0a2b" class="cell" data-execution_count="52">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.2a - Preparação de Dados - Download dos microdados PNAD</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Lógica: se o parquet já existe em data/raw/, carrega direto; senão, baixa do BigQuery.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>pnad_files <span class="op">=</span> <span class="bu">sorted</span>(DATA_RAW.glob(<span class="st">"pnad_*.parquet"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pnad_files:</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Caminho rápido: arquivo local já disponível ---</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    pnad_path <span class="op">=</span> pnad_files[<span class="op">-</span><span class="dv">1</span>]  <span class="co"># mais recente</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Arquivo PNAD encontrado localmente: </span><span class="sc">{</span>pnad_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    df_pnad_raw <span class="op">=</span> pd.read_parquet(pnad_path)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Carregado: </span><span class="sc">{</span><span class="bu">len</span>(df_pnad_raw)<span class="sc">:,}</span><span class="ss"> observações"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validar que o arquivo corresponde à configuração</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(<span class="vs">r"pnad_</span><span class="kw">(</span><span class="dv">\d</span><span class="op">{4}</span><span class="kw">)</span><span class="vs">q</span><span class="kw">(</span><span class="dv">\d</span><span class="kw">)</span><span class="vs">"</span>, pnad_path.name)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        ano_arquivo, trim_arquivo <span class="op">=</span> <span class="bu">int</span>(match.group(<span class="dv">1</span>)), <span class="bu">int</span>(match.group(<span class="dv">2</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ano_arquivo <span class="op">!=</span> PNAD_ANO <span class="kw">or</span> trim_arquivo <span class="op">!=</span> PNAD_TRIMESTRE:</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  WARNING: Arquivo é </span><span class="sc">{</span>ano_arquivo<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>trim_arquivo<span class="sc">}</span><span class="ss">, "</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                  <span class="ss">f"mas config diz </span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss">!"</span>)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  Atualizando variáveis de config para corresponder aos dados."</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            PNAD_ANO <span class="op">=</span> ano_arquivo</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            PNAD_TRIMESTRE <span class="op">=</span> trim_arquivo</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  OK: Arquivo corresponde à configuração (</span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Caminho completo: download via BigQuery ---</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Nenhum arquivo PNAD local encontrado. Iniciando download do BigQuery..."</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> basedosdados <span class="im">as</span> bd</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Verificar trimestres disponíveis</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    query_check <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT DISTINCT ano, trimestre, COUNT(*) as n_obs</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM `basedosdados.br_ibge_pnadc.microdados`</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE ano &gt;= 2024</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY ano, trimestre</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="st">    ORDER BY ano DESC, trimestre DESC</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="st">    LIMIT 5</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    df_check <span class="op">=</span> bd.read_sql(query_check, billing_project_id<span class="op">=</span>GCP_PROJECT_ID)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Trimestres disponíveis:</span><span class="ch">\n</span><span class="sc">{</span>df_check<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    trimestre_existe <span class="op">=</span> <span class="bu">len</span>(</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>        df_check[(df_check[<span class="st">'ano'</span>] <span class="op">==</span> PNAD_ANO) <span class="op">&amp;</span> (df_check[<span class="st">'trimestre'</span>] <span class="op">==</span> PNAD_TRIMESTRE)]</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> trimestre_existe:</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>        ano_usar, trim_usar <span class="op">=</span> PNAD_ANO, PNAD_TRIMESTRE</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>        ano_usar <span class="op">=</span> <span class="bu">int</span>(df_check.iloc[<span class="dv">0</span>][<span class="st">'ano'</span>])</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>        trim_usar <span class="op">=</span> <span class="bu">int</span>(df_check.iloc[<span class="dv">0</span>][<span class="st">'trimestre'</span>])</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"AVISO: </span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss"> indisponível. Usando </span><span class="sc">{</span>ano_usar<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>trim_usar<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>        PNAD_ANO <span class="op">=</span> ano_usar</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>        PNAD_TRIMESTRE <span class="op">=</span> trim_usar</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="ss">f"""</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="ss">        ano,</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="ss">        trimestre,</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="ss">        sigla_uf,</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="ss">        v2007  AS sexo,</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="ss">        v2009  AS idade,</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="ss">        v2010  AS raca_cor,</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd3004 AS nivel_instrucao,</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="ss">        v4010  AS cod_ocupacao,</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="ss">        v4013  AS grupamento_atividade,</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd4009 AS posicao_ocupacao,</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd4016 AS rendimento_habitual,</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd4020 AS rendimento_efetivo,</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd4031 AS horas_habituais,</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="ss">        vd4035 AS horas_efetivas,</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="ss">        v1028  AS peso</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM `basedosdados.br_ibge_pnadc.microdados`</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="ss">    WHERE ano = </span><span class="sc">{</span>ano_usar<span class="sc">}</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND trimestre = </span><span class="sc">{</span>trim_usar<span class="sc">}</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="ss">      AND v4010 IS NOT NULL</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="ss">    """</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Executando query para </span><span class="sc">{</span>ano_usar<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>trim_usar<span class="sc">}</span><span class="ss"> (pode demorar 2-5 min)..."</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    df_pnad_raw <span class="op">=</span> bd.read_sql(query, billing_project_id<span class="op">=</span>GCP_PROJECT_ID)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Salvar parquet</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    ano_real <span class="op">=</span> <span class="bu">int</span>(df_pnad_raw[<span class="st">'ano'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    trim_real <span class="op">=</span> <span class="bu">int</span>(df_pnad_raw[<span class="st">'trimestre'</span>].iloc[<span class="dv">0</span>])</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    output_path <span class="op">=</span> DATA_RAW <span class="op">/</span> <span class="ss">f"pnad_</span><span class="sc">{</span>ano_real<span class="sc">}</span><span class="ss">q</span><span class="sc">{</span>trim_real<span class="sc">}</span><span class="ss">.parquet"</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    df_pnad_raw.to_parquet(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Salvo em: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">df_pnad_raw: </span><span class="sc">{</span>df_pnad_raw<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> linhas x </span><span class="sc">{</span>df_pnad_raw<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> colunas"</span>)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Período: </span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Arquivo PNAD encontrado localmente: pnad_2025q3.parquet
Carregado: 220,091 observações
  OK: Arquivo corresponde à configuração (2025 Q3)

df_pnad_raw: 220,091 linhas x 15 colunas
Período: 2025 Q3</code></pre>
</div>
</div>
</section>
</section>
<section id="b.-verificar-dados-microdados-pnad-checkpoint" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="b.-verificar-dados-microdados-pnad-checkpoint"><span class="header-section-number">1.6</span> 2b. Verificar dados microdados PNAD (CHECKPOINT)</h3>
<p>Verificar dados gerados</p>
<div id="4a02ceeb" class="cell" data-execution_count="53">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.2b - Preparação de Dados - Verificar dados microdados PNAD</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHECKPOINT - Microdados PNAD"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Shape: </span><span class="sc">{</span>df_pnad_raw<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Colunas: </span><span class="sc">{</span><span class="bu">list</span>(df_pnad_raw.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># UFs</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>n_ufs <span class="op">=</span> df_pnad_raw[<span class="st">'sigla_uf'</span>].nunique()</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">UFs presentes: </span><span class="sc">{</span>n_ufs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> n_ufs <span class="op">!=</span> <span class="dv">27</span>:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Esperado 27 UFs, encontrado </span><span class="sc">{</span>n_ufs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># População</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>pop_milhoes <span class="op">=</span> df_pnad_raw[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"População representada: </span><span class="sc">{</span>pop_milhoes<span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Linhas</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(df_pnad_raw) <span class="op">&lt;</span> <span class="dv">100_000</span>:</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Apenas </span><span class="sc">{</span><span class="bu">len</span>(df_pnad_raw)<span class="sc">:,}</span><span class="ss"> linhas (esperado &gt; 100.000)"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar preenchimento das variáveis-chave</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Preenchimento das variáveis:"</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_pnad_raw.columns:</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    n_valid <span class="op">=</span> df_pnad_raw[col].notna().<span class="bu">sum</span>()</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> n_valid <span class="op">/</span> <span class="bu">len</span>(df_pnad_raw) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    flag <span class="op">=</span> <span class="st">"  "</span> <span class="cf">if</span> pct <span class="op">&gt;</span> <span class="dv">80</span> <span class="cf">else</span> <span class="st">"  WARNING -"</span> <span class="cf">if</span> pct <span class="op">&gt;</span> <span class="dv">50</span> <span class="cf">else</span> <span class="st">"  CRITICO -"</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>flag<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>n_valid<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Tipos</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Dtypes:</span><span class="ch">\n</span><span class="sc">{</span>df_pnad_raw<span class="sc">.</span>dtypes<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Amostra</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Primeiras linhas:"</span>)</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>df_pnad_raw.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CHECKPOINT - Microdados PNAD
============================================================

Shape: (220091, 15)
Colunas: ['ano', 'trimestre', 'sigla_uf', 'sexo', 'idade', 'raca_cor', 'nivel_instrucao', 'cod_ocupacao', 'grupamento_atividade', 'posicao_ocupacao', 'rendimento_habitual', 'rendimento_efetivo', 'horas_habituais', 'horas_efetivas', 'peso']

UFs presentes: 27
População representada: 102.4 milhões

Preenchimento das variáveis:
   ano: 220,091 (100.0%)
   trimestre: 220,091 (100.0%)
   sigla_uf: 220,091 (100.0%)
   sexo: 220,091 (100.0%)
   idade: 220,091 (100.0%)
   raca_cor: 220,091 (100.0%)
   nivel_instrucao: 220,091 (100.0%)
   cod_ocupacao: 220,091 (100.0%)
   grupamento_atividade: 220,091 (100.0%)
   posicao_ocupacao: 220,091 (100.0%)
   rendimento_habitual: 215,370 (97.9%)
   rendimento_efetivo: 215,405 (97.9%)
   horas_habituais: 220,091 (100.0%)
   horas_efetivas: 220,091 (100.0%)
   peso: 220,091 (100.0%)

Dtypes:
ano                       Int64
trimestre                 Int64
sigla_uf                 object
sexo                     object
idade                     Int64
raca_cor                 object
nivel_instrucao          object
cod_ocupacao             object
grupamento_atividade     object
posicao_ocupacao         object
rendimento_habitual     float64
rendimento_efetivo      float64
horas_habituais           Int64
horas_efetivas            Int64
peso                    float64
dtype: object

Primeiras linhas:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ano</th>
<th data-quarto-table-cell-role="th">trimestre</th>
<th data-quarto-table-cell-role="th">sigla_uf</th>
<th data-quarto-table-cell-role="th">sexo</th>
<th data-quarto-table-cell-role="th">idade</th>
<th data-quarto-table-cell-role="th">raca_cor</th>
<th data-quarto-table-cell-role="th">nivel_instrucao</th>
<th data-quarto-table-cell-role="th">cod_ocupacao</th>
<th data-quarto-table-cell-role="th">grupamento_atividade</th>
<th data-quarto-table-cell-role="th">posicao_ocupacao</th>
<th data-quarto-table-cell-role="th">rendimento_habitual</th>
<th data-quarto-table-cell-role="th">rendimento_efetivo</th>
<th data-quarto-table-cell-role="th">horas_habituais</th>
<th data-quarto-table-cell-role="th">horas_efetivas</th>
<th data-quarto-table-cell-role="th">peso</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>2025</td>
<td>3</td>
<td>RR</td>
<td>1</td>
<td>47</td>
<td>4</td>
<td>4</td>
<td>8322</td>
<td>49030</td>
<td>9</td>
<td>3000.0</td>
<td>2800.0</td>
<td>28</td>
<td>22</td>
<td>80.230030</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2025</td>
<td>3</td>
<td>DF</td>
<td>2</td>
<td>35</td>
<td>1</td>
<td>5</td>
<td>4120</td>
<td>78000</td>
<td>1</td>
<td>2000.0</td>
<td>3600.0</td>
<td>80</td>
<td>80</td>
<td>273.396289</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>2025</td>
<td>3</td>
<td>SE</td>
<td>1</td>
<td>62</td>
<td>4</td>
<td>2</td>
<td>5414</td>
<td>85012</td>
<td>7</td>
<td>2000.0</td>
<td>2000.0</td>
<td>18</td>
<td>18</td>
<td>216.050334</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>2025</td>
<td>3</td>
<td>SE</td>
<td>2</td>
<td>40</td>
<td>4</td>
<td>5</td>
<td>5221</td>
<td>56011</td>
<td>8</td>
<td>5000.0</td>
<td>5000.0</td>
<td>52</td>
<td>52</td>
<td>275.005513</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>2025</td>
<td>3</td>
<td>SE</td>
<td>2</td>
<td>34</td>
<td>4</td>
<td>5</td>
<td>5212</td>
<td>56020</td>
<td>9</td>
<td>1200.0</td>
<td>1200.0</td>
<td>26</td>
<td>26</td>
<td>201.275603</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="a.-processar-índice-de-exposição-ilo" class="level3" data-number="1.7">
<h3 data-number="1.7" class="anchored" data-anchor-id="a.-processar-índice-de-exposição-ilo"><span class="header-section-number">1.7</span> 3a. Processar índice de exposição ILO</h3>
<p>Lê a planilha ILO com scores de exposição por ISCO-08, padroniza e gera níveis</p>
<div id="67346cc6" class="cell" data-execution_count="54">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.3a - Preparação de Dados - Processar índice de exposição ILO</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Lendo arquivo ILO: </span><span class="sc">{</span>ILO_FILE<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>df_ilo_raw <span class="op">=</span> pd.read_excel(ILO_FILE)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Linhas raw (tarefas): </span><span class="sc">{</span><span class="bu">len</span>(df_ilo_raw)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Colunas disponíveis: </span><span class="sc">{</span><span class="bu">list</span>(df_ilo_raw.columns)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapeamento de colunas</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>col_mapping <span class="op">=</span> {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ISCO_08'</span>: <span class="st">'isco_08'</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Title'</span>: <span class="st">'occupation_title'</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_score_2025'</span>: <span class="st">'exposure_score'</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SD_2025'</span>: <span class="st">'exposure_sd'</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'potential25'</span>: <span class="st">'exposure_gradient'</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>available_cols <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> col_mapping.keys() <span class="cf">if</span> c <span class="kw">in</span> df_ilo_raw.columns]</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Colunas mapeadas: </span><span class="sc">{</span>available_cols<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>df_ilo_renamed <span class="op">=</span> df_ilo_raw.rename(</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{k: v <span class="cf">for</span> k, v <span class="kw">in</span> col_mapping.items() <span class="cf">if</span> k <span class="kw">in</span> df_ilo_raw.columns}</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar por ocupação (arquivo original tem múltiplas tarefas por ocupação)</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>df_ilo <span class="op">=</span> df_ilo_renamed.groupby(<span class="st">'isco_08'</span>).agg({</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'occupation_title'</span>: <span class="st">'first'</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score'</span>: <span class="st">'mean'</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_sd'</span>: <span class="st">'mean'</span>,</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_gradient'</span>: <span class="st">'first'</span>,</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir formato string com 4 dígitos</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>df_ilo[<span class="st">'isco_08_str'</span>] <span class="op">=</span> df_ilo[<span class="st">'isco_08'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">4</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Ocupações únicas: </span><span class="sc">{</span><span class="bu">len</span>(df_ilo)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Score médio: </span><span class="sc">{</span>df_ilo[<span class="st">'exposure_score'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Score range: [</span><span class="sc">{</span>df_ilo[<span class="st">'exposure_score'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>df_ilo[<span class="st">'exposure_score'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Salvar processado</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>ilo_output <span class="op">=</span> DATA_PROCESSED <span class="op">/</span> <span class="st">"ilo_exposure_clean.csv"</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>df_ilo.to_csv(ilo_output, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Salvo em: </span><span class="sc">{</span>ilo_output<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lendo arquivo ILO: data/input/Final_Scores_ISCO08_Gmyrek_et_al_2025.xlsx
Linhas raw (tarefas): 3,265
Colunas disponíveis: ['label4d', 'label1d', 'ISCO_08', 'Title', 'taskID', 'Task_ISCO', 'score_2023', 'Weaviate Status', 'predicted_score_2025_gpt4o', 'prediction_justification_gpt4o', 'weaviate_status_gemini', 'predicted_score_2025_gemini', 'prediction_justification_gemini', 'score_2025', 'source', 'mean_score_2023', 'mean_score_2025', 'SD_2023', 'SD_2025', 'potential25', 'potential23']
Colunas mapeadas: ['ISCO_08', 'Title', 'mean_score_2025', 'SD_2025', 'potential25']

Ocupações únicas: 427
Score médio: 0.297
Score range: [0.090, 0.700]

Salvo em: data/processed/ilo_exposure_clean.csv</code></pre>
</div>
</div>
</section>
<section id="b.-verificar-índice-de-exposição-ilo" class="level3" data-number="1.8">
<h3 data-number="1.8" class="anchored" data-anchor-id="b.-verificar-índice-de-exposição-ilo"><span class="header-section-number">1.8</span> 3b. Verificar índice de exposição ILO</h3>
<p>Verificar: número de ocupações, coluna de score, distribuição por gradiente</p>
<div id="3fae4169" class="cell" data-execution_count="55">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.3b - Preparação de Dados - Verificar índice de exposição ILO</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHECKPOINT - Índice ILO"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Número de ocupações</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>n_ocup <span class="op">=</span> <span class="bu">len</span>(df_ilo)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Ocupações: </span><span class="sc">{</span>n_ocup<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> n_ocup <span class="op">&lt;</span> <span class="dv">400</span>:</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Poucas ocupações (</span><span class="sc">{</span>n_ocup<span class="sc">}</span><span class="ss">). Esperado ~427."</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Range de scores</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>score_min <span class="op">=</span> df_ilo[<span class="st">'exposure_score'</span>].<span class="bu">min</span>()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>score_max <span class="op">=</span> df_ilo[<span class="st">'exposure_score'</span>].<span class="bu">max</span>()</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Score range: [</span><span class="sc">{</span>score_min<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span>score_max<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> score_min <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> score_max <span class="op">&gt;</span> <span class="dv">1</span>:</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Scores fora do intervalo [0, 1]"</span>)</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribuição por gradiente</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por gradiente:"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grad, count <span class="kw">in</span> df_ilo[<span class="st">'exposure_gradient'</span>].value_counts().items():</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>grad<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">}</span><span class="ss"> ocupações"</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Amostra</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Amostra (5 maiores scores):"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>df_ilo.nlargest(<span class="dv">5</span>, <span class="st">'exposure_score'</span>)[[<span class="st">'isco_08_str'</span>, <span class="st">'occupation_title'</span>, <span class="st">'exposure_score'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CHECKPOINT - Índice ILO
============================================================

Ocupações: 427
Score range: [0.090, 0.700]

Distribuição por gradiente:
  Not Exposed: 231 ocupações
  Minimal Exposure: 84 ocupações
  Exposed: Gradient 2: 44 ocupações
  Exposed: Gradient 3: 38 ocupações
  Exposed: Gradient 1: 17 ocupações
  Exposed: Gradient 4: 13 ocupações

Amostra (5 maiores scores):</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">isco_08_str</th>
<th data-quarto-table-cell-role="th">occupation_title</th>
<th data-quarto-table-cell-role="th">exposure_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">207</th>
<td>4132</td>
<td>Data Entry Clerks</td>
<td>0.70</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">206</th>
<td>4131</td>
<td>Typists and Word Processing Operators</td>
<td>0.65</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">220</th>
<td>4311</td>
<td>Accounting and Bookkeeping Clerks</td>
<td>0.64</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">221</th>
<td>4312</td>
<td>Statistical, Finance and Insurance Clerks</td>
<td>0.64</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">164</th>
<td>3311</td>
<td>Securities and Finance Dealers and Brokers</td>
<td>0.63</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="notas-sobre-terminologia" class="level3" data-number="1.9">
<h3 data-number="1.9" class="anchored" data-anchor-id="notas-sobre-terminologia"><span class="header-section-number">1.9</span> Notas sobre terminologia</h3>
<blockquote class="blockquote">
<p><strong>Sobre sexo:</strong> A PNADc coleta a variável V2007 (sexo biológico: masculino/feminino). Esta pesquisa não coleta identidade de gênero. Utilizamos o termo “sexo” ao longo desta análise, em conformidade com a terminologia do IBGE.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Sobre raça/cor:</strong> Utilizamos a variável V2010 (autoclassificação de cor ou raça) com as cinco categorias do IBGE: Branca, Preta, Parda, Amarela e Indígena. Quando apresentamos resultados agregados em “Negros” (Pretos + Pardos), seguimos a convenção amplamente adotada na sociologia e economia do trabalho brasileira (Osorio, 2003; Soares, 2008). Resultados desagregados estão disponíveis nos apêndices.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Sobre “exposição”:</strong> O índice da OIT mede o potencial de que tarefas ocupacionais sejam afetadas pela IA generativa — seja por automação, seja por complementação/aumento de produtividade. “Exposição” não é sinônimo de “risco de desemprego” ou “ameaça”. Ocupações altamente expostas podem tanto perder tarefas quanto ganhar produtividade, dependendo do contexto institucional, regulatório e organizacional.</p>
</blockquote>
</section>
<section id="a.-limpeza-e-variáveis-derivadas-pnad" class="level3" data-number="1.10">
<h3 data-number="1.10" class="anchored" data-anchor-id="a.-limpeza-e-variáveis-derivadas-pnad"><span class="header-section-number">1.10</span> 4a. Limpeza e variáveis derivadas – PNAD</h3>
<p>Filtra população de interesse, cria variáveis derivadas (região, grandes grupos COD, faixas de renda, etc.) e padroniza códigos de ocupação.</p>
<p><strong>Entrada:</strong> <code>data/raw/pnad_*.parquet</code>.<br>
<strong>Saída:</strong> <code>data/processed/pnad_clean.csv</code></p>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Inclusão de todos os ocupados:</strong> A análise de exposição inclui todos os ocupados com código de ocupação válido, <strong>independentemente de terem renda declarada</strong>. A variável <code>tem_renda</code> sinaliza trabalhadores com rendimento habitual positivo. Para análises de rendimento (tabelas salariais, faixas de renda), filtrar por <code>tem_renda == 1</code>.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Faixas de renda em salários mínimos:</strong> Optamos por classificar a renda em faixas de salários mínimos (até 1 SM, 1-2 SM, 2-3 SM, 3-5 SM, 5+ SM) em vez de quintis populacionais. Esta escolha se justifica por: (1) a elevada concentração de rendimentos em torno de 1 SM no Brasil gera empates que distorcem os quintis (Q1 absorveria ~31% da população); (2) faixas em SM são mais interpretáveis e amplamente utilizadas na literatura brasileira de economia do trabalho.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota metodológica — Winsorização:</strong> Aplicamos winsorização nos percentis 1 e 99 da distribuição de rendimento habitual, calculados com pesos amostrais (V1028), para limitar a influência de valores extremos preservando o tamanho amostral. Esta técnica é preferível ao trimming (que descarta observações) e é prática padrão em análises de renda com dados de survey.</p>
</blockquote>
<div id="5a0dfa0c" class="cell" data-execution_count="56">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.4a - Preparação de Dados - Limpeza e variáveis derivadas</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_pnad <span class="op">=</span> df_pnad_raw.copy()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>n_inicial <span class="op">=</span> <span class="bu">len</span>(df_pnad)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Observações iniciais: </span><span class="sc">{</span>n_inicial<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># LIMPEZA - Conversão de tipos</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'cod_ocupacao'</span>] <span class="op">=</span> df_pnad[<span class="st">'cod_ocupacao'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">4</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'idade'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'idade'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'rendimento_habitual'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'rendimento_habitual'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'rendimento_efetivo'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'rendimento_efetivo'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'horas_habituais'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'horas_habituais'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'horas_efetivas'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'horas_efetivas'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'peso'</span>] <span class="op">=</span> pd.to_numeric(df_pnad[<span class="st">'peso'</span>], errors<span class="op">=</span><span class="st">'coerce'</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># LIMPEZA - Filtros</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover missings críticos (ocupação, idade, peso — NÃO renda)</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>df_pnad <span class="op">=</span> df_pnad.dropna(subset<span class="op">=</span>[<span class="st">'cod_ocupacao'</span>, <span class="st">'idade'</span>, <span class="st">'peso'</span>])</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Após remover missings críticos: </span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="op">/</span>n_inicial<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrar faixa etária (18-65)</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>df_pnad <span class="op">=</span> df_pnad[(df_pnad[<span class="st">'idade'</span>] <span class="op">&gt;=</span> <span class="dv">18</span>) <span class="op">&amp;</span> (df_pnad[<span class="st">'idade'</span>] <span class="op">&lt;=</span> <span class="dv">65</span>)]</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Após filtrar 18-65 anos: </span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="op">/</span>n_inicial<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Remover ocupações inválidas</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>df_pnad <span class="op">=</span> df_pnad[<span class="op">~</span>df_pnad[<span class="st">'cod_ocupacao'</span>].isin([<span class="st">'0000'</span>, <span class="st">'9999'</span>])]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Após remover ocupações inválidas: </span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="co"># VARIÁVEIS DERIVADAS</span></span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Flag de renda (em vez de excluir sem renda)</span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'tem_renda'</span>] <span class="op">=</span> (df_pnad[<span class="st">'rendimento_habitual'</span>].notna() <span class="op">&amp;</span> (df_pnad[<span class="st">'rendimento_habitual'</span>] <span class="op">&gt;</span> <span class="dv">0</span>)).astype(<span class="bu">int</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>n_sem_renda <span class="op">=</span> (df_pnad[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">0</span>).<span class="bu">sum</span>()</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>pop_sem_renda <span class="op">=</span> df_pnad.loc[df_pnad[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">0</span>, <span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Trabalhadores sem renda declarada: </span><span class="sc">{</span>n_sem_renda<span class="sc">:,}</span><span class="ss"> obs (</span><span class="sc">{</span>pop_sem_renda<span class="sc">:.1f}</span><span class="ss"> milhões)"</span>)</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Formalidade</span></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'formal'</span>] <span class="op">=</span> df_pnad[<span class="st">'posicao_ocupacao'</span>].astype(<span class="bu">str</span>).isin(POSICAO_FORMAL).astype(<span class="bu">int</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Taxa de formalidade: </span><span class="sc">{</span>df_pnad[<span class="st">'formal'</span>]<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Faixas etárias</span></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'faixa_etaria'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>    df_pnad[<span class="st">'idade'</span>], bins<span class="op">=</span>IDADE_BINS, labels<span class="op">=</span>IDADE_LABELS</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Região</span></span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'regiao'</span>] <span class="op">=</span> df_pnad[<span class="st">'sigla_uf'</span>].<span class="bu">map</span>(REGIAO_MAP)</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Raça agregada</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'raca_agregada'</span>] <span class="op">=</span> df_pnad[<span class="st">'raca_cor'</span>].astype(<span class="bu">str</span>).<span class="bu">map</span>(RACA_AGREGADA_MAP)</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Grande grupo ocupacional</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'grande_grupo'</span>] <span class="op">=</span> df_pnad[<span class="st">'cod_ocupacao'</span>].<span class="bu">str</span>[<span class="dv">0</span>].<span class="bu">map</span>(GRANDES_GRUPOS)</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Sexo como texto</span></span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'sexo_texto'</span>] <span class="op">=</span> df_pnad[<span class="st">'sexo'</span>].<span class="bu">map</span>({<span class="dv">1</span>: <span class="st">'Homem'</span>, <span class="dv">2</span>: <span class="st">'Mulher'</span>, <span class="st">'1'</span>: <span class="st">'Homem'</span>, <span class="st">'2'</span>: <span class="st">'Mulher'</span>})</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Winsorização de renda (percentis ponderados 1 e 99) — APENAS para quem tem renda</span></span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>mask_renda <span class="op">=</span> df_pnad[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>p01 <span class="op">=</span> weighted_quantile(</span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    df_pnad.loc[mask_renda, <span class="st">'rendimento_habitual'</span>],</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    df_pnad.loc[mask_renda, <span class="st">'peso'</span>], <span class="fl">0.01</span></span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>p99 <span class="op">=</span> weighted_quantile(</span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>    df_pnad.loc[mask_renda, <span class="st">'rendimento_habitual'</span>],</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    df_pnad.loc[mask_renda, <span class="st">'peso'</span>], <span class="fl">0.99</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'rendimento_winsor'</span>] <span class="op">=</span> df_pnad[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span>p01, upper<span class="op">=</span>p99)</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Winsorização ponderada: P1 = R$ </span><span class="sc">{</span>p01<span class="sc">:,.0f}</span><span class="ss">, P99 = R$ </span><span class="sc">{</span>p99<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Faixas de renda em salários mínimos</span></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'faixa_renda_sm'</span>] <span class="op">=</span> pd.cut(</span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    df_pnad[<span class="st">'rendimento_habitual'</span>] <span class="op">/</span> SALARIO_MINIMO,</span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="bu">float</span>(<span class="st">'inf'</span>)],</span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Até 1 SM'</span>, <span class="st">'1-2 SM'</span>, <span class="st">'2-3 SM'</span>, <span class="st">'3-5 SM'</span>, <span class="st">'5+ SM'</span>],</span>
<span id="cb12-83"><a href="#cb12-83" aria-hidden="true" tabindex="-1"></a>    right<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb12-84"><a href="#cb12-84" aria-hidden="true" tabindex="-1"></a>    include_lowest<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb12-85"><a href="#cb12-85" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-86"><a href="#cb12-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Distribuição por faixa de renda (SM = R$ </span><span class="sc">{</span>SALARIO_MINIMO<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb12-87"><a href="#cb12-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> faixa, peso <span class="kw">in</span> df_pnad[df_pnad[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>].groupby(<span class="st">'faixa_renda_sm'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().items():</span>
<span id="cb12-88"><a href="#cb12-88" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> peso <span class="op">/</span> df_pnad.loc[mask_renda, <span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb12-89"><a href="#cb12-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>faixa<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões (</span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb12-90"><a href="#cb12-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-91"><a href="#cb12-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar preenchimento de horas</span></span>
<span id="cb12-92"><a href="#cb12-92" aria-hidden="true" tabindex="-1"></a>n_horas_hab <span class="op">=</span> df_pnad[<span class="st">'horas_habituais'</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb12-93"><a href="#cb12-93" aria-hidden="true" tabindex="-1"></a>n_horas_efe <span class="op">=</span> df_pnad[<span class="st">'horas_efetivas'</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb12-94"><a href="#cb12-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Horas habituais: </span><span class="sc">{</span>n_horas_hab<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>n_horas_hab<span class="op">/</span><span class="bu">len</span>(df_pnad)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb12-95"><a href="#cb12-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Horas efetivas:  </span><span class="sc">{</span>n_horas_efe<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>n_horas_efe<span class="op">/</span><span class="bu">len</span>(df_pnad)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb12-96"><a href="#cb12-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-97"><a href="#cb12-97" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-98"><a href="#cb12-98" aria-hidden="true" tabindex="-1"></a><span class="co"># SALVAR</span></span>
<span id="cb12-99"><a href="#cb12-99" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb12-100"><a href="#cb12-100" aria-hidden="true" tabindex="-1"></a>pnad_clean_path <span class="op">=</span> DATA_PROCESSED <span class="op">/</span> <span class="st">"pnad_clean.csv"</span></span>
<span id="cb12-101"><a href="#cb12-101" aria-hidden="true" tabindex="-1"></a>df_pnad.to_csv(pnad_clean_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb12-102"><a href="#cb12-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Salvo em: </span><span class="sc">{</span>pnad_clean_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-103"><a href="#cb12-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"df_pnad: </span><span class="sc">{</span>df_pnad<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> linhas x </span><span class="sc">{</span>df_pnad<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> colunas"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Observações iniciais: 220,091
Após remover missings críticos: 220,091 (100.0%)
Após filtrar 18-65 anos: 207,919 (94.5%)
Após remover ocupações inválidas: 207,901

Trabalhadores sem renda declarada: 3,759 obs (1.1 milhões)
Taxa de formalidade: 37.0%
Winsorização ponderada: P1 = R$ 200, P99 = R$ 21,000

Distribuição por faixa de renda (SM = R$ 1518):
  Até 1 SM: 30.3 milhões (31.3%)
  1-2 SM: 39.0 milhões (40.4%)
  2-3 SM: 10.1 milhões (10.5%)
  3-5 SM: 9.5 milhões (9.8%)
  5+ SM: 7.8 milhões (8.0%)

Horas habituais: 207,901 (100.0%)
Horas efetivas:  207,901 (100.0%)

Salvo em: data/processed/pnad_clean.csv
df_pnad: 207,901 linhas x 24 colunas</code></pre>
</div>
</div>
</section>
<section id="b.-verificar-limpeza-e-variáveis-derivadas-pnad" class="level3" data-number="1.11">
<h3 data-number="1.11" class="anchored" data-anchor-id="b.-verificar-limpeza-e-variáveis-derivadas-pnad"><span class="header-section-number">1.11</span> 4b. Verificar Limpeza e variáveis derivadas – PNAD</h3>
<p>Verificar: número de linhas, colunas criadas, valores faltantes em COD.</p>
<div id="7aca2b1b" class="cell" data-execution_count="57">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.4b - Preparação de Dados - Verificar Limpeza e variáveis derivadas</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHECKPOINT - Limpeza PNAD"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Perda de observações</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>pct_perda <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="bu">len</span>(df_pnad) <span class="op">/</span> n_inicial</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Observações: </span><span class="sc">{</span>n_inicial<span class="sc">:,}</span><span class="ss"> -&gt; </span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="sc">:,}</span><span class="ss"> (perda: </span><span class="sc">{</span>pct_perda<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pct_perda <span class="op">&gt;</span> <span class="fl">0.20</span>:</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Perda de </span><span class="sc">{</span>pct_perda<span class="sc">:.1%}</span><span class="ss"> das observações (&gt; 20%)"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Missings em variáveis derivadas</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> [<span class="st">'regiao'</span>, <span class="st">'raca_agregada'</span>, <span class="st">'grande_grupo'</span>, <span class="st">'faixa_etaria'</span>, <span class="st">'sexo_texto'</span>]:</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    n_miss <span class="op">=</span> df_pnad[col].isna().<span class="bu">sum</span>()</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> n_miss <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  WARNING: </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> tem </span><span class="sc">{</span>n_miss<span class="sc">:,}</span><span class="ss"> valores faltantes"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Ocupações únicas (COD): </span><span class="sc">{</span>df_pnad[<span class="st">'cod_ocupacao'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"UFs: </span><span class="sc">{</span>df_pnad[<span class="st">'sigla_uf'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"População representada: </span><span class="sc">{</span>df_pnad[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por sexo:"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sexo, peso <span class="kw">in</span> df_pnad.groupby(<span class="st">'sexo_texto'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().items():</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>sexo<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por região:"</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> regiao, peso <span class="kw">in</span> df_pnad.groupby(<span class="st">'regiao'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).items():</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>regiao<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por faixa etária:"</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_pnad[<span class="st">'faixa_etaria'</span>].value_counts().sort_index())</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por faixa de renda (SM):"</span>)</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df_pnad[<span class="st">'faixa_renda_sm'</span>].value_counts().sort_index())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CHECKPOINT - Limpeza PNAD
============================================================

Observações: 220,091 -&gt; 207,901 (perda: 5.5%)
  WARNING: grande_grupo tem 1,671 valores faltantes

Ocupações únicas (COD): 428
UFs: 27
População representada: 97.8 milhões

Distribuição por sexo:
  Homem: 55.0 milhões
  Mulher: 42.8 milhões

Distribuição por região:
  Sudeste: 43.4 milhões
  Nordeste: 22.3 milhões
  Sul: 15.7 milhões
  Centro-Oeste: 8.5 milhões
  Norte: 7.8 milhões

Distribuição por faixa etária:
faixa_etaria
18-24    29595
25-34    48629
35-44    55588
45-54    46136
55+      27953
Name: count, dtype: int64

Distribuição por faixa de renda (SM):
faixa_renda_sm
Até 1 SM    74904
1-2 SM      77010
2-3 SM      19520
3-5 SM      18120
5+ SM       14588
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="a.-crosswalk-cod-isco-08" class="level3" data-number="1.12">
<h3 data-number="1.12" class="anchored" data-anchor-id="a.-crosswalk-cod-isco-08"><span class="header-section-number">1.12</span> 5a. Crosswalk COD → ISCO-08</h3>
<p>Mapear códigos de ocupação COD (PNAD) para ISCO-08 para permitir o merge com o índice ILO.</p>
<section id="estratégia-de-correspondência" class="level4" data-number="1.12.1">
<h4 data-number="1.12.1" class="anchored" data-anchor-id="estratégia-de-correspondência"><span class="header-section-number">1.12.1</span> Estratégia de correspondência</h4>
<p>A COD (Classificação de Ocupações para Pesquisas Domiciliares) do IBGE é derivada diretamente da ISCO-08 da OIT. Os códigos compartilham a mesma estrutura hierárquica de 4 dígitos, com o primeiro dígito representando os mesmos 9 grandes grupos ocupacionais (Fonte: IBGE, Nota Técnica COD 2010). Isso permite um match direto de string entre COD e ISCO-08 na maioria dos casos.</p>
<p>Adotamos uma estratégia de correspondência hierárquica para maximizar a cobertura:</p>
<ol type="1">
<li><strong>4 dígitos (exato):</strong> match direto COD ↔︎ ISCO-08. Cobre ~98% das observações.</li>
<li><strong>3 dígitos (subgrupo):</strong> para códigos COD sem equivalente exato na ISCO-08, atribui-se a média do subgrupo (3 primeiros dígitos). Cobre ~1-2% adicional.</li>
<li><strong>2 dígitos (grupo menor):</strong> fallback para o grupo de 2 dígitos.</li>
<li><strong>1 dígito (grande grupo):</strong> fallback final para o grande grupo ocupacional.</li>
</ol>
<p><strong>Limitação:</strong> Não há validação semântica título-a-título; possíveis “falsos cognatos numéricos” são mitigados pelos sanity checks por grande grupo (verificação de que a ordenação de exposição por grande grupo é coerente com a literatura).</p>
<div id="69e6612d" class="cell" data-execution_count="58">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.5a - Preparação de Dados - Crosswalk COD → ISCO-08</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir formatos string</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>df_ilo[<span class="st">'isco_08_str'</span>] <span class="op">=</span> df_ilo[<span class="st">'isco_08_str'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">4</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>df_pnad[<span class="st">'cod_ocupacao'</span>] <span class="op">=</span> df_pnad[<span class="st">'cod_ocupacao'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">4</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"PNAD: </span><span class="sc">{</span><span class="bu">len</span>(df_pnad)<span class="sc">:,}</span><span class="ss"> observações"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"ILO:  </span><span class="sc">{</span><span class="bu">len</span>(df_ilo)<span class="sc">:,}</span><span class="ss"> ocupações ISCO-08"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar dicionários de lookup em cada nível hierárquico</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>ilo_4d <span class="op">=</span> df_ilo.groupby(<span class="st">'isco_08_str'</span>)[<span class="st">'exposure_score'</span>].mean().to_dict()</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>ilo_3d <span class="op">=</span> df_ilo.groupby(df_ilo[<span class="st">'isco_08_str'</span>].<span class="bu">str</span>[:<span class="dv">3</span>])[<span class="st">'exposure_score'</span>].mean().to_dict()</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>ilo_2d <span class="op">=</span> df_ilo.groupby(df_ilo[<span class="st">'isco_08_str'</span>].<span class="bu">str</span>[:<span class="dv">2</span>])[<span class="st">'exposure_score'</span>].mean().to_dict()</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>ilo_1d <span class="op">=</span> df_ilo.groupby(df_ilo[<span class="st">'isco_08_str'</span>].<span class="bu">str</span>[:<span class="dv">1</span>])[<span class="st">'exposure_score'</span>].mean().to_dict()</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Lookup do gradiente oficial ILO (potential25) — apenas para match 4-digit</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>ilo_gradient_4d <span class="op">=</span> df_ilo.groupby(<span class="st">'isco_08_str'</span>)[<span class="st">'exposure_gradient'</span>].first().to_dict()</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Códigos ILO: 4d=</span><span class="sc">{</span><span class="bu">len</span>(ilo_4d)<span class="sc">}</span><span class="ss">, 3d=</span><span class="sc">{</span><span class="bu">len</span>(ilo_3d)<span class="sc">}</span><span class="ss">, 2d=</span><span class="sc">{</span><span class="bu">len</span>(ilo_2d)<span class="sc">}</span><span class="ss">, 1d=</span><span class="sc">{</span><span class="bu">len</span>(ilo_1d)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Crosswalk hierárquico (4 → 3 → 2 → 1 dígito)</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>df_crosswalked <span class="op">=</span> df_pnad.copy()</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>df_crosswalked[<span class="st">'exposure_score'</span>] <span class="op">=</span> np.nan</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>df_crosswalked[<span class="st">'exposure_gradient'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>df_crosswalked[<span class="st">'match_level'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Nível 4-digit</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>mask_4d <span class="op">=</span> df_crosswalked[<span class="st">'cod_ocupacao'</span>].isin(ilo_4d.keys())</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[mask_4d, <span class="st">'exposure_score'</span>] <span class="op">=</span> df_crosswalked.loc[mask_4d, <span class="st">'cod_ocupacao'</span>].<span class="bu">map</span>(ilo_4d)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[mask_4d, <span class="st">'exposure_gradient'</span>] <span class="op">=</span> df_crosswalked.loc[mask_4d, <span class="st">'cod_ocupacao'</span>].<span class="bu">map</span>(ilo_gradient_4d)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[mask_4d, <span class="st">'match_level'</span>] <span class="op">=</span> <span class="st">'4-digit'</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Match 4-digit: </span><span class="sc">{</span>mask_4d<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>mask_4d<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Nível 3-digit</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>mask_missing <span class="op">=</span> df_crosswalked[<span class="st">'exposure_score'</span>].isna()</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>cod_3d <span class="op">=</span> df_crosswalked.loc[mask_missing, <span class="st">'cod_ocupacao'</span>].<span class="bu">str</span>[:<span class="dv">3</span>]</span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>mask_3d <span class="op">=</span> cod_3d.isin(ilo_3d.keys())</span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>idx_3d <span class="op">=</span> mask_missing[mask_missing].index[mask_3d.values]</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_3d, <span class="st">'exposure_score'</span>] <span class="op">=</span> cod_3d[mask_3d].<span class="bu">map</span>(ilo_3d).values</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_3d, <span class="st">'exposure_gradient'</span>] <span class="op">=</span> <span class="st">'Sem classificação'</span></span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_3d, <span class="st">'match_level'</span>] <span class="op">=</span> <span class="st">'3-digit'</span></span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match 3-digit: </span><span class="sc">{</span><span class="bu">len</span>(idx_3d)<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(idx_3d)<span class="op">/</span><span class="bu">len</span>(df_crosswalked)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Nível 2-digit</span></span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>mask_missing <span class="op">=</span> df_crosswalked[<span class="st">'exposure_score'</span>].isna()</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>cod_2d <span class="op">=</span> df_crosswalked.loc[mask_missing, <span class="st">'cod_ocupacao'</span>].<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>mask_2d <span class="op">=</span> cod_2d.isin(ilo_2d.keys())</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>idx_2d <span class="op">=</span> mask_missing[mask_missing].index[mask_2d.values]</span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_2d, <span class="st">'exposure_score'</span>] <span class="op">=</span> cod_2d[mask_2d].<span class="bu">map</span>(ilo_2d).values</span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_2d, <span class="st">'exposure_gradient'</span>] <span class="op">=</span> <span class="st">'Sem classificação'</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_2d, <span class="st">'match_level'</span>] <span class="op">=</span> <span class="st">'2-digit'</span></span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match 2-digit: </span><span class="sc">{</span><span class="bu">len</span>(idx_2d)<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(idx_2d)<span class="op">/</span><span class="bu">len</span>(df_crosswalked)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Nível 1-digit</span></span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>mask_missing <span class="op">=</span> df_crosswalked[<span class="st">'exposure_score'</span>].isna()</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>cod_1d <span class="op">=</span> df_crosswalked.loc[mask_missing, <span class="st">'cod_ocupacao'</span>].<span class="bu">str</span>[:<span class="dv">1</span>]</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>mask_1d <span class="op">=</span> cod_1d.isin(ilo_1d.keys())</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>idx_1d <span class="op">=</span> mask_missing[mask_missing].index[mask_1d.values]</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_1d, <span class="st">'exposure_score'</span>] <span class="op">=</span> cod_1d[mask_1d].<span class="bu">map</span>(ilo_1d).values</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_1d, <span class="st">'exposure_gradient'</span>] <span class="op">=</span> <span class="st">'Sem classificação'</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[idx_1d, <span class="st">'match_level'</span>] <span class="op">=</span> <span class="st">'1-digit'</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Match 1-digit: </span><span class="sc">{</span><span class="bu">len</span>(idx_1d)<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span><span class="bu">len</span>(idx_1d)<span class="op">/</span><span class="bu">len</span>(df_crosswalked)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Sem match</span></span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>n_sem_match <span class="op">=</span> df_crosswalked[<span class="st">'exposure_score'</span>].isna().<span class="bu">sum</span>()</span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>df_crosswalked.loc[df_crosswalked[<span class="st">'exposure_score'</span>].isna(), <span class="st">'exposure_gradient'</span>] <span class="op">=</span> <span class="st">'Sem classificação'</span></span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sem match:     </span><span class="sc">{</span>n_sem_match<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>n_sem_match<span class="op">/</span><span class="bu">len</span>(df_crosswalked)<span class="sc">:.1%}</span><span class="ss">)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>PNAD: 207,901 observações
ILO:  427 ocupações ISCO-08

Códigos ILO: 4d=427, 3d=127, 2d=40, 1d=9

Match 4-digit: 203,617 (97.9%)
Match 3-digit: 2,613 (1.3%)
Match 2-digit: 0 (0.0%)
Match 1-digit: 0 (0.0%)
Sem match:     1,671 (0.8%)</code></pre>
</div>
</div>
</section>
</section>
<section id="a.-verificar-crosswalk-cod-isco-08" class="level3" data-number="1.13">
<h3 data-number="1.13" class="anchored" data-anchor-id="a.-verificar-crosswalk-cod-isco-08"><span class="header-section-number">1.13</span> 5a. Verificar Crosswalk COD → ISCO-08</h3>
<p>Verificar: cobertura do crosswalk (percentual de linhas com ISCO preenchido).</p>
<div id="ae624efd" class="cell" data-execution_count="59">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.5b - Preparação de Dados - Verificar Crosswalk COD → ISCO-08</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHECKPOINT - Crosswalk COD → ISCO-08"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Cobertura total</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>coverage <span class="op">=</span> df_crosswalked[<span class="st">'exposure_score'</span>].notna().mean()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Cobertura total: </span><span class="sc">{</span>coverage<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coverage <span class="op">&lt;</span> <span class="fl">0.90</span>:</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: Cobertura </span><span class="sc">{</span>coverage<span class="sc">:.1%}</span><span class="ss"> abaixo de 90%"</span>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribuição por nível de match</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por nível de match:"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> level, count <span class="kw">in</span> df_crosswalked[<span class="st">'match_level'</span>].value_counts().items():</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> count <span class="op">/</span> <span class="bu">len</span>(df_crosswalked) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>level<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>count<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># FIX 3: Verificar concentração em match genérico (fallback)</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>n_total <span class="op">=</span> <span class="bu">len</span>(df_crosswalked)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>n_generic <span class="op">=</span> df_crosswalked[<span class="st">'match_level'</span>].isin([<span class="st">'1-digit'</span>, <span class="st">'2-digit'</span>]).<span class="bu">sum</span>()</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>pct_generic <span class="op">=</span> n_generic <span class="op">/</span> n_total <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Match genérico (1-digit + 2-digit): </span><span class="sc">{</span>n_generic<span class="sc">:,}</span><span class="ss"> (</span><span class="sc">{</span>pct_generic<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pct_generic <span class="op">&gt;</span> <span class="dv">5</span>:</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  WARNING: </span><span class="sc">{</span>pct_generic<span class="sc">:.1f}</span><span class="ss">% caiu em match genérico (&gt;5%). "</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>          <span class="st">"Scores podem não refletir a ocupação real."</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  OK: Apenas </span><span class="sc">{</span>pct_generic<span class="sc">:.1f}</span><span class="ss">% em match genérico."</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Estatísticas de score</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Estatísticas do exposure_score:"</span>)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Média:  </span><span class="sc">{</span>df_crosswalked[<span class="st">'exposure_score'</span>]<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Std:    </span><span class="sc">{</span>df_crosswalked[<span class="st">'exposure_score'</span>]<span class="sc">.</span>std()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Min:    </span><span class="sc">{</span>df_crosswalked[<span class="st">'exposure_score'</span>]<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Max:    </span><span class="sc">{</span>df_crosswalked[<span class="st">'exposure_score'</span>]<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check: exposição por grande grupo</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Exposição média por grande grupo (sanity check):"</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>exp_grupos <span class="op">=</span> df_crosswalked.groupby(<span class="st">'grande_grupo'</span>).<span class="bu">apply</span>(</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: weighted_mean(x[<span class="st">'exposure_score'</span>].dropna(), x.loc[x[<span class="st">'exposure_score'</span>].notna(), <span class="st">'peso'</span>])</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>).sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grupo, score <span class="kw">in</span> exp_grupos.items():</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>grupo<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>score<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Validações de sanidade</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">VALIDAÇÃO DE SANIDADE:"</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'Profissionais das ciências'</span> <span class="kw">in</span> exp_grupos.index:</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> exp_grupos[<span class="st">'Profissionais das ciências'</span>]</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="op">&gt;</span> <span class="fl">0.30</span>:</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  OK - Profissionais das ciências com exposição ALTA (</span><span class="sc">{</span>val<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  WARNING: Profissionais das ciências com exposição BAIXA (</span><span class="sc">{</span>val<span class="sc">:.3f}</span><span class="ss">). Esperado &gt; 0.30"</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'Ocupações elementares'</span> <span class="kw">in</span> exp_grupos.index:</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>    val <span class="op">=</span> exp_grupos[<span class="st">'Ocupações elementares'</span>]</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> val <span class="op">&lt;</span> <span class="fl">0.20</span>:</span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  OK - Ocupações elementares com exposição BAIXA (</span><span class="sc">{</span>val<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  WARNING: Ocupações elementares com exposição ALTA (</span><span class="sc">{</span>val<span class="sc">:.3f}</span><span class="ss">). Esperado &lt; 0.20"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CHECKPOINT - Crosswalk COD → ISCO-08
============================================================

Cobertura total: 99.2%

Distribuição por nível de match:
  4-digit: 203,617 (97.9%)
  3-digit: 2,613 (1.3%)

Match genérico (1-digit + 2-digit): 0 (0.0%)
  OK: Apenas 0.0% em match genérico.

Estatísticas do exposure_score:
  Média:  0.265
  Std:    0.144
  Min:    0.090
  Max:    0.700

Exposição média por grande grupo (sanity check):
  Apoio administrativo: 0.554
  Dirigentes e gerentes: 0.400
  Profissionais das ciências: 0.353
  Técnicos nível médio: 0.345
  Serviços e vendedores: 0.305
  Operadores de máquinas: 0.223
  Agropecuária qualificada: 0.174
  Indústria qualificada: 0.151
  Ocupações elementares: 0.130

VALIDAÇÃO DE SANIDADE:
  OK - Profissionais das ciências com exposição ALTA (0.353)
  OK - Ocupações elementares com exposição BAIXA (0.130)</code></pre>
</div>
</div>
</section>
<section id="merge-final-pnad-índice-ilo" class="level3" data-number="1.14">
<h3 data-number="1.14" class="anchored" data-anchor-id="merge-final-pnad-índice-ilo"><span class="header-section-number">1.14</span> 6. Merge final – PNAD + índice ILO</h3>
<p>Juntar a base PNAD (com ISCO-08) ao índice ILO por código de ocupação. Gera a base analítica final da Etapa 1. <strong>Saída:</strong> <code>data/output/pnad_ilo_merged.csv</code></p>
<section id="classificação-de-exposição" class="level4" data-number="1.14.1">
<h4 data-number="1.14.1" class="anchored" data-anchor-id="classificação-de-exposição"><span class="header-section-number">1.14.1</span> Classificação de exposição</h4>
<p>Utilizamos a classificação oficial do WP140 da OIT (Tabela 5), que categoriza ocupações em 6 níveis de exposição com base em critérios bivariados — a média (μ) e o desvio-padrão (σ) dos scores de tarefa:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Categoria</th>
<th>Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Not Exposed</td>
<td>Exposição negligenciável</td>
</tr>
<tr class="even">
<td>Minimal Exposure</td>
<td>Exposição mínima</td>
</tr>
<tr class="odd">
<td>Gradient 1</td>
<td>Exposição baixa (alto potencial de aumento de produtividade)</td>
</tr>
<tr class="even">
<td>Gradient 2</td>
<td>Exposição moderada-baixa</td>
</tr>
<tr class="odd">
<td>Gradient 3</td>
<td>Exposição moderada-alta</td>
</tr>
<tr class="even">
<td>Gradient 4</td>
<td>Exposição alta (maior potencial de automação)</td>
</tr>
</tbody>
</table>
<p>Esta classificação vem pré-computada na coluna <code>potential25</code> do dataset publicado pela OIT (Gmyrek, Berg &amp; Cappelli, 2025). Verificamos a consistência reproduzindo a lógica bivariada da Tabela 5, obtendo 99,1% de concordância (423/427 ocupações). Os 4 mismatches são casos de fronteira.</p>
<p>Para ocupações com match hierárquico (3 dígitos), onde não há classificação individual disponível, atribuímos a categoria “Sem classificação”. O score numérico (<code>exposure_score</code>) permanece disponível para essas ocupações.</p>
<div id="l5medrxgu7r" class="cell" data-execution_count="60">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1.6 - Preparação de Dados - Merge final PNAD + ILO</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> df_crosswalked.copy()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Checkpoint de qualidade do merge</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>n_com_score <span class="op">=</span> df_final[<span class="st">'exposure_score'</span>].notna().<span class="bu">sum</span>()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>n_sem_score <span class="op">=</span> df_final[<span class="st">'exposure_score'</span>].isna().<span class="bu">sum</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>pct_pop_perdida <span class="op">=</span> df_final.loc[df_final[<span class="st">'exposure_score'</span>].isna(), <span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> df_final[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CHECKPOINT - Qualidade do Merge"</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Observações totais:     </span><span class="sc">{</span><span class="bu">len</span>(df_final)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Com score de exposição: </span><span class="sc">{</span>n_com_score<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sem score (NaN):        </span><span class="sc">{</span>n_sem_score<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"% pop. sem score:       </span><span class="sc">{</span>pct_pop_perdida<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Distribuição por gradiente ILO (potential25)</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por gradiente ILO (potential25):"</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grad, peso <span class="kw">in</span> df_final.groupby(<span class="st">'exposure_gradient'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).items():</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>grad<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Quintis e decis de EXPOSIÇÃO — ponderados por peso amostral</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Usa weighted_qcut (definida na célula 1) para que cada faixa represente</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a><span class="co"># ~20% (quintis) ou ~10% (decis) da POPULAÇÃO, não da amostra.</span></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>mask_valid <span class="op">=</span> df_final[<span class="st">'exposure_score'</span>].notna()</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>df_final.loc[mask_valid, <span class="st">'quintil_exposure'</span>] <span class="op">=</span> weighted_qcut(</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    df_final.loc[mask_valid, <span class="st">'exposure_score'</span>],</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>    df_final.loc[mask_valid, <span class="st">'peso'</span>],</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Q1 (Baixa)'</span>, <span class="st">'Q2'</span>, <span class="st">'Q3'</span>, <span class="st">'Q4'</span>, <span class="st">'Q5 (Alta)'</span>],</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>df_final.loc[mask_valid, <span class="st">'decil_exposure'</span>] <span class="op">=</span> weighted_qcut(</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    df_final.loc[mask_valid, <span class="st">'exposure_score'</span>],</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    df_final.loc[mask_valid, <span class="st">'peso'</span>],</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    q<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="ss">f'D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)],</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar distribuição populacional dos quintis de exposição</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">População por quintil de exposição (deve ser ~20</span><span class="sc">% c</span><span class="st">ada):"</span>)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q, peso <span class="kw">in</span> df_final.groupby(<span class="st">'quintil_exposure'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().items():</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> peso <span class="op">/</span> df_final.loc[mask_valid, <span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>q<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões (</span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregação setorial — CNAE Domiciliar 2.0, Seções A-T (IBGE)</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Usa CNAE_SETOR_MAP definido na célula de configuração.</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">'cnae_2d'</span>] <span class="op">=</span> df_final[<span class="st">'grupamento_atividade'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>[:<span class="dv">2</span>]</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">'setor_agregado'</span>] <span class="op">=</span> df_final[<span class="st">'cnae_2d'</span>].<span class="bu">map</span>(CNAE_SETOR_MAP).fillna(<span class="st">'Outros Serviços'</span>)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Flag de setores críticos para IA</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Ref: Gmyrek et al. (2024); Eloundou et al. (2023)</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>df_final[<span class="st">'setor_critico_ia'</span>] <span class="op">=</span> df_final[<span class="st">'setor_agregado'</span>].isin(SETORES_CRITICOS_IA).astype(<span class="bu">int</span>)</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Setores: </span><span class="sc">{</span>df_final[<span class="st">'setor_agregado'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> categorias"</span>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Trabalhadores em setores críticos IA: </span><span class="sc">{</span>df_final<span class="sc">.</span>loc[df_final[<span class="st">'setor_critico_ia'</span>]<span class="op">==</span><span class="dv">1</span>, <span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Distribuição por setor:"</span>)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> setor, peso <span class="kw">in</span> df_final.groupby(<span class="st">'setor_agregado'</span>)[<span class="st">'peso'</span>].<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).items():</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>    flag <span class="op">=</span> <span class="st">" *"</span> <span class="cf">if</span> setor <span class="kw">in</span> SETORES_CRITICOS_IA <span class="cf">else</span> <span class="st">""</span></span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>setor<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>peso<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões</span><span class="sc">{</span>flag<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecionar colunas finais e salvar</span></span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a>cols_output <span class="op">=</span> [</span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ano'</span>, <span class="st">'trimestre'</span>, <span class="st">'sigla_uf'</span>, <span class="st">'regiao'</span>,</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sexo'</span>, <span class="st">'sexo_texto'</span>, <span class="st">'idade'</span>, <span class="st">'faixa_etaria'</span>,</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">'raca_cor'</span>, <span class="st">'raca_agregada'</span>, <span class="st">'nivel_instrucao'</span>,</span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">'cod_ocupacao'</span>, <span class="st">'grande_grupo'</span>,</span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grupamento_atividade'</span>, <span class="st">'setor_agregado'</span>, <span class="st">'setor_critico_ia'</span>,</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'posicao_ocupacao'</span>, <span class="st">'formal'</span>, <span class="st">'tem_renda'</span>,</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rendimento_habitual'</span>, <span class="st">'rendimento_winsor'</span>, <span class="st">'rendimento_efetivo'</span>,</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'horas_habituais'</span>, <span class="st">'horas_efetivas'</span>,</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">'faixa_renda_sm'</span>,</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">'peso'</span>,</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score'</span>, <span class="st">'exposure_gradient'</span>, <span class="st">'match_level'</span>,</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">'quintil_exposure'</span>, <span class="st">'decil_exposure'</span>,</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>df_final <span class="op">=</span> df_final[[c <span class="cf">for</span> c <span class="kw">in</span> cols_output <span class="cf">if</span> c <span class="kw">in</span> df_final.columns]]</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> DATA_OUTPUT <span class="op">/</span> <span class="st">"pnad_ilo_merged.csv"</span></span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>df_final.to_csv(output_path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a><span class="co"># Resumo final</span></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'='</span> <span class="op">*</span> <span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BASE FINAL CONSOLIDADA"</span>)</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'='</span> <span class="op">*</span> <span class="dv">60</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Observações:       </span><span class="sc">{</span><span class="bu">len</span>(df_final)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Com score:         </span><span class="sc">{</span>df_final[<span class="st">'exposure_score'</span>]<span class="sc">.</span>notna()<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cobertura:         </span><span class="sc">{</span>df_final[<span class="st">'exposure_score'</span>]<span class="sc">.</span>notna()<span class="sc">.</span>mean()<span class="sc">:.1%}</span><span class="ss">"</span>)</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Colunas:           </span><span class="sc">{</span>df_final<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"População total:   </span><span class="sc">{</span>df_final[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  com renda:       </span><span class="sc">{</span>df_final<span class="sc">.</span>loc[df_final[<span class="st">'tem_renda'</span>]<span class="op">==</span><span class="dv">1</span>, <span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  sem renda:       </span><span class="sc">{</span>df_final<span class="sc">.</span>loc[df_final[<span class="st">'tem_renda'</span>]<span class="op">==</span><span class="dv">0</span>, <span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhões"</span>)</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Setores:           </span><span class="sc">{</span>df_final[<span class="st">'setor_agregado'</span>]<span class="sc">.</span>nunique()<span class="sc">}</span><span class="ss"> categorias"</span>)</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Setor crítico IA:  </span><span class="sc">{</span>df_final[<span class="st">'setor_critico_ia'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="sc">:,}</span><span class="ss"> obs"</span>)</span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Salvo em:          </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Tamanho em disco:  </span><span class="sc">{</span>output_path<span class="sc">.</span>stat()<span class="sc">.</span>st_size <span class="op">/</span> <span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> MB"</span>)</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a>df_final.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CHECKPOINT - Qualidade do Merge
============================================================
Observações totais:     207,901
Com score de exposição: 206,230
Sem score (NaN):        1,671
% pop. sem score:       0.8%

Distribuição por gradiente ILO (potential25):
  Not Exposed: 52.2 milhões
  Minimal Exposure: 15.2 milhões
  Exposed: Gradient 2: 10.0 milhões
  Exposed: Gradient 1: 8.7 milhões
  Exposed: Gradient 4: 5.0 milhões
  Exposed: Gradient 3: 4.8 milhões
  Sem classificação: 1.8 milhões

População por quintil de exposição (deve ser ~20% cada):
  Q1 (Baixa): 20.8 milhões (21.5%)
  Q2: 18.1 milhões (18.7%)
  Q3: 21.4 milhões (22.0%)
  Q4: 17.4 milhões (17.9%)
  Q5 (Alta): 19.3 milhões (19.9%)

Setores: 17 categorias
Trabalhadores em setores críticos IA: 7.8 milhões

Distribuição por setor:
  Outros Serviços: 19.1 milhões
  Ind. Transformação: 18.7 milhões
  Construção: 7.2 milhões
  Educação: 7.2 milhões
  Saúde: 6.2 milhões
  Transporte: 5.7 milhões
  Serviços Domésticos: 5.3 milhões
  Alojamento e Alimentação: 5.1 milhões
  Administração Pública: 5.0 milhões
  Serviços Administrativos: 4.6 milhões
  Serviços Profissionais: 4.3 milhões *
  Comércio: 3.2 milhões
  Informação e Comunicação: 1.9 milhões *
  Finanças e Seguros: 1.6 milhões *
  Artes e Cultura: 1.2 milhões
  Utilidades: 0.7 milhões
  Atividades Imobiliárias: 0.7 milhões

============================================================
BASE FINAL CONSOLIDADA
============================================================
Observações:       207,901
Com score:         206,230
Cobertura:         99.2%
Colunas:           31
População total:   97.8 milhões
  com renda:       96.7 milhões
  sem renda:       1.1 milhões
Setores:           17 categorias
Setor crítico IA:  13,427 obs
Salvo em:          data/output/pnad_ilo_merged.csv
Tamanho em disco:  40.0 MB
&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 207901 entries, 0 to 220090
Data columns (total 31 columns):
 #   Column                Non-Null Count   Dtype   
---  ------                --------------   -----   
 0   ano                   207901 non-null  Int64   
 1   trimestre             207901 non-null  Int64   
 2   sigla_uf              207901 non-null  object  
 3   regiao                207901 non-null  object  
 4   sexo                  207901 non-null  object  
 5   sexo_texto            207901 non-null  object  
 6   idade                 207901 non-null  Int64   
 7   faixa_etaria          207901 non-null  category
 8   raca_cor              207901 non-null  object  
 9   raca_agregada         207901 non-null  object  
 10  nivel_instrucao       207901 non-null  object  
 11  cod_ocupacao          207901 non-null  object  
 12  grande_grupo          206230 non-null  object  
 13  grupamento_atividade  207901 non-null  object  
 14  setor_agregado        207901 non-null  object  
 15  setor_critico_ia      207901 non-null  int64   
 16  posicao_ocupacao      207901 non-null  object  
 17  formal                207901 non-null  int64   
 18  tem_renda             207901 non-null  int64   
 19  rendimento_habitual   204142 non-null  float64 
 20  rendimento_winsor     204142 non-null  float64 
 21  rendimento_efetivo    204171 non-null  float64 
 22  horas_habituais       207901 non-null  Int64   
 23  horas_efetivas        207901 non-null  Int64   
 24  faixa_renda_sm        204142 non-null  category
 25  peso                  207901 non-null  float64 
 26  exposure_score        206230 non-null  float64 
 27  exposure_gradient     207901 non-null  object  
 28  match_level           206230 non-null  object  
 29  quintil_exposure      206230 non-null  category
 30  decil_exposure        206230 non-null  category
dtypes: Int64(5), category(4), float64(5), int64(3), object(14)
memory usage: 54.3+ MB</code></pre>
</div>
</div>
</section>
</section>
<section id="limitações-desta-etapa" class="level3" data-number="1.15">
<h3 data-number="1.15" class="anchored" data-anchor-id="limitações-desta-etapa"><span class="header-section-number">1.15</span> Limitações desta etapa</h3>
<ol type="1">
<li><p><strong>Crosswalk hierárquico:</strong> O match a 3 dígitos (subgrupo) suaviza diferenças entre ocupações dentro do mesmo subgrupo, afetando ~1,3% das observações. O score atribuído é a média do subgrupo, não o score específico da ocupação.</p></li>
<li><p><strong>Trimestre único:</strong> Os dados referem-se a um único trimestre (Q3/2025). Resultados podem variar sazonalmente, especialmente em setores com forte sazonalidade (agropecuária, comércio).</p></li>
<li><p><strong>Variáveis indisponíveis:</strong> As variáveis de tempo no emprego (<code>V4040</code>) e porte da empresa (<code>V4018</code>) não estão populadas na fonte utilizada (Base dos Dados/BigQuery) para o período analisado, limitando análises de estabilidade ocupacional e adoção de IA por tamanho de empresa.</p></li>
<li><p><strong>Índice global aplicado ao Brasil:</strong> O índice da OIT foi desenvolvido com foco global e pode não capturar especificidades do mercado de trabalho brasileiro, como a elevada informalidade (~40% da força de trabalho) e diferenças na adoção tecnológica entre setores formais e informais.</p></li>
<li><p><strong>Exposição ≠ impacto:</strong> O índice mede potencial de exposição das tarefas à IA generativa, não o impacto efetivo. A materialização do impacto depende de fatores como velocidade de adoção tecnológica, regulação, custos de implementação e respostas institucionais.</p></li>
</ol>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>