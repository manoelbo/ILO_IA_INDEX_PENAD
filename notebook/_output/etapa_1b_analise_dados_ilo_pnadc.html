<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ETAPA 1 - Análise Descritiva da Exposição de IA Generativa com ILO Index e PNADc</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/clipboard/clipboard.min.js"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/popper.min.js"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/anchor.min.js"></script>
<link href="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="etapa_1b_analise_dados_ilo_pnadc_files/libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="etapa_1b_analise_dados_ilo_pnadc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="etapa_1b_analise_dados_ilo_pnadc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="etapa_1b_analise_dados_ilo_pnadc_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#análise-dos-dados" id="toc-análise-dos-dados" class="nav-link active" data-scroll-target="#análise-dos-dados"><span class="header-section-number">1</span> ANÁLISE DOS DADOS</a>
  <ul class="collapse">
  <li><a href="#contextualização" id="toc-contextualização" class="nav-link" data-scroll-target="#contextualização"><span class="header-section-number">1.1</span> Contextualização</a></li>
  <li><a href="#objetivo-da-análise" id="toc-objetivo-da-análise" class="nav-link" data-scroll-target="#objetivo-da-análise"><span class="header-section-number">1.2</span> Objetivo da Análise</a></li>
  <li><a href="#referências-principais" id="toc-referências-principais" class="nav-link" data-scroll-target="#referências-principais"><span class="header-section-number">1.3</span> Referências principais</a></li>
  <li><a href="#configuração-do-ambiente" id="toc-configuração-do-ambiente" class="nav-link" data-scroll-target="#configuração-do-ambiente"><span class="header-section-number">1.4</span> 1. Configuração do ambiente</a></li>
  <li><a href="#perfil-da-exposicao" id="toc-perfil-da-exposicao" class="nav-link" data-scroll-target="#perfil-da-exposicao"><span class="header-section-number">1.5</span> 2. Perfil da exposicao</a></li>
  <li><a href="#desigualdade-e-renda" id="toc-desigualdade-e-renda" class="nav-link" data-scroll-target="#desigualdade-e-renda"><span class="header-section-number">1.6</span> 3. Desigualdade e renda</a></li>
  <li><a href="#genero-e-raca" id="toc-genero-e-raca" class="nav-link" data-scroll-target="#genero-e-raca"><span class="header-section-number">1.7</span> 4. Genero e raca</a></li>
  <li><a href="#b.-idade-e-escolaridade" id="toc-b.-idade-e-escolaridade" class="nav-link" data-scroll-target="#b.-idade-e-escolaridade"><span class="header-section-number">1.8</span> 4b. Idade e escolaridade</a></li>
  <li><a href="#formalidade" id="toc-formalidade" class="nav-link" data-scroll-target="#formalidade"><span class="header-section-number">1.9</span> 5. Formalidade</a></li>
  <li><a href="#b.-augmentation-vs.-automacao" id="toc-b.-augmentation-vs.-automacao" class="nav-link" data-scroll-target="#b.-augmentation-vs.-automacao"><span class="header-section-number">1.10</span> 5b. Augmentation vs.&nbsp;Automacao</a></li>
  <li><a href="#setor-e-ocupacao" id="toc-setor-e-ocupacao" class="nav-link" data-scroll-target="#setor-e-ocupacao"><span class="header-section-number">1.11</span> 6. Setor e ocupacao</a></li>
  <li><a href="#b.-fluxo-escolaridade---ocupacao---gradiente-de-exposicao" id="toc-b.-fluxo-escolaridade---ocupacao---gradiente-de-exposicao" class="nav-link" data-scroll-target="#b.-fluxo-escolaridade---ocupacao---gradiente-de-exposicao"><span class="header-section-number">1.12</span> 6b. Fluxo: Escolaridade -&gt; Ocupacao -&gt; Gradiente de Exposicao</a></li>
  <li><a href="#regiao" id="toc-regiao" class="nav-link" data-scroll-target="#regiao"><span class="header-section-number">1.13</span> 7. Regiao</a></li>
  <li><a href="#regiao-1" id="toc-regiao-1" class="nav-link" data-scroll-target="#regiao-1"><span class="header-section-number">1.14</span> 7. Regiao</a></li>
  <li><a href="#regiao-2" id="toc-regiao-2" class="nav-link" data-scroll-target="#regiao-2"><span class="header-section-number">1.15</span> 7. Regiao</a></li>
  <li><a href="#regiao-3" id="toc-regiao-3" class="nav-link" data-scroll-target="#regiao-3"><span class="header-section-number">1.16</span> 7. Regiao</a></li>
  <li><a href="#regiao-4" id="toc-regiao-4" class="nav-link" data-scroll-target="#regiao-4"><span class="header-section-number">1.17</span> 7. Regiao</a></li>
  <li><a href="#regiao-5" id="toc-regiao-5" class="nav-link" data-scroll-target="#regiao-5"><span class="header-section-number">1.18</span> 7. Regiao</a></li>
  <li><a href="#regiao-6" id="toc-regiao-6" class="nav-link" data-scroll-target="#regiao-6"><span class="header-section-number">1.19</span> 7. Regiao</a></li>
  <li><a href="#regiao-7" id="toc-regiao-7" class="nav-link" data-scroll-target="#regiao-7"><span class="header-section-number">1.20</span> 7. Regiao</a></li>
  <li><a href="#c.-decomposicao-shift-share-regional" id="toc-c.-decomposicao-shift-share-regional" class="nav-link" data-scroll-target="#c.-decomposicao-shift-share-regional"><span class="header-section-number">1.21</span> 7c. Decomposicao Shift-Share Regional</a></li>
  <li><a href="#b.-região-mapas" id="toc-b.-região-mapas" class="nav-link" data-scroll-target="#b.-região-mapas"><span class="header-section-number">1.22</span> 7b. Região (Mapas)</a></li>
  <li><a href="#d.-indice-de-vulnerabilidade-composta" id="toc-d.-indice-de-vulnerabilidade-composta" class="nav-link" data-scroll-target="#d.-indice-de-vulnerabilidade-composta"><span class="header-section-number">1.23</span> 7d. Indice de Vulnerabilidade Composta</a></li>
  <li><a href="#analise-multivariada" id="toc-analise-multivariada" class="nav-link" data-scroll-target="#analise-multivariada"><span class="header-section-number">1.24</span> 8. Analise multivariada</a></li>
  <li><a href="#sintese-e-conclusoes" id="toc-sintese-e-conclusoes" class="nav-link" data-scroll-target="#sintese-e-conclusoes"><span class="header-section-number">1.25</span> 9. Sintese e conclusoes</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="etapa_1b_analise_dados_ilo_pnadc.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ETAPA 1 - Análise Descritiva da Exposição de IA Generativa com ILO Index e PNADc</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="análise-dos-dados" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="análise-dos-dados"><span class="header-section-number">1</span> ANÁLISE DOS DADOS</h2>
<p><strong>Dissertação:</strong> Inteligência Artificial Generativa e o Mercado de Trabalho Brasileiro: Uma Análise de Exposição Ocupacional e seus Efeitos Distributivos.</p>
<p><strong>Aluno:</strong> Manoel Brasil Orlandi</p>
<section id="contextualização" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="contextualização"><span class="header-section-number">1.1</span> Contextualização</h3>
<p>A rápida difusão de modelos de IA generativa (LLMs, geradores de imagem/código) levanta questões centrais sobre seus impactos no mercado de trabalho. Para mensurar esse potencial de impacto, a Organização Internacional do Trabalho (OIT) criou índice de exposição ocupacional à IA generativa, publicado como <em>Working Paper</em> 140 (WP140). O índice atribui scores de exposição a cada ocupação da classificação ISCO-08, com base na avaliação de suas tarefas constituintes por modelos de linguagem e validação humana.</p>
<p>Este notebook faz a análise e descrição populacional usando como base os dados <code>pnad_ilo_merged.csv</code> que junta os microdados da <strong>PNAD Contínua</strong> (Pesquisa Nacional por Amostra de Domicílios Contínua, IBGE, 3º trimestre de 2025) ao **índice de exposição à IA generativa da OIT* e foram preparados no notebook <code>etapa_1a_preparacao_dados_ilo_pnadc.ipynb</code>.</p>
<blockquote class="blockquote">
<p><strong>Nota:</strong> O salário mínimo vigente de R$ 1.518 segue o Decreto nº 12.342/2025. Os dados da PNADc referem-se ao 3º trimestre de 2025 e são combinados ao índice de exposição ILO WP140 (versão 2025). Como o índice foi construído para a classificação ISCO-08, utilizou-se um crosswalk COD→ISCO-08 que introduz potencial erro de medida (ver Limitações, Seção 9).</p>
</blockquote>
</section>
<section id="objetivo-da-análise" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="objetivo-da-análise"><span class="header-section-number">1.2</span> Objetivo da Análise</h3>
<p><strong>Perfil da exposição</strong>: Distribuição da população por quintil/decil de exposição; média ponderada de exposure_score por grupo.</p>
<p><strong>Desigualdade e renda</strong>: Rendimento médio (e mediano) ponderado por quintil de exposição; razão renda Q5/Q1 de exposição.</p>
<p><strong>Gênero e raça</strong>: % de mulheres e de negros por quintil de exposição; exposição média por sexo e raça</p>
<p><strong>Formalidade</strong>: % formal por quintil de exposição; exposição média no formal vs informal</p>
<p><strong>Setor e ocupação</strong>: Exposição média por setor_agregado e por grande_grupo; concentração em setores críticos IA.</p>
<p><strong>Região</strong>: Exposição média por região; população em alta exposição por UF/região.</p>
<p><strong>Idade e instrução</strong>: Exposição média por faixa etária e nível de instrução.</p>
<p><strong>Augmentation vs.&nbsp;Automação</strong>: Comparação entre trabalhadores em gradientes de complementaridade (G1-G2) e transformação (G3-G4).</p>
</section>
<section id="referências-principais" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="referências-principais"><span class="header-section-number">1.3</span> Referências principais</h3>
<ul>
<li>Gmyrek, P., Berg, J. &amp; Cappelli, D. (2025). <em>Generative AI and Jobs: An updated global assessment of potential effects on job quantity and quality</em>. ILO Working Paper 140.</li>
<li>IBGE. <em>Pesquisa Nacional por Amostra de Domicílios Contínua</em> (PNADc), 3º trimestre de 2025.</li>
</ul>
<blockquote class="blockquote">
<p><strong>Conexão com WP140:</strong> O índice de exposição da OIT segue a abordagem task-based (Autor, 2015; Acemoglu &amp; Restrepo, 2019), onde cada ocupação é decomposta em tarefas e cada tarefa é avaliada quanto à capacidade de modelos de IA generativa de realizá-la. O WP140 estende trabalhos anteriores (Felten et al., 2021; Eloundou et al., 2023) ao incorporar validação humana e distinguir entre potencial de automação e de complementaridade (augmentation).</p>
</blockquote>
</section>
<section id="configuração-do-ambiente" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="configuração-do-ambiente"><span class="header-section-number">1.4</span> 1. Configuração do ambiente</h3>
<p>Definir caminhos, importar bibliotecas e configurar logs.</p>
<div id="a343dec7" class="cell" data-execution_count="64">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar dependencias no kernel atual (executar apenas uma vez)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install pandas numpy pyarrow openpyxl statsmodels scipy matplotlib seaborn <span class="op">--</span>quiet</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> A new release of pip is available: <span class="ansi-red-fg">24.2</span> -&gt; <span class="ansi-green-fg">26.0.1</span>

<span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> To update, run: <span class="ansi-green-fg">python3.10 -m pip install --upgrade pip</span>

Note: you may need to restart the kernel to use updated packages.
</pre>
</div>
</div>
</div>
<div id="3cf1b06d" class="cell" data-execution_count="65">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.1 - Analise de Dados - Configuracao do ambiente</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.ticker <span class="im">as</span> mticker</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gaussian_kde, ks_2samp, linregress</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.weightstats <span class="im">import</span> DescrStatsW, CompareMeans</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.formula.api <span class="im">as</span> smf</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.max_columns'</span>, <span class="dv">40</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Estilo visual</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>sns.set_style(<span class="st">"whitegrid"</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.figsize'</span>: (<span class="dv">12</span>, <span class="dv">7</span>),</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">11</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.titlesize'</span>: <span class="dv">13</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelsize'</span>: <span class="dv">11</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.dpi'</span>: <span class="dv">100</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Caminhos</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>DATA_OUTPUT <span class="op">=</span> Path(<span class="st">"data/output"</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>DATA_INPUT  <span class="op">=</span> Path(<span class="st">"data/input"</span>)</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Parametros</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>SALARIO_MINIMO <span class="op">=</span> <span class="dv">1518</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>PNAD_ANO       <span class="op">=</span> <span class="dv">2025</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>PNAD_TRIMESTRE <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapeamentos e constantes (replicados de settings.py)</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>REGIAO_MAP <span class="op">=</span> {</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'RO'</span>: <span class="st">'Norte'</span>, <span class="st">'AC'</span>: <span class="st">'Norte'</span>, <span class="st">'AM'</span>: <span class="st">'Norte'</span>, <span class="st">'RR'</span>: <span class="st">'Norte'</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PA'</span>: <span class="st">'Norte'</span>, <span class="st">'AP'</span>: <span class="st">'Norte'</span>, <span class="st">'TO'</span>: <span class="st">'Norte'</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MA'</span>: <span class="st">'Nordeste'</span>, <span class="st">'PI'</span>: <span class="st">'Nordeste'</span>, <span class="st">'CE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'RN'</span>: <span class="st">'Nordeste'</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PB'</span>: <span class="st">'Nordeste'</span>, <span class="st">'PE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'AL'</span>: <span class="st">'Nordeste'</span>, <span class="st">'SE'</span>: <span class="st">'Nordeste'</span>, <span class="st">'BA'</span>: <span class="st">'Nordeste'</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MG'</span>: <span class="st">'Sudeste'</span>, <span class="st">'ES'</span>: <span class="st">'Sudeste'</span>, <span class="st">'RJ'</span>: <span class="st">'Sudeste'</span>, <span class="st">'SP'</span>: <span class="st">'Sudeste'</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'PR'</span>: <span class="st">'Sul'</span>, <span class="st">'SC'</span>: <span class="st">'Sul'</span>, <span class="st">'RS'</span>: <span class="st">'Sul'</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'MS'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'MT'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'GO'</span>: <span class="st">'Centro-Oeste'</span>, <span class="st">'DF'</span>: <span class="st">'Centro-Oeste'</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>GRANDES_GRUPOS <span class="op">=</span> {</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1'</span>: <span class="st">'Dirigentes e gerentes'</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">'2'</span>: <span class="st">'Profissionais das ciencias'</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3'</span>: <span class="st">'Tecnicos nivel medio'</span>,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">'4'</span>: <span class="st">'Apoio administrativo'</span>,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5'</span>: <span class="st">'Servicos e vendedores'</span>,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'6'</span>: <span class="st">'Agropecuaria qualificada'</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'7'</span>: <span class="st">'Industria qualificada'</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'8'</span>: <span class="st">'Operadores de maquinas'</span>,</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'9'</span>: <span class="st">'Ocupacoes elementares'</span>,</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>GRADIENT_ORDER <span class="op">=</span> [</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Not Exposed'</span>, <span class="st">'Minimal Exposure'</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 1'</span>, <span class="st">'Exposed: Gradient 2'</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 3'</span>, <span class="st">'Exposed: Gradient 4'</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>GRADIENT_COLORS <span class="op">=</span> {</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Not Exposed'</span>:          <span class="st">'#2ca02c'</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Minimal Exposure'</span>:     <span class="st">'#98df8a'</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 1'</span>:  <span class="st">'#aec7e8'</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 2'</span>:  <span class="st">'#ffbb78'</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 3'</span>:  <span class="st">'#ff7f0e'</span>,</span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 4'</span>:  <span class="st">'#d62728'</span>,</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sem classificacao'</span>:    <span class="st">'#d9d9d9'</span>,</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>GRADIENT_LABELS_PT <span class="op">=</span> {</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Not Exposed'</span>:          <span class="st">'Nao Exposto'</span>,</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Minimal Exposure'</span>:     <span class="st">'Exposicao Minima'</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 1'</span>:  <span class="st">'Gradiente 1 (Aumento)'</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 2'</span>:  <span class="st">'Gradiente 2'</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 3'</span>:  <span class="st">'Gradiente 3'</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Exposed: Gradient 4'</span>:  <span class="st">'Gradiente 4 (Automacao)'</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>HIGH_EXPOSURE_GRADIENTS <span class="op">=</span> [<span class="st">'Exposed: Gradient 3'</span>, <span class="st">'Exposed: Gradient 4'</span>]</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>QUINTIL_ORDER <span class="op">=</span> [<span class="st">'Q1 (Baixa)'</span>, <span class="st">'Q2'</span>, <span class="st">'Q3'</span>, <span class="st">'Q4'</span>, <span class="st">'Q5 (Alta)'</span>]</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>DECIL_ORDER <span class="op">=</span> [<span class="ss">f'D</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)]</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>NIVEL_INSTRUCAO_ORDER <span class="op">=</span> [</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Sem instrucao'</span>, <span class="st">'Fundamental incompleto'</span>, <span class="st">'Fundamental completo'</span>,</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Medio incompleto'</span>, <span class="st">'Medio completo'</span>, <span class="st">'Superior incompleto'</span>, <span class="st">'Superior completo'</span>,</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>SETORES_CRITICOS_IA <span class="op">=</span> [</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Informacao e Comunicacao'</span>, <span class="st">'Financas e Seguros'</span>, <span class="st">'Servicos Profissionais'</span>,</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Funcoes utilitarias - estatisticas ponderadas</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_mean(values, weights):</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Media ponderada (ignora NaN)."""</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.average(values[mask], weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_std(values, weights):</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Desvio-padrao ponderado (ignora NaN)."""</span></span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> np.average(values[mask], weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>    variance <span class="op">=</span> np.average((values[mask] <span class="op">-</span> avg) <span class="op">**</span> <span class="dv">2</span>, weights<span class="op">=</span>weights[mask])</span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.sqrt(variance)</span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_quantile(values, weights, quantile):</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Quantil ponderado por pesos amostrais (ignora NaN)."""</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>    sorted_idx <span class="op">=</span> np.argsort(values[mask])</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>    sorted_values <span class="op">=</span> values[mask].iloc[sorted_idx]</span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    sorted_weights <span class="op">=</span> weights[mask].iloc[sorted_idx]</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>    cumsum <span class="op">=</span> np.cumsum(sorted_weights)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    cutoff <span class="op">=</span> quantile <span class="op">*</span> cumsum.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sorted_values.iloc[np.searchsorted(cumsum, cutoff)]</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gini_coefficient(values, weights):</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Coeficiente de Gini ponderado."""</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.array(values[mask])</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> np.array(weights[mask])</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    sorted_idx <span class="op">=</span> np.argsort(x)</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    sorted_x <span class="op">=</span> x[sorted_idx]</span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    sorted_w <span class="op">=</span> w[sorted_idx]</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    cumsum_w <span class="op">=</span> np.cumsum(sorted_w)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    cumsum_wx <span class="op">=</span> np.cumsum(sorted_w <span class="op">*</span> sorted_x)</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    total_w <span class="op">=</span> cumsum_w[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    total_wx <span class="op">=</span> cumsum_wx[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> np.<span class="bu">sum</span>(cumsum_wx[:<span class="op">-</span><span class="dv">1</span>] <span class="op">*</span> sorted_w[<span class="dv">1</span>:]) <span class="op">/</span> (total_w <span class="op">*</span> total_wx)</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> B</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_ci(values, weights, alpha<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Retorna (media, IC_inferior, IC_superior) usando DescrStatsW."""</span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    mask <span class="op">=</span> <span class="op">~</span>(pd.isna(values) <span class="op">|</span> pd.isna(weights))</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mask.<span class="bu">sum</span>() <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> np.nan, np.nan, np.nan</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> DescrStatsW(data<span class="op">=</span>np.array(values[mask]), weights<span class="op">=</span>np.array(weights[mask]))</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    ci <span class="op">=</span> d.tconfint_mean(alpha<span class="op">=</span>alpha)</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d.mean, ci[<span class="dv">0</span>], ci[<span class="dv">1</span>]</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_ttest_2groups(vals_a, weights_a, vals_b, weights_b):</span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Teste t ponderado para duas amostras independentes. Retorna (t_stat, p_value)."""</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    mask_a <span class="op">=</span> <span class="op">~</span>(pd.isna(vals_a) <span class="op">|</span> pd.isna(weights_a))</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    mask_b <span class="op">=</span> <span class="op">~</span>(pd.isna(vals_b) <span class="op">|</span> pd.isna(weights_b))</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    d_a <span class="op">=</span> DescrStatsW(data<span class="op">=</span>np.array(vals_a[mask_a]), weights<span class="op">=</span>np.array(weights_a[mask_a]))</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    d_b <span class="op">=</span> DescrStatsW(data<span class="op">=</span>np.array(vals_b[mask_b]), weights<span class="op">=</span>np.array(weights_b[mask_b]))</span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    cm <span class="op">=</span> CompareMeans(d_a, d_b)</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>    t_stat, p_value, df <span class="op">=</span> cm.ttest_ind()</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> t_stat, p_value</span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weighted_cohen_d(x1, w1, x2, w2):</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""d de Cohen ponderado para dois grupos."""</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>    m1 <span class="op">=</span> np.average(x1, weights<span class="op">=</span>w1)</span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    m2 <span class="op">=</span> np.average(x2, weights<span class="op">=</span>w2)</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>    v1 <span class="op">=</span> np.average((x1 <span class="op">-</span> m1)<span class="op">**</span><span class="dv">2</span>, weights<span class="op">=</span>w1)</span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>    v2 <span class="op">=</span> np.average((x2 <span class="op">-</span> m2)<span class="op">**</span><span class="dv">2</span>, weights<span class="op">=</span>w2)</span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    n1, n2 <span class="op">=</span> w1.<span class="bu">sum</span>(), w2.<span class="bu">sum</span>()</span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    pooled_sd <span class="op">=</span> np.sqrt((n1 <span class="op">*</span> v1 <span class="op">+</span> n2 <span class="op">*</span> v2) <span class="op">/</span> (n1 <span class="op">+</span> n2))</span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (m1 <span class="op">-</span> m2) <span class="op">/</span> pooled_sd <span class="cf">if</span> pooled_sd <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="fl">0.0</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sig_stars(p):</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Retorna estrelas de significancia."""</span></span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.001</span>: <span class="cf">return</span> <span class="st">'***'</span></span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:  <span class="cf">return</span> <span class="st">'**'</span></span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:  <span class="cf">return</span> <span class="st">'*'</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">''</span></span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar dados</span></span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------------------</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(DATA_OUTPUT <span class="op">/</span> <span class="st">"pnad_ilo_merged.csv"</span>)</span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir tipos corretos</span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'cod_ocupacao'</span>] <span class="op">=</span> df[<span class="st">'cod_ocupacao'</span>].astype(<span class="bu">str</span>).<span class="bu">str</span>.zfill(<span class="dv">4</span>)</span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'quintil_exposure'</span>] <span class="op">=</span> pd.Categorical(df[<span class="st">'quintil_exposure'</span>], categories<span class="op">=</span>QUINTIL_ORDER, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'decil_exposure'</span>] <span class="op">=</span> pd.Categorical(df[<span class="st">'decil_exposure'</span>], categories<span class="op">=</span>DECIL_ORDER, ordered<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsets uteis</span></span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>df_score <span class="op">=</span> df[df[<span class="st">'exposure_score'</span>].notna()].copy()  <span class="co"># com score de exposicao</span></span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a>df_renda <span class="op">=</span> df[(df[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> df[<span class="st">'exposure_score'</span>].notna()].copy()  <span class="co"># com renda + score</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar edu_simples para uso nas analises (escolaridade simplificada)</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>edu_map <span class="op">=</span> {<span class="st">'1'</span>: <span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'2'</span>: <span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'3'</span>: <span class="st">'Fund.Comp.'</span>, <span class="st">'4'</span>: <span class="st">'Med.Inc.'</span>, <span class="st">'5'</span>: <span class="st">'Med.Comp.'</span>, <span class="st">'6'</span>: <span class="st">'Sup.Inc.'</span>, <span class="st">'7'</span>: <span class="st">'Sup.Comp.'</span>}</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>col_edu <span class="op">=</span> <span class="st">'nivel_instrucao'</span> <span class="cf">if</span> <span class="st">'nivel_instrucao'</span> <span class="kw">in</span> df_score.columns <span class="cf">else</span> <span class="st">'vd3004'</span></span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>df_score[<span class="st">'edu_simples'</span>] <span class="op">=</span> df_score[col_edu].astype(<span class="bu">str</span>).<span class="bu">map</span>(edu_map).fillna(<span class="st">'Outros'</span>)</span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CONFIGURACAO CARREGADA"</span>)</span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Observacoes totais:    </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Com score exposicao:   </span><span class="sc">{</span><span class="bu">len</span>(df_score)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Com renda + score:     </span><span class="sc">{</span><span class="bu">len</span>(df_renda)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Populacao total:       </span><span class="sc">{</span>df[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhoes"</span>)</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Periodo: </span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> Q</span><span class="sc">{</span>PNAD_TRIMESTRE<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a><span class="co"># Nota metodologica</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"NOTA METODOLOGICA sobre erros-padrao:"</span>)</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Erros-padrao e ICs tratam a amostra como aleatoria simples"</span>)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"reponderada por V1028. A PNADc usa desenho complexo com"</span>)</span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"estratificacao e conglomeracao; SEs podem ser subestimados."</span>)</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
CONFIGURACAO CARREGADA
============================================================
  Observacoes totais:    207,901
  Com score exposicao:   206,230
  Com renda + score:     202,471
  Populacao total:       97.8 milhoes
  Periodo: 2025 Q3

------------------------------------------------------------
NOTA METODOLOGICA sobre erros-padrao:
Erros-padrao e ICs tratam a amostra como aleatoria simples
reponderada por V1028. A PNADc usa desenho complexo com
estratificacao e conglomeracao; SEs podem ser subestimados.
------------------------------------------------------------</code></pre>
</div>
</div>
</section>
<section id="perfil-da-exposicao" class="level3" data-number="1.5">
<h3 data-number="1.5" class="anchored" data-anchor-id="perfil-da-exposicao"><span class="header-section-number">1.5</span> 2. Perfil da exposicao</h3>
<p>Distribuicao da populacao por quintil/decil de exposicao; media ponderada de exposure_score por grupo.</p>
<p><strong>Analises:</strong> - Histograma + KDE da distribuicao de exposicao com overlay de gradientes ILO - Tabela-resumo por gradiente ILO com top 5 ocupacoes COD - Geracao de <code>cod_ilo_merged.csv</code> - Medidas de desigualdade: Gini, P90/P10, curva de Lorenz - Comparacao com literatura internacional (com ICs)</p>
<blockquote class="blockquote">
<p><strong>Nota sobre intervalos de confiança:</strong> Os ICs reportados nesta seção tratam a amostra como aleatória simples reponderada (SRS com pesos V1028). Como a PNADc utiliza desenho amostral complexo (estratificação + conglomeração), os ICs reais são mais amplos. Os valores reportados devem ser interpretados como limites inferiores da incerteza.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Nota sobre gradientes ILO:</strong> Os thresholds de classificação dos gradientes de exposição (Not Exposed, Minimal Exposure, Gradients 1-4) seguem exatamente a definição do WP140 (Gmyrek et al., 2025, Tabela 1, p.&nbsp;14), baseada nos scores de exposição e nos indicadores SML (Save, Modify, Learn).</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Sobre os gradientes (WP140, Seção 2.3):</strong> Os gradientes de exposição refletem não apenas o nível de exposição mas o TIPO de impacto esperado. Gradientes 1-2 indicam que a IA é mais propensa a complementar o trabalho humano (augmentation), enquanto Gradientes 3-4 indicam maior potencial de transformação das tarefas ou substituição. Essa distinção é fundamental para políticas públicas: o mesmo nível de exposição pode representar oportunidade (augmentation) ou risco (automação), dependendo do contexto ocupacional. Referência: WP140, Figura 2 (p.&nbsp;14) e Tabela 1 (p.&nbsp;13).</p>
</blockquote>
<div id="aa473c1c" class="cell" data-execution_count="66">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.2 - Analise de Dados - Perfil da exposicao</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.1 - Distribuicao da exposicao: histograma + KDE + gradientes</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Painel A: Histograma ponderado com KDE ---</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>scores <span class="op">=</span> df_score[<span class="st">'exposure_score'</span>].values</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>pesos <span class="op">=</span> df_score[<span class="st">'peso'</span>].values</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>ax.hist(scores, bins<span class="op">=</span><span class="dv">40</span>, weights<span class="op">=</span>pesos<span class="op">/</span><span class="fl">1e6</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># KDE ponderado</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>kde <span class="op">=</span> gaussian_kde(scores, weights<span class="op">=</span>pesos<span class="op">/</span>pesos.<span class="bu">sum</span>())</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>x_kde <span class="op">=</span> np.linspace(scores.<span class="bu">min</span>(), scores.<span class="bu">max</span>(), <span class="dv">200</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Escalar KDE para a mesma area do histograma</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>bin_width <span class="op">=</span> (scores.<span class="bu">max</span>() <span class="op">-</span> scores.<span class="bu">min</span>()) <span class="op">/</span> <span class="dv">40</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>kde_scaled <span class="op">=</span> kde(x_kde) <span class="op">*</span> (pesos.<span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span>) <span class="op">*</span> bin_width</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>ax.plot(x_kde, kde_scaled, color<span class="op">=</span><span class="st">'darkred'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'KDE'</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>media_exp <span class="op">=</span> weighted_mean(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>])</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>ax.axvline(media_exp, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>           label<span class="op">=</span><span class="ss">f'Media = </span><span class="sc">{</span>media_exp<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Score de Exposicao'</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Trabalhadores (milhoes)'</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'(A) Distribuicao da Exposicao a IA Generativa'</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Painel B: Populacao por gradiente ILO ---</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>grad_data <span class="op">=</span> []</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grad <span class="kw">in</span> GRADIENT_ORDER:</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> grad]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>        pop <span class="op">=</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>        grad_data.append({</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Gradiente'</span>: GRADIENT_LABELS_PT.get(grad, grad),</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pop'</span>: pop,</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Color'</span>: GRADIENT_COLORS.get(grad, <span class="st">'#999999'</span>),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>grad_df <span class="op">=</span> pd.DataFrame(grad_data)</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> ax.barh(grad_df[<span class="st">'Gradiente'</span>], grad_df[<span class="st">'Pop'</span>], color<span class="op">=</span>grad_df[<span class="st">'Color'</span>],</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>               edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, pop <span class="kw">in</span> <span class="bu">zip</span>(bars, grad_df[<span class="st">'Pop'</span>]):</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    ax.text(bar.get_width() <span class="op">+</span> <span class="fl">0.3</span>, bar.get_y() <span class="op">+</span> bar.get_height()<span class="op">/</span><span class="dv">2</span>,</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>            <span class="ss">f'</span><span class="sc">{</span>pop<span class="sc">:.1f}</span><span class="ss">M'</span>, va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Trabalhadores (milhoes)'</span>)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'(B) Populacao por Gradiente ILO'</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>ax.invert_yaxis()</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.2 - Tabela-resumo por gradiente ILO + top 5 ocupacoes</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PERFIL DA EXPOSICAO POR GRADIENTE ILO"</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>total_pop <span class="op">=</span> df_score[<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grad <span class="kw">in</span> GRADIENT_ORDER:</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> grad]</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    pop <span class="op">=</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    pct <span class="op">=</span> pop <span class="op">/</span> total_pop <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    mean_exp, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>    sub_renda <span class="op">=</span> sub[sub[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>    mean_renda <span class="op">=</span> weighted_mean(sub_renda[<span class="st">'rendimento_habitual'</span>], sub_renda[<span class="st">'peso'</span>]) <span class="cf">if</span> <span class="bu">len</span>(sub_renda) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    pct_formal <span class="op">=</span> weighted_mean(sub[<span class="st">'formal'</span>], sub[<span class="st">'peso'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    pct_mulher <span class="op">=</span> weighted_mean((sub[<span class="st">'sexo_texto'</span>] <span class="op">==</span> <span class="st">'Mulher'</span>).astype(<span class="bu">int</span>), sub[<span class="st">'peso'</span>]) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    label <span class="op">=</span> GRADIENT_LABELS_PT.get(grad, grad)</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">--- </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>grad<span class="sc">}</span><span class="ss">) ---"</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Populacao: </span><span class="sc">{</span>pop<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhoes (</span><span class="sc">{</span>pct<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Exposicao media: </span><span class="sc">{</span>mean_exp<span class="sc">:.3f}</span><span class="ss"> [IC 95%: </span><span class="sc">{</span>ci_lo<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span>ci_hi<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Renda media: R$ </span><span class="sc">{</span>mean_renda<span class="sc">:,.0f}</span><span class="ss">"</span> <span class="cf">if</span> <span class="kw">not</span> np.isnan(mean_renda) <span class="cf">else</span> <span class="st">"  Renda media: N/D"</span>)</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  % Formal: </span><span class="sc">{</span>pct_formal<span class="sc">:.1f}</span><span class="ss">% | % Mulheres: </span><span class="sc">{</span>pct_mulher<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Top 5 ocupacoes por populacao neste gradiente</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    top5 <span class="op">=</span> (sub.groupby(<span class="st">'cod_ocupacao'</span>)</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>            .agg(pop_ocu<span class="op">=</span>(<span class="st">'peso'</span>, <span class="st">'sum'</span>), exp_mean<span class="op">=</span>(<span class="st">'exposure_score'</span>, <span class="st">'mean'</span>))</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>            .sort_values(<span class="st">'pop_ocu'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>            .head(<span class="dv">5</span>))</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Top 5 ocupacoes (COD):"</span>)</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cod, row <span class="kw">in</span> top5.iterrows():</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>        gg <span class="op">=</span> GRANDES_GRUPOS.get(cod[<span class="dv">0</span>], <span class="st">''</span>)</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lookup nome da ocupacao se disponivel</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>        nome_ocup <span class="op">=</span> <span class="st">''</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'descricao_ocupacao'</span> <span class="kw">in</span> df_score.columns:</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>            match <span class="op">=</span> df_score[df_score[<span class="st">'cod_ocupacao'</span>] <span class="op">==</span> cod][<span class="st">'descricao_ocupacao'</span>]</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>            nome_ocup <span class="op">=</span> match.iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(match) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">''</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nome_ocup:</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"    </span><span class="sc">{</span>cod<span class="sc">}</span><span class="ss"> - </span><span class="sc">{</span>nome_ocup<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>gg<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>row[<span class="st">'pop_ocu'</span>]<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.2f}</span><span class="ss">M trabalhadores, score=</span><span class="sc">{</span>row[<span class="st">'exp_mean'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"    </span><span class="sc">{</span>cod<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>gg<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>row[<span class="st">'pop_ocu'</span>]<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.2f}</span><span class="ss">M trabalhadores, score=</span><span class="sc">{</span>row[<span class="st">'exp_mean'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.3 - Gerar cod_ilo_merged.csv</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>cod_summary <span class="op">=</span> (df_score.groupby(<span class="st">'cod_ocupacao'</span>)</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>    .agg(</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>        grande_grupo<span class="op">=</span>(<span class="st">'grande_grupo'</span>, <span class="st">'first'</span>),</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>        exposure_score<span class="op">=</span>(<span class="st">'exposure_score'</span>, <span class="st">'mean'</span>),</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>        exposure_gradient<span class="op">=</span>(<span class="st">'exposure_gradient'</span>, <span class="st">'first'</span>),</span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>        n_obs<span class="op">=</span>(<span class="st">'peso'</span>, <span class="st">'count'</span>),</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>        pop_milhoes<span class="op">=</span>(<span class="st">'peso'</span>, <span class="kw">lambda</span> x: x.<span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span>),</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>        renda_media<span class="op">=</span>(<span class="st">'rendimento_habitual'</span>, <span class="kw">lambda</span> x: weighted_mean(x, df_score.loc[x.index, <span class="st">'peso'</span>])),</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>        pct_formal<span class="op">=</span>(<span class="st">'formal'</span>, <span class="kw">lambda</span> x: weighted_mean(x, df_score.loc[x.index, <span class="st">'peso'</span>]) <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    .sort_values(<span class="st">'pop_milhoes'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>cod_output <span class="op">=</span> DATA_OUTPUT <span class="op">/</span> <span class="st">"cod_ilo_merged.csv"</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>cod_summary.to_csv(cod_output)</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Tabela cod_ilo_merged.csv salva em: </span><span class="sc">{</span>cod_output<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span><span class="bu">len</span>(cod_summary)<span class="sc">}</span><span class="ss"> ocupacoes | Top 5:"</span>)</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>display(cod_summary.head())</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.4 - Desigualdade: Gini, P90/P10, Curva de Lorenz</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>gini_exp <span class="op">=</span> gini_coefficient(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>])</span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>p90 <span class="op">=</span> weighted_quantile(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>], <span class="fl">0.90</span>)</span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>p10 <span class="op">=</span> weighted_quantile(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>], <span class="fl">0.10</span>)</span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>p50 <span class="op">=</span> weighted_quantile(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>], <span class="fl">0.50</span>)</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>ratio_p90_p10 <span class="op">=</span> p90 <span class="op">/</span> p10 <span class="cf">if</span> p10 <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Media geral com IC</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>mean_geral, ci_lo_geral, ci_hi_geral <span class="op">=</span> weighted_ci(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>])</span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"METRICAS DE DESIGUALDADE NA EXPOSICAO"</span>)</span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Media: </span><span class="sc">{</span>mean_geral<span class="sc">:.3f}</span><span class="ss"> [IC 95%: </span><span class="sc">{</span>ci_lo_geral<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span>ci_hi_geral<span class="sc">:.3f}</span><span class="ss">]"</span>)</span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mediana: </span><span class="sc">{</span>p50<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gini: </span><span class="sc">{</span>gini_exp<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  P90/P10: </span><span class="sc">{</span>ratio_p90_p10<span class="sc">:.2f}</span><span class="ss"> (P90=</span><span class="sc">{</span>p90<span class="sc">:.3f}</span><span class="ss">, P10=</span><span class="sc">{</span>p10<span class="sc">:.3f}</span><span class="ss">)"</span>)</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="co"># Curva de Lorenz</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>vals <span class="op">=</span> np.array(df_score[<span class="st">'exposure_score'</span>])</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>wgts <span class="op">=</span> np.array(df_score[<span class="st">'peso'</span>])</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>sorted_idx <span class="op">=</span> np.argsort(vals)</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>sorted_vals <span class="op">=</span> vals[sorted_idx]</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>sorted_wgts <span class="op">=</span> wgts[sorted_idx]</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>cum_pop <span class="op">=</span> np.concatenate([[<span class="dv">0</span>], np.cumsum(sorted_wgts) <span class="op">/</span> sorted_wgts.<span class="bu">sum</span>()])</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a>cum_exp <span class="op">=</span> np.concatenate([[<span class="dv">0</span>], np.cumsum(sorted_wgts <span class="op">*</span> sorted_vals) <span class="op">/</span> (sorted_wgts <span class="op">*</span> sorted_vals).<span class="bu">sum</span>()])</span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a>ax.plot(cum_pop, cum_exp, color<span class="op">=</span><span class="st">'steelblue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'Lorenz (Gini = </span><span class="sc">{</span>gini_exp<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Igualdade perfeita'</span>)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>ax.fill_between(cum_pop, cum_exp, cum_pop, alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Fracao acumulada da populacao'</span>)</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Fracao acumulada da exposicao'</span>)</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Curva de Lorenz da Exposicao a IA Generativa'</span>)</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="co"># 2.5 - Comparacao com literatura internacional</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>n_alta <span class="op">=</span> df_score[df_score[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>pct_alta <span class="op">=</span> n_alta <span class="op">/</span> df_score[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"COMPARACAO COM LITERATURA INTERNACIONAL"</span>)</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Estudo'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Grupo'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Media'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'% Alta Exp.'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">78</span>)</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Presente (ILO 2025)'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Brasil'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span>mean_geral<span class="sc">:.3f}{</span><span class="st">''</span><span class="sc">:&gt;5}</span><span class="ss"> </span><span class="sc">{</span>pct_alta<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Gmyrek et al. (2025)'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Upper-middle-income'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'~0.29'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'--'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Gmyrek et al. (2025)'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'High-income'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'~0.36'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'--'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Gmyrek et al. (2025)'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Global'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'0.30'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'--'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Eloundou et al. (2023)'</span><span class="sc">:&lt;32}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'EUA'</span><span class="sc">:&lt;22}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'--'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'19.0%'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Nota: O Brasil (</span><span class="sc">{</span>mean_geral<span class="sc">:.3f}</span><span class="ss">) se posiciona dentro do esperado para"</span>)</span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"paises de renda media-alta (upper-middle-income ~ 0.29, WP140 Tabela 4)."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-4-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
PERFIL DA EXPOSICAO POR GRADIENTE ILO
======================================================================

--- Nao Exposto (Not Exposed) ---
  Populacao: 52.2 milhoes (53.9%)
  Exposicao media: 0.169 [IC 95%: 0.169 - 0.169]
  Renda media: R$ 2,736
  % Formal: 36.7% | % Mulheres: 41.2%
  Top 5 ocupacoes (COD):
    9111 (Ocupacoes elementares): 3.87M trabalhadores, score=0.140
    9112 (Ocupacoes elementares): 2.69M trabalhadores, score=0.120
    7112 (Industria qualificada): 2.60M trabalhadores, score=0.090
    6111 (Agropecuaria qualificada): 2.00M trabalhadores, score=0.180
    9313 (Ocupacoes elementares): 1.67M trabalhadores, score=0.090

--- Exposicao Minima (Minimal Exposure) ---
  Populacao: 15.2 milhoes (15.7%)
  Exposicao media: 0.306 [IC 95%: 0.306 - 0.306]
  Renda media: R$ 4,449
  % Formal: 51.2% | % Mulheres: 37.7%
  Top 5 ocupacoes (COD):
    8332 (Operadores de maquinas): 1.97M trabalhadores, score=0.240
    3221 (Tecnicos nivel medio): 1.17M trabalhadores, score=0.220
    8321 (Operadores de maquinas): 1.16M trabalhadores, score=0.250
    4321 (Apoio administrativo): 1.07M trabalhadores, score=0.370
    2611 (Profissionais das ciencias): 1.02M trabalhadores, score=0.360

--- Gradiente 1 (Aumento) (Exposed: Gradient 1) ---
  Populacao: 8.7 milhoes (9.0%)
  Exposicao media: 0.357 [IC 95%: 0.357 - 0.357]
  Renda media: R$ 2,755
  % Formal: 51.2% | % Mulheres: 52.3%
  Top 5 ocupacoes (COD):
    5223 (Servicos e vendedores): 3.54M trabalhadores, score=0.380
    8322 (Operadores de maquinas): 2.09M trabalhadores, score=0.280
    5230 (Servicos e vendedores): 1.08M trabalhadores, score=0.390
    3411 (Tecnicos nivel medio): 0.43M trabalhadores, score=0.390
    2634 (Profissionais das ciencias): 0.40M trabalhadores, score=0.390

--- Gradiente 2 (Exposed: Gradient 2) ---
  Populacao: 10.0 milhoes (10.3%)
  Exposicao media: 0.444 [IC 95%: 0.444 - 0.444]
  Renda media: R$ 5,400
  % Formal: 37.8% | % Mulheres: 42.6%
  Top 5 ocupacoes (COD):
    5221 (Servicos e vendedores): 2.88M trabalhadores, score=0.430
    5243 (Servicos e vendedores): 1.12M trabalhadores, score=0.460
    1420 (Dirigentes e gerentes): 0.56M trabalhadores, score=0.440
    1219 (Dirigentes e gerentes): 0.54M trabalhadores, score=0.420
    2421 (Profissionais das ciencias): 0.50M trabalhadores, score=0.460

--- Gradiente 3 (Exposed: Gradient 3) ---
  Populacao: 4.8 milhoes (4.9%)
  Exposicao media: 0.551 [IC 95%: 0.551 - 0.551]
  Renda media: R$ 4,347
  % Formal: 60.6% | % Mulheres: 62.3%
  Top 5 ocupacoes (COD):
    4226 (Apoio administrativo): 1.04M trabalhadores, score=0.570
    2411 (Profissionais das ciencias): 0.59M trabalhadores, score=0.510
    4120 (Apoio administrativo): 0.50M trabalhadores, score=0.580
    2431 (Profissionais das ciencias): 0.43M trabalhadores, score=0.550
    4222 (Apoio administrativo): 0.40M trabalhadores, score=0.580

--- Gradiente 4 (Automacao) (Exposed: Gradient 4) ---
  Populacao: 5.0 milhoes (5.1%)
  Exposicao media: 0.606 [IC 95%: 0.606 - 0.606]
  Renda media: R$ 3,257
  % Formal: 64.9% | % Mulheres: 63.4%
  Top 5 ocupacoes (COD):
    4110 (Apoio administrativo): 3.75M trabalhadores, score=0.600
    5244 (Servicos e vendedores): 0.31M trabalhadores, score=0.610
    4311 (Apoio administrativo): 0.30M trabalhadores, score=0.640
    2413 (Profissionais das ciencias): 0.19M trabalhadores, score=0.620
    3311 (Tecnicos nivel medio): 0.11M trabalhadores, score=0.630

Tabela cod_ilo_merged.csv salva em: data/output/cod_ilo_merged.csv
  422 ocupacoes | Top 5:</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">grande_grupo</th>
<th data-quarto-table-cell-role="th">exposure_score</th>
<th data-quarto-table-cell-role="th">exposure_gradient</th>
<th data-quarto-table-cell-role="th">n_obs</th>
<th data-quarto-table-cell-role="th">pop_milhoes</th>
<th data-quarto-table-cell-role="th">renda_media</th>
<th data-quarto-table-cell-role="th">pct_formal</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">cod_ocupacao</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">9111</th>
<td>Ocupações elementares</td>
<td>0.140</td>
<td>Not Exposed</td>
<td>9432</td>
<td>3.866</td>
<td>1303.005</td>
<td>24.289</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">4110</th>
<td>Apoio administrativo</td>
<td>0.600</td>
<td>Exposed: Gradient 4</td>
<td>7532</td>
<td>3.752</td>
<td>2823.199</td>
<td>65.708</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">5223</th>
<td>Serviços e vendedores</td>
<td>0.380</td>
<td>Exposed: Gradient 1</td>
<td>6825</td>
<td>3.541</td>
<td>2091.706</td>
<td>74.294</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5221</th>
<td>Serviços e vendedores</td>
<td>0.430</td>
<td>Exposed: Gradient 2</td>
<td>6337</td>
<td>2.880</td>
<td>4071.596</td>
<td>0.000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">9112</th>
<td>Ocupações elementares</td>
<td>0.120</td>
<td>Not Exposed</td>
<td>5947</td>
<td>2.688</td>
<td>1733.183</td>
<td>67.528</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
METRICAS DE DESIGUALDADE NA EXPOSICAO
======================================================================
  Media: 0.278 [IC 95%: 0.278 - 0.278]
  Mediana: 0.240
  Gini: 0.2947
  P90/P10: 4.17 (P90=0.500, P10=0.120)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-4-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
COMPARACAO COM LITERATURA INTERNACIONAL
======================================================================
Estudo                           Grupo                  Media        % Alta Exp. 
------------------------------------------------------------------------------
Presente (ILO 2025)              Brasil                 0.278      10.1%
Gmyrek et al. (2025)             Upper-middle-income    ~0.29        --          
Gmyrek et al. (2025)             High-income            ~0.36        --          
Gmyrek et al. (2025)             Global                 0.30         --          
Eloundou et al. (2023)           EUA                    --           19.0%       

Nota: O Brasil (0.278) se posiciona dentro do esperado para
paises de renda media-alta (upper-middle-income ~ 0.29, WP140 Tabela 4).</code></pre>
</div>
</div>
</section>
<section id="desigualdade-e-renda" class="level3" data-number="1.6">
<h3 data-number="1.6" class="anchored" data-anchor-id="desigualdade-e-renda"><span class="header-section-number">1.6</span> 3. Desigualdade e renda</h3>
<p>Rendimento medio (e mediano) ponderado por quintil de exposicao; razao renda Q5/Q1 de exposicao.</p>
<p><strong>Analises:</strong> - Perfil de renda por quintil/decil com ICs 95% - Grafico renda x decil com LOWESS + linear + barras de erro - KDE de renda por quintil de exposicao - Curva de concentracao da exposicao ordenada por renda - Regressao quantilica: coeficiente de exposicao em tau = 0.10, 0.25, 0.50, 0.75, 0.90</p>
<blockquote class="blockquote">
<p><strong>Atenção interpretativa:</strong> A relação entre exposição e renda NÃO é monotônica — o quintil Q4 apresenta renda média superior ao Q5. Isso ocorre porque o Q5 concentra ocupações administrativas e de saúde com alta exposição mas renda relativamente moderada, enquanto o Q4 inclui gerentes e profissionais liberais de setores menos expostos mas com remuneração elevada.</p>
<p>O R² individual da regressão renda~exposição é muito baixo (0.034), enquanto o R² agregado por decis é alto (0.653). Essa diferença ilustra a falácia ecológica: padrões de grupo não se traduzem automaticamente em padrões individuais (Robinson, 1950).</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Conexão com WP140:</strong> O WP140 encontra que, globalmente, ocupações de maior exposição tendem a ser de maior renda (Tabela 2, p.&nbsp;20), o que é consistente com a hipótese de complementaridade. Para países de renda média-alta como o Brasil, esse padrão é esperado mas menos pronunciado do que em países de alta renda, onde o setor de serviços profissionais é proporcionalmente maior. A razão Q5/Q1 de 2.23x encontrada aqui está alinhada com essa expectativa.</p>
</blockquote>
<div id="c123d310" class="cell" data-execution_count="67">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.3 - Analise de Dados - Desigualdade e renda</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.1 - Perfil de renda por quintil de exposicao com ICs</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"PERFIL DE RENDA POR QUINTIL DE EXPOSICAO"</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>rows_quintil <span class="op">=</span> []</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> QUINTIL_ORDER:</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_renda[df_renda[<span class="st">'quintil_exposure'</span>] <span class="op">==</span> q]</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    mean_r, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'rendimento_habitual'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    median_r <span class="op">=</span> weighted_quantile(sub[<span class="st">'rendimento_habitual'</span>], sub[<span class="st">'peso'</span>], <span class="fl">0.50</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    rows_quintil.append({</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Quintil'</span>: q,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Renda Media (R$)'</span>: mean_r,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'IC 95% Inf'</span>: ci_lo,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'IC 95% Sup'</span>: ci_hi,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Renda Mediana (R$)'</span>: median_r,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: weighted_mean(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>]),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="sc">% F</span><span class="st">ormal'</span>: weighted_mean(sub[<span class="st">'formal'</span>], sub[<span class="st">'peso'</span>]) <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>tab_quintil <span class="op">=</span> pd.DataFrame(rows_quintil).set_index(<span class="st">'Quintil'</span>)</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>display(tab_quintil.<span class="bu">round</span>(<span class="dv">1</span>))</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Razao Q5/Q1</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>renda_q5 <span class="op">=</span> tab_quintil.loc[<span class="st">'Q5 (Alta)'</span>, <span class="st">'Renda Media (R$)'</span>]</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>renda_q1 <span class="op">=</span> tab_quintil.loc[<span class="st">'Q1 (Baixa)'</span>, <span class="st">'Renda Media (R$)'</span>]</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Razao renda Q5/Q1: </span><span class="sc">{</span>renda_q5<span class="op">/</span>renda_q1<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Q1 (Baixa exposicao): R$ </span><span class="sc">{</span>renda_q1<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Q5 (Alta exposicao):  R$ </span><span class="sc">{</span>renda_q5<span class="sc">:,.0f}</span><span class="ss">"</span>)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar nao-monotonicidade Q4 &gt; Q5</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>renda_q4 <span class="op">=</span> tab_quintil.loc[<span class="st">'Q4'</span>, <span class="st">'Renda Media (R$)'</span>]</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> renda_q4 <span class="op">&gt;</span> renda_q5:</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  </span><span class="ch">\u26a0</span><span class="ss"> ATENCAO: Q4 (R$ </span><span class="sc">{</span>renda_q4<span class="sc">:,.0f}</span><span class="ss">) &gt; Q5 (R$ </span><span class="sc">{</span>renda_q5<span class="sc">:,.0f}</span><span class="ss">)"</span>)</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  A relacao exposicao-renda NAO e monotonica."</span>)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Q4 concentra gerentes e profissionais liberais de alta renda"</span>)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  em setores de exposicao moderada."</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.2 - Grafico renda x decil com LOWESS + linear + barras de erro</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>decil_data <span class="op">=</span> []</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> DECIL_ORDER:</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_renda[df_renda[<span class="st">'decil_exposure'</span>] <span class="op">==</span> d]</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    mean_r, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'rendimento_habitual'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    decil_data.append({</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Decil'</span>: d, <span class="st">'Renda'</span>: mean_r, <span class="st">'CI_lo'</span>: ci_lo, <span class="st">'CI_hi'</span>: ci_hi,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp_media'</span>: weighted_mean(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>]),</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>dd <span class="op">=</span> pd.DataFrame(decil_data)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>x_pos <span class="op">=</span> <span class="bu">range</span>(<span class="bu">len</span>(dd))</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>yerr <span class="op">=</span> [dd[<span class="st">'Renda'</span>] <span class="op">-</span> dd[<span class="st">'CI_lo'</span>], dd[<span class="st">'CI_hi'</span>] <span class="op">-</span> dd[<span class="st">'Renda'</span>]]</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>ax.bar(x_pos, dd[<span class="st">'Renda'</span>], yerr<span class="op">=</span>yerr, capsize<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>       edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, error_kw<span class="op">=</span>{<span class="st">'linewidth'</span>: <span class="fl">1.5</span>})</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Tendencia linear</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>slope, intercept, r_val, p_val, se <span class="op">=</span> linregress(<span class="bu">range</span>(<span class="bu">len</span>(dd)), dd[<span class="st">'Renda'</span>])</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>ax.plot(x_pos, intercept <span class="op">+</span> slope <span class="op">*</span> np.array(x_pos), <span class="st">'r--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="ss">f'Linear (R²=</span><span class="sc">{</span>r_val<span class="op">**</span><span class="dv">2</span><span class="sc">:.3f}</span><span class="ss">, p=</span><span class="sc">{</span>p_val<span class="sc">:.4f}</span><span class="ss">)'</span>)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co"># LOWESS</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> statsmodels.nonparametric.smoothers_lowess <span class="im">import</span> lowess</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>    lowess_fit <span class="op">=</span> lowess(dd[<span class="st">'Renda'</span>].values, np.array(x_pos), frac<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    ax.plot(lowess_fit[:, <span class="dv">0</span>], lowess_fit[:, <span class="dv">1</span>], <span class="st">'g-'</span>, linewidth<span class="op">=</span><span class="fl">2.5</span>, label<span class="op">=</span><span class="st">'LOWESS'</span>)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">pass</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(x_pos)</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(dd[<span class="st">'Decil'</span>], rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Rendimento Habitual Medio (R$)'</span>)</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Decil de Exposicao a IA'</span>)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Rendimento Medio por Decil de Exposicao (com IC 95%)'</span>)</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(mticker.FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f'R$</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="co"># R² individual (WLS) para comparacao</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>model_ind <span class="op">=</span> smf.wls(<span class="st">'rendimento_habitual ~ exposure_score'</span>,</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>                     data<span class="op">=</span>df_renda, weights<span class="op">=</span>df_renda[<span class="st">'peso'</span>]).fit()</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">R² individual (WLS renda ~ exposicao): </span><span class="sc">{</span>model_ind<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R² agregado (decis): </span><span class="sc">{</span>r_val<span class="op">**</span><span class="dv">2</span><span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Nota: R² agregado e artificialmente inflado por suavizar variancia individual."</span>)</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.3 - KDE de renda por quintil de exposicao</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>colors_q <span class="op">=</span> [<span class="st">'#2ca02c'</span>, <span class="st">'#aec7e8'</span>, <span class="st">'#ffbb78'</span>, <span class="st">'#ff7f0e'</span>, <span class="st">'#d62728'</span>]</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, q <span class="kw">in</span> <span class="bu">enumerate</span>(QUINTIL_ORDER):</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_renda[(df_renda[<span class="st">'quintil_exposure'</span>] <span class="op">==</span> q) <span class="op">&amp;</span> (df_renda[<span class="st">'rendimento_habitual'</span>] <span class="op">&lt;=</span> <span class="dv">15000</span>)]</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>        kde <span class="op">=</span> gaussian_kde(sub[<span class="st">'rendimento_habitual'</span>].values,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>                          weights<span class="op">=</span>sub[<span class="st">'peso'</span>].values <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>())</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="dv">15000</span>, <span class="dv">300</span>)</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, kde(x), color<span class="op">=</span>colors_q[i], linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>q)</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Rendimento Habitual (R$)'</span>)</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Densidade'</span>)</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Distribuicao de Renda por Quintil de Exposicao (KDE ponderado)'</span>)</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>ax.xaxis.set_major_formatter(mticker.FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f'R$</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.4 - Curva de concentracao (exposicao ordenada por renda)</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>df_conc <span class="op">=</span> df_renda.sort_values(<span class="st">'rendimento_habitual'</span>).copy()</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>vals_c <span class="op">=</span> np.array(df_conc[<span class="st">'exposure_score'</span>])</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>wgts_c <span class="op">=</span> np.array(df_conc[<span class="st">'peso'</span>])</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>cum_pop_c <span class="op">=</span> np.concatenate([[<span class="dv">0</span>], np.cumsum(wgts_c) <span class="op">/</span> wgts_c.<span class="bu">sum</span>()])</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>cum_exp_c <span class="op">=</span> np.concatenate([[<span class="dv">0</span>], np.cumsum(wgts_c <span class="op">*</span> vals_c) <span class="op">/</span> (wgts_c <span class="op">*</span> vals_c).<span class="bu">sum</span>()])</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">7</span>))</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>ax.plot(cum_pop_c, cum_exp_c, color<span class="op">=</span><span class="st">'darkorange'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">'Concentracao (exposicao | renda)'</span>)</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>ax.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">'Linha de igualdade'</span>)</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>ax.fill_between(cum_pop_c, cum_exp_c, np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(cum_pop_c)),</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>                alpha<span class="op">=</span><span class="fl">0.1</span>, color<span class="op">=</span><span class="st">'darkorange'</span>)</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Fracao acumulada da populacao (ordenada por renda)'</span>)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Fracao acumulada da exposicao'</span>)</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Curva de Concentracao: Exposicao ordenada por Renda'</span>)</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>ax.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>ax.set_aspect(<span class="st">'equal'</span>)</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Indice de concentracao</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>conc_area <span class="op">=</span> np.trapz(cum_exp_c, cum_pop_c)</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>conc_index <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="dv">2</span> <span class="op">*</span> conc_area</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Indice de concentracao: </span><span class="sc">{</span>conc_index<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> conc_index <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  &gt; 0: exposicao concentrada entre os mais ricos"</span>)</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> conc_index <span class="op">&lt;</span> <span class="dv">0</span>:</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  &lt; 0: exposicao concentrada entre os mais pobres"</span>)</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.5 - Regressao quantilica</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"REGRESSAO QUANTILICA: log(renda) ~ exposicao + controles"</span>)</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  NOTA: QuantReg do statsmodels nao suporta pesos amostrais"</span>)</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  nativamente. Os coeficientes podem diferir de uma estimacao"</span>)</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  ponderada. Limitacao declarada."</span>)</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>df_qreg <span class="op">=</span> df_renda[[<span class="st">'rendimento_habitual'</span>, <span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>,</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>, <span class="st">'formal'</span>]].dropna().copy()</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>df_qreg[<span class="st">'log_renda'</span>] <span class="op">=</span> np.log(df_qreg[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>quantiles <span class="op">=</span> [<span class="fl">0.10</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>]</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>qreg_results <span class="op">=</span> []</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tau <span class="kw">in</span> quantiles:</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>        qr <span class="op">=</span> smf.quantreg(</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>            <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + idade + I(idade**2) + formal'</span>,</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>df_qreg</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>        ).fit(q<span class="op">=</span>tau, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>        coef <span class="op">=</span> qr.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>        se <span class="op">=</span> qr.bse[<span class="st">'exposure_score'</span>]</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>        ci <span class="op">=</span> qr.conf_int().loc[<span class="st">'exposure_score'</span>]</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>        pval <span class="op">=</span> qr.pvalues[<span class="st">'exposure_score'</span>]</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>        qreg_results.append({</span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Quantil'</span>: <span class="ss">f'</span><span class="sc">{</span>tau<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Coef. Exposicao'</span>: coef,</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>            <span class="st">'SE'</span>: se,</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>            <span class="st">'IC 95% Inf'</span>: ci[<span class="dv">0</span>],</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>            <span class="st">'IC 95% Sup'</span>: ci[<span class="dv">1</span>],</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p-valor'</span>: pval,</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Sig.'</span>: sig_stars(pval),</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  tau=</span><span class="sc">{</span>tau<span class="sc">:.2f}</span><span class="ss">: coef=</span><span class="sc">{</span>coef<span class="sc">:.4f}</span><span class="ss"> (SE=</span><span class="sc">{</span>se<span class="sc">:.4f}</span><span class="ss">) </span><span class="sc">{</span>sig_stars(pval)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  tau=</span><span class="sc">{</span>tau<span class="sc">:.2f}</span><span class="ss">: ERRO - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> qreg_results:</span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>    tab_qreg <span class="op">=</span> pd.DataFrame(qreg_results).set_index(<span class="st">'Quantil'</span>)</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>    display(tab_qreg.<span class="bu">round</span>(<span class="dv">4</span>))</span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Grafico do processo quantilico</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>    coefs <span class="op">=</span> [r[<span class="st">'Coef. Exposicao'</span>] <span class="cf">for</span> r <span class="kw">in</span> qreg_results]</span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>    ci_lo <span class="op">=</span> [r[<span class="st">'IC 95% Inf'</span>] <span class="cf">for</span> r <span class="kw">in</span> qreg_results]</span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>    ci_hi <span class="op">=</span> [r[<span class="st">'IC 95% Sup'</span>] <span class="cf">for</span> r <span class="kw">in</span> qreg_results]</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>    ax.plot(quantiles, coefs, <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(quantiles, ci_lo, ci_hi, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adicionar coeficiente OLS como referencia</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>    ols_model <span class="op">=</span> smf.wls(</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + idade + I(idade**2) + formal'</span>,</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_qreg, weights<span class="op">=</span>df_renda.loc[df_qreg.index, <span class="st">'peso'</span>]</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>    ).fit()</span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>    ax.axhline(ols_model.params[<span class="st">'exposure_score'</span>], color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>               linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span><span class="ss">f'WLS media = </span><span class="sc">{</span>ols_model<span class="sc">.</span>params[<span class="st">"exposure_score"</span>]<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Quantil da Distribuicao de Renda'</span>)</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Coeficiente de Exposicao (log-renda)'</span>)</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Processo Quantilico: Efeito da Exposicao ao Longo da Distribuicao de Renda'</span>)</span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretacao: Se o coeficiente cresce com o quantil, a exposicao"</span>)</span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"beneficia mais os trabalhadores de maior renda (complementaridade)."</span>)</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Se decresce, os de menor renda sao mais afetados (substituicao)."</span>)</span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.X - Tabela Comparativa Brasil vs. WP140</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"COMPARACAO ESTRUTURADA: BRASIL vs. WP140 (por grupo de renda)"</span>)</span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">90</span>)</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>pct_nao_exposto <span class="op">=</span> df_score[df_score[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> <span class="st">'Not Exposed'</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> df_score[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>comparacao <span class="op">=</span> pd.DataFrame({</span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Indicador'</span>: [</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exposicao media'</span>,</span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Nao Exposto'</span>,</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exposicao (G3-G4)'</span>,</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Setor mais exposto'</span>,</span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Ocupacao mais exposta'</span>,</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Gap genero (M-H)'</span>,</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Brasil (este estudo)'</span>: [</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'</span><span class="sc">{</span>mean_geral<span class="sc">:.3f}</span><span class="ss">'</span>,</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'</span><span class="sc">{</span>pct_nao_exposto<span class="sc">:.1f}</span><span class="ss">%'</span>,</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'</span><span class="sc">{</span>pct_alta<span class="sc">:.1f}</span><span class="ss">%'</span>,</span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Financas e Seguros'</span>,</span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Apoio administrativo'</span>,</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>        <span class="ss">f'+</span><span class="sc">{</span>gap_sexo<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">if</span> <span class="st">'gap_sexo'</span> <span class="kw">in</span> <span class="bu">dir</span>() <span class="cf">else</span> <span class="st">'ver secao 4'</span>,</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Upper-Middle (WP140)'</span>: [</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>        <span class="st">'~0.29'</span>, <span class="st">'~52%'</span>, <span class="st">'~11%'</span>,</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Financial services'</span>, <span class="st">'Clerical support'</span>,</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mulheres &gt; Homens'</span>,</span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>    <span class="st">'High-Income (WP140)'</span>: [</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>        <span class="st">'~0.36'</span>, <span class="st">'~35%'</span>, <span class="st">'~20%'</span>,</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Financial services'</span>, <span class="st">'Clerical support'</span>,</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mulheres &gt; Homens'</span>,</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Global (WP140)'</span>: [</span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>        <span class="st">'0.30'</span>, <span class="st">'~50%'</span>, <span class="st">'~12%'</span>,</span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Financial services'</span>, <span class="st">'Clerical support'</span>,</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Mulheres &gt; Homens'</span>,</span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>display(comparacao.set_index(<span class="st">'Indicador'</span>))</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.Y - Heatmap bidimensional exposicao x renda</span></span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"HEATMAP: DISTRIBUICAO CONJUNTA EXPOSICAO x RENDA"</span>)</span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>df_renda[<span class="st">'decil_renda'</span>] <span class="op">=</span> pd.qcut(</span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>    df_renda[<span class="st">'rendimento_habitual'</span>], <span class="dv">10</span>,</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="ss">f'R</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)])</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> df_renda.groupby([<span class="st">'decil_exposure'</span>, <span class="st">'decil_renda'</span>])[<span class="st">'peso'</span>].<span class="bu">sum</span>().unstack(fill_value<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>cross <span class="op">=</span> cross <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># em milhoes</span></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>sns.heatmap(cross, cmap<span class="op">=</span><span class="st">'YlOrRd'</span>, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, ax<span class="op">=</span>ax,</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>            cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Trabalhadores (milhoes)'</span>})</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Decil de Renda'</span>)</span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Decil de Exposicao'</span>)</span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Distribuicao Conjunta: Exposicao a IA x Renda'</span>)</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.Z - Scatter plot de ocupacoes (bubble chart)</span></span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BUBBLE CHART: OCUPACOES (EXPOSICAO vs. RENDA)"</span>)</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>ocup_agg <span class="op">=</span> df_renda.groupby(<span class="st">'cod_ocupacao'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> g: pd.Series({</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exp_media'</span>: weighted_mean(g[<span class="st">'exposure_score'</span>], g[<span class="st">'peso'</span>]),</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>    <span class="st">'renda_media'</span>: weighted_mean(g[<span class="st">'rendimento_habitual'</span>], g[<span class="st">'peso'</span>]),</span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pop'</span>: g[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grande_grupo'</span>: g[<span class="st">'grande_grupo'</span>].mode().iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="bu">len</span>(g[<span class="st">'grande_grupo'</span>].mode()) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Outros'</span>,</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>})).reset_index()</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">9</span>))</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>grupos <span class="op">=</span> <span class="bu">sorted</span>(ocup_agg[<span class="st">'grande_grupo'</span>].unique())</span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>cores_gg <span class="op">=</span> plt.cm.tab10(np.linspace(<span class="dv">0</span>, <span class="dv">1</span>, <span class="bu">len</span>(grupos)))</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grupo, cor <span class="kw">in</span> <span class="bu">zip</span>(grupos, cores_gg):</span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> ocup_agg[ocup_agg[<span class="st">'grande_grupo'</span>] <span class="op">==</span> grupo]</span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>    ax.scatter(sub[<span class="st">'exp_media'</span>], sub[<span class="st">'renda_media'</span>],</span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>               s<span class="op">=</span>sub[<span class="st">'pop'</span>]<span class="op">*</span><span class="dv">50</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, color<span class="op">=</span>cor, label<span class="op">=</span>grupo, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposicao Media'</span>)</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Renda Media (R$)'</span>)</span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Ocupacoes: Exposicao vs. Renda (tamanho = populacao)'</span>)</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a>ax.legend(fontsize<span class="op">=</span><span class="dv">8</span>, loc<span class="op">=</span><span class="st">'upper left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.W - Regressao quantilica continua (tau 0.05 a 0.95)</span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"REGRESSAO QUANTILICA CONTINUA (tau 0.05 a 0.95)"</span>)</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a>df_quant <span class="op">=</span> df_renda[[<span class="st">'rendimento_habitual'</span>, <span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>,</span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>, <span class="st">'formal'</span>, <span class="st">'nivel_instrucao'</span>]].dropna().copy()</span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a>df_quant[<span class="st">'log_renda'</span>] <span class="op">=</span> np.log(df_quant[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a>taus <span class="op">=</span> np.arange(<span class="fl">0.05</span>, <span class="fl">0.96</span>, <span class="fl">0.05</span>)</span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a>coefs_qr <span class="op">=</span> []</span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tau <span class="kw">in</span> taus:</span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a>        mod <span class="op">=</span> smf.quantreg(</span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a>            <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a>            <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal'</span>,</span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a>            data<span class="op">=</span>df_quant</span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a>        ).fit(q<span class="op">=</span>tau, max_iter<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a>        coefs_qr.append({</span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a>            <span class="st">'tau'</span>: tau,</span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a>            <span class="st">'coef'</span>: mod.params[<span class="st">'exposure_score'</span>],</span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_lo'</span>: mod.conf_int().loc[<span class="st">'exposure_score'</span>, <span class="dv">0</span>],</span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_hi'</span>: mod.conf_int().loc[<span class="st">'exposure_score'</span>, <span class="dv">1</span>],</span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  tau=</span><span class="sc">{</span>tau<span class="sc">:.2f}</span><span class="ss">: ERRO - </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coefs_qr:</span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>    qr_df <span class="op">=</span> pd.DataFrame(coefs_qr)</span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>    ax.fill_between(qr_df[<span class="st">'tau'</span>], qr_df[<span class="st">'ci_lo'</span>], qr_df[<span class="st">'ci_hi'</span>],</span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>                    alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>    ax.plot(qr_df[<span class="st">'tau'</span>], qr_df[<span class="st">'coef'</span>], <span class="st">'o-'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, markersize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>    ax.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>    <span class="co"># OLS para referencia</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>    coef_ols_ref <span class="op">=</span> mincer2.params[<span class="st">'exposure_score'</span>] <span class="cf">if</span> <span class="st">'mincer2'</span> <span class="kw">in</span> <span class="bu">dir</span>() <span class="cf">else</span> ols_model.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>    ax.axhline(coef_ols_ref, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="ss">f'OLS = </span><span class="sc">{</span>coef_ols_ref<span class="sc">:.3f}</span><span class="ss">'</span>)</span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Quantil (tau)'</span>)</span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Coeficiente de Exposicao'</span>)</span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Regressao Quantilica: Efeito da Exposicao ao Longo da Distribuicao de Renda'</span>)</span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  NOTA: QuantReg nao suporta pesos amostrais nativamente."</span>)</span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  Coeficientes podem diferir de estimacao ponderada."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
PERFIL DE RENDA POR QUINTIL DE EXPOSICAO
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Renda Media (R$)</th>
<th data-quarto-table-cell-role="th">IC 95% Inf</th>
<th data-quarto-table-cell-role="th">IC 95% Sup</th>
<th data-quarto-table-cell-role="th">Renda Mediana (R$)</th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">% Formal</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Quintil</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q1 (Baixa)</th>
<td>2000.000</td>
<td>1999.100</td>
<td>2000.900</td>
<td>1600.000</td>
<td>0.100</td>
<td>37.400</td>
<td>20.500</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Q2</th>
<td>2439.000</td>
<td>2437.600</td>
<td>2440.400</td>
<td>1900.000</td>
<td>0.200</td>
<td>30.000</td>
<td>17.700</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q3</th>
<td>3290.400</td>
<td>3288.600</td>
<td>3292.200</td>
<td>2500.000</td>
<td>0.200</td>
<td>46.300</td>
<td>21.300</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Q4</th>
<td>4928.600</td>
<td>4925.400</td>
<td>4931.900</td>
<td>2900.000</td>
<td>0.400</td>
<td>52.300</td>
<td>17.200</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q5 (Alta)</th>
<td>4468.600</td>
<td>4466.000</td>
<td>4471.200</td>
<td>2900.000</td>
<td>0.500</td>
<td>50.100</td>
<td>19.200</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Razao renda Q5/Q1: 2.23x
  Q1 (Baixa exposicao): R$ 2,000
  Q5 (Alta exposicao):  R$ 4,469

  ⚠ ATENCAO: Q4 (R$ 4,929) &gt; Q5 (R$ 4,469)
  A relacao exposicao-renda NAO e monotonica.
  Q4 concentra gerentes e profissionais liberais de alta renda
  em setores de exposicao moderada.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
R² individual (WLS renda ~ exposicao): 0.0340
R² agregado (decis): 0.6526
Nota: R² agregado e artificialmente inflado por suavizar variancia individual.</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/9l/bxkb7j2s259_jlrwc_dnrklr0000gn/T/ipykernel_32166/213812379.py:145: DeprecationWarning: `trapz` is deprecated. Use `trapezoid` instead, or one of the numerical integration functions in `scipy.integrate`.
  conc_area = np.trapz(cum_exp_c, cum_pop_c)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Indice de concentracao: 0.0810
  &gt; 0: exposicao concentrada entre os mais ricos</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
REGRESSAO QUANTILICA: log(renda) ~ exposicao + controles
======================================================================

  NOTA: QuantReg do statsmodels nao suporta pesos amostrais
  nativamente. Os coeficientes podem diferir de uma estimacao
  ponderada. Limitacao declarada.
  tau=0.10: coef=0.6177 (SE=0.0130) ***
  tau=0.25: coef=0.9900 (SE=0.0138) ***
  tau=0.50: coef=1.2090 (SE=0.0109) ***
  tau=0.75: coef=1.8282 (SE=0.0139) ***
  tau=0.90: coef=2.4992 (SE=0.0186) ***</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Coef. Exposicao</th>
<th data-quarto-table-cell-role="th">SE</th>
<th data-quarto-table-cell-role="th">IC 95% Inf</th>
<th data-quarto-table-cell-role="th">IC 95% Sup</th>
<th data-quarto-table-cell-role="th">p-valor</th>
<th data-quarto-table-cell-role="th">Sig.</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Quantil</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.10</th>
<td>0.618</td>
<td>0.013</td>
<td>0.592</td>
<td>0.643</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.25</th>
<td>0.990</td>
<td>0.014</td>
<td>0.963</td>
<td>1.017</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.50</th>
<td>1.209</td>
<td>0.011</td>
<td>1.188</td>
<td>1.230</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">0.75</th>
<td>1.828</td>
<td>0.014</td>
<td>1.801</td>
<td>1.856</td>
<td>0.000</td>
<td>***</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">0.90</th>
<td>2.499</td>
<td>0.019</td>
<td>2.463</td>
<td>2.536</td>
<td>0.000</td>
<td>***</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-12.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretacao: Se o coeficiente cresce com o quantil, a exposicao
beneficia mais os trabalhadores de maior renda (complementaridade).
Se decresce, os de menor renda sao mais afetados (substituicao).

==========================================================================================
COMPARACAO ESTRUTURADA: BRASIL vs. WP140 (por grupo de renda)
==========================================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Brasil (este estudo)</th>
<th data-quarto-table-cell-role="th">Upper-Middle (WP140)</th>
<th data-quarto-table-cell-role="th">High-Income (WP140)</th>
<th data-quarto-table-cell-role="th">Global (WP140)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Indicador</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Exposicao media</th>
<td>0.278</td>
<td>~0.29</td>
<td>~0.36</td>
<td>0.30</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">% Nao Exposto</th>
<td>53.9%</td>
<td>~52%</td>
<td>~35%</td>
<td>~50%</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">% Alta Exposicao (G3-G4)</th>
<td>10.1%</td>
<td>~11%</td>
<td>~20%</td>
<td>~12%</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Setor mais exposto</th>
<td>Financas e Seguros</td>
<td>Financial services</td>
<td>Financial services</td>
<td>Financial services</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ocupacao mais exposta</th>
<td>Apoio administrativo</td>
<td>Clerical support</td>
<td>Clerical support</td>
<td>Clerical support</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Gap genero (M-H)</th>
<td>+0.044</td>
<td>Mulheres &gt; Homens</td>
<td>Mulheres &gt; Homens</td>
<td>Mulheres &gt; Homens</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
HEATMAP: DISTRIBUICAO CONJUNTA EXPOSICAO x RENDA
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-16.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
BUBBLE CHART: OCUPACOES (EXPOSICAO vs. RENDA)
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-18.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
REGRESSAO QUANTILICA CONTINUA (tau 0.05 a 0.95)
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-5-output-20.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  NOTA: QuantReg nao suporta pesos amostrais nativamente.
  Coeficientes podem diferir de estimacao ponderada.</code></pre>
</div>
</div>
</section>
<section id="genero-e-raca" class="level3" data-number="1.7">
<h3 data-number="1.7" class="anchored" data-anchor-id="genero-e-raca"><span class="header-section-number">1.7</span> 4. Genero e raca</h3>
<p>% de mulheres e de negros por quintil de exposicao; exposicao media por sexo e raca.</p>
<p><strong>Analises:</strong> - Exposicao por sexo e raca com ICs e testes t ponderados - KDE comparativo: homens vs mulheres, brancos vs negros - Exposicao por sexo x raca x quintil - Decomposicao Oaxaca-Blinder do gap de genero - Decomposicao Oaxaca-Blinder do gap racial</p>
<blockquote class="blockquote">
<p><strong>Nota sobre categorias raciais:</strong> Seguindo convenção estabelecida na literatura brasileira de desigualdade (Osorio, 2003; Soares, 2000), as categorias Preta e Parda do IBGE foram agregadas em “Negra”. A categoria “Outras” agrega Amarelos e Indígenas (1.0M de trabalhadores). Embora esses grupos tenham realidades socioeconômicas distintas, o tamanho amostral reduzido de cada um individualmente limita análises desagregadas robustas. Resultados para “Outras” devem ser interpretados com cautela.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Conexão com WP140 (gênero):</strong> O WP140 (Seção 3.2, p.&nbsp;24-26) encontra que mulheres estão sistematicamente mais expostas à IA generativa em todas as regiões do mundo, principalmente pela concentração feminina em trabalho clerical (ISCO Major Group 4). No Brasil, confirmamos esse padrão (gap de +0.044). O WP140 destaca que esse resultado pode ter implicações distributivas ambíguas: se a IA complementa o trabalho clerical, mulheres se beneficiam; se automatiza, mulheres são mais vulneráveis. A decomposição Oaxaca-Blinder que realizamos aprofunda essa análise para além do que o WP140 oferece.</p>
<p><strong>Contribuição original (raça):</strong> A análise por raça não é contemplada no WP140, que trabalha com dados globais sem essa desagregação. O gap racial de exposição (+0.048 para brancos) é uma contribuição específica desta dissertação ao debate sobre IA e desigualdade no Brasil.</p>
</blockquote>
<div id="0af5411d" class="cell" data-execution_count="68">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.4 - Analise de Dados - Genero e raca</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.1 - Exposicao por sexo e raca com ICs e testes t</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR GENERO E RACA"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Por sexo ---</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Por Sexo ---"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>rows_sexo <span class="op">=</span> []</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sexo <span class="kw">in</span> [<span class="st">'Homem'</span>, <span class="st">'Mulher'</span>]:</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'sexo_texto'</span>] <span class="op">==</span> sexo]</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    n_alta <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    rows_sexo.append({</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Grupo'</span>: sexo,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exp.'</span>: n_alta <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>sexo<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mean_e<span class="sc">:.3f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span>ci_hi<span class="sc">:.3f}</span><span class="ss">] | Pop: </span><span class="sc">{</span>sub[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss">M"</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste t genero</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>sub_h <span class="op">=</span> df_score[df_score[<span class="st">'sexo_texto'</span>] <span class="op">==</span> <span class="st">'Homem'</span>]</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>sub_m <span class="op">=</span> df_score[df_score[<span class="st">'sexo_texto'</span>] <span class="op">==</span> <span class="st">'Mulher'</span>]</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>t_sexo, p_sexo <span class="op">=</span> weighted_ttest_2groups(</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    sub_h[<span class="st">'exposure_score'</span>], sub_h[<span class="st">'peso'</span>],</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>    sub_m[<span class="st">'exposure_score'</span>], sub_m[<span class="st">'peso'</span>]</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>gap_sexo <span class="op">=</span> rows_sexo[<span class="dv">1</span>][<span class="st">'Exp. Media'</span>] <span class="op">-</span> rows_sexo[<span class="dv">0</span>][<span class="st">'Exp. Media'</span>]</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gap (M-H): </span><span class="sc">{</span>gap_sexo<span class="sc">:+.3f}</span><span class="ss"> | t=</span><span class="sc">{</span>t_sexo<span class="sc">:.2f}</span><span class="ss">, p=</span><span class="sc">{</span>p_sexo<span class="sc">:.4f}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(p_sexo)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a><span class="co"># d de Cohen ponderado para genero</span></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>d_sexo <span class="op">=</span> weighted_cohen_d(</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    sub_h[<span class="st">'exposure_score'</span>].values, sub_h[<span class="st">'peso'</span>].values,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>    sub_m[<span class="st">'exposure_score'</span>].values, sub_m[<span class="st">'peso'</span>].values</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  d de Cohen (H-M): </span><span class="sc">{</span>d_sexo<span class="sc">:.3f}</span><span class="ss"> (</span><span class="sc">{</span><span class="st">'pequeno'</span> <span class="cf">if</span> <span class="bu">abs</span>(d_sexo)<span class="op">&lt;</span><span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'medio'</span> <span class="cf">if</span> <span class="bu">abs</span>(d_sexo)<span class="op">&lt;</span><span class="fl">0.8</span> <span class="cf">else</span> <span class="st">'grande'</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Por raca ---</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Por Raca ---"</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>rows_raca <span class="op">=</span> []</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> raca <span class="kw">in</span> [<span class="st">'Branca'</span>, <span class="st">'Negra'</span>, <span class="st">'Outras'</span>]:</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'raca_agregada'</span>] <span class="op">==</span> raca]</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>    n_alta <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>    rows_raca.append({</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Grupo'</span>: raca,</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exp.'</span>: n_alta <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>raca<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mean_e<span class="sc">:.3f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo<span class="sc">:.3f}</span><span class="ss"> - </span><span class="sc">{</span>ci_hi<span class="sc">:.3f}</span><span class="ss">] | Pop: </span><span class="sc">{</span>sub[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss">M"</span>)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste t raca (Branca vs Negra)</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a>sub_br <span class="op">=</span> df_score[df_score[<span class="st">'raca_agregada'</span>] <span class="op">==</span> <span class="st">'Branca'</span>]</span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a>sub_ne <span class="op">=</span> df_score[df_score[<span class="st">'raca_agregada'</span>] <span class="op">==</span> <span class="st">'Negra'</span>]</span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>t_raca, p_raca <span class="op">=</span> weighted_ttest_2groups(</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>    sub_br[<span class="st">'exposure_score'</span>], sub_br[<span class="st">'peso'</span>],</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>    sub_ne[<span class="st">'exposure_score'</span>], sub_ne[<span class="st">'peso'</span>]</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>gap_raca <span class="op">=</span> rows_raca[<span class="dv">0</span>][<span class="st">'Exp. Media'</span>] <span class="op">-</span> rows_raca[<span class="dv">1</span>][<span class="st">'Exp. Media'</span>]</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gap (Branca-Negra): </span><span class="sc">{</span>gap_raca<span class="sc">:+.3f}</span><span class="ss"> | t=</span><span class="sc">{</span>t_raca<span class="sc">:.2f}</span><span class="ss">, p=</span><span class="sc">{</span>p_raca<span class="sc">:.4f}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(p_raca)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a><span class="co"># d de Cohen ponderado para raca</span></span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>d_raca <span class="op">=</span> weighted_cohen_d(</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>    sub_br[<span class="st">'exposure_score'</span>].values, sub_br[<span class="st">'peso'</span>].values,</span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a>    sub_ne[<span class="st">'exposure_score'</span>].values, sub_ne[<span class="st">'peso'</span>].values</span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  d de Cohen (B-N): </span><span class="sc">{</span>d_raca<span class="sc">:.3f}</span><span class="ss"> (</span><span class="sc">{</span><span class="st">'pequeno'</span> <span class="cf">if</span> <span class="bu">abs</span>(d_raca)<span class="op">&lt;</span><span class="fl">0.5</span> <span class="cf">else</span> <span class="st">'medio'</span> <span class="cf">if</span> <span class="bu">abs</span>(d_raca)<span class="op">&lt;</span><span class="fl">0.8</span> <span class="cf">else</span> <span class="st">'grande'</span><span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela consolidada</span></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>tab_genero_raca <span class="op">=</span> pd.DataFrame(rows_sexo <span class="op">+</span> rows_raca).set_index(<span class="st">'Grupo'</span>)</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>display(tab_genero_raca.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.2 - KDE comparativo por sexo e raca</span></span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Painel A: Sexo</span></span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> sexo, cor <span class="kw">in</span> [(<span class="st">'Homem'</span>, <span class="st">'steelblue'</span>), (<span class="st">'Mulher'</span>, <span class="st">'coral'</span>)]:</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'sexo_texto'</span>] <span class="op">==</span> sexo]</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a>    kde <span class="op">=</span> gaussian_kde(sub[<span class="st">'exposure_score'</span>].values,</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a>                      weights<span class="op">=</span>sub[<span class="st">'peso'</span>].values <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>())</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">0.75</span>, <span class="dv">200</span>)</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, kde(x), color<span class="op">=</span>cor, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>sexo)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Score de Exposicao'</span>)</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Densidade'</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'(A) Distribuicao por Sexo (p=</span><span class="sc">{</span>p_sexo<span class="sc">:.4f}{</span>sig_stars(p_sexo)<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb20-96"><a href="#cb20-96" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb20-97"><a href="#cb20-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-98"><a href="#cb20-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Painel B: Raca</span></span>
<span id="cb20-99"><a href="#cb20-99" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb20-100"><a href="#cb20-100" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> raca, cor <span class="kw">in</span> [(<span class="st">'Branca'</span>, <span class="st">'steelblue'</span>), (<span class="st">'Negra'</span>, <span class="st">'coral'</span>)]:</span>
<span id="cb20-101"><a href="#cb20-101" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'raca_agregada'</span>] <span class="op">==</span> raca]</span>
<span id="cb20-102"><a href="#cb20-102" aria-hidden="true" tabindex="-1"></a>    kde <span class="op">=</span> gaussian_kde(sub[<span class="st">'exposure_score'</span>].values,</span>
<span id="cb20-103"><a href="#cb20-103" aria-hidden="true" tabindex="-1"></a>                      weights<span class="op">=</span>sub[<span class="st">'peso'</span>].values <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>())</span>
<span id="cb20-104"><a href="#cb20-104" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">0.75</span>, <span class="dv">200</span>)</span>
<span id="cb20-105"><a href="#cb20-105" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, kde(x), color<span class="op">=</span>cor, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>raca)</span>
<span id="cb20-106"><a href="#cb20-106" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Score de Exposicao'</span>)</span>
<span id="cb20-107"><a href="#cb20-107" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Densidade'</span>)</span>
<span id="cb20-108"><a href="#cb20-108" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'(B) Distribuicao por Raca (p=</span><span class="sc">{</span>p_raca<span class="sc">:.4f}{</span>sig_stars(p_raca)<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb20-109"><a href="#cb20-109" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb20-110"><a href="#cb20-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-111"><a href="#cb20-111" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-112"><a href="#cb20-112" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-113"><a href="#cb20-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-114"><a href="#cb20-114" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-115"><a href="#cb20-115" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.3 - Exposicao por sexo x quintil</span></span>
<span id="cb20-116"><a href="#cb20-116" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-117"><a href="#cb20-117" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb20-118"><a href="#cb20-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-119"><a href="#cb20-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Painel A: Sexo x Quintil</span></span>
<span id="cb20-120"><a href="#cb20-120" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb20-121"><a href="#cb20-121" aria-hidden="true" tabindex="-1"></a>data_sq <span class="op">=</span> []</span>
<span id="cb20-122"><a href="#cb20-122" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> QUINTIL_ORDER:</span>
<span id="cb20-123"><a href="#cb20-123" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> sexo <span class="kw">in</span> [<span class="st">'Homem'</span>, <span class="st">'Mulher'</span>]:</span>
<span id="cb20-124"><a href="#cb20-124" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df_score[(df_score[<span class="st">'quintil_exposure'</span>] <span class="op">==</span> q) <span class="op">&amp;</span> (df_score[<span class="st">'sexo_texto'</span>] <span class="op">==</span> sexo)]</span>
<span id="cb20-125"><a href="#cb20-125" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-126"><a href="#cb20-126" aria-hidden="true" tabindex="-1"></a>            data_sq.append({<span class="st">'Quintil'</span>: q, <span class="st">'Sexo'</span>: sexo, <span class="st">'Pop'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>})</span>
<span id="cb20-127"><a href="#cb20-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-128"><a href="#cb20-128" aria-hidden="true" tabindex="-1"></a>df_sq <span class="op">=</span> pd.DataFrame(data_sq)</span>
<span id="cb20-129"><a href="#cb20-129" aria-hidden="true" tabindex="-1"></a>df_pivot <span class="op">=</span> df_sq.pivot(index<span class="op">=</span><span class="st">'Quintil'</span>, columns<span class="op">=</span><span class="st">'Sexo'</span>, values<span class="op">=</span><span class="st">'Pop'</span>)</span>
<span id="cb20-130"><a href="#cb20-130" aria-hidden="true" tabindex="-1"></a>df_pivot.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax, color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'coral'</span>], edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb20-131"><a href="#cb20-131" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Populacao (milhoes)'</span>)</span>
<span id="cb20-132"><a href="#cb20-132" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'(A) Populacao por Sexo e Quintil de Exposicao'</span>)</span>
<span id="cb20-133"><a href="#cb20-133" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-134"><a href="#cb20-134" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Sexo'</span>)</span>
<span id="cb20-135"><a href="#cb20-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-136"><a href="#cb20-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Painel B: Raca x Quintil</span></span>
<span id="cb20-137"><a href="#cb20-137" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb20-138"><a href="#cb20-138" aria-hidden="true" tabindex="-1"></a>data_rq <span class="op">=</span> []</span>
<span id="cb20-139"><a href="#cb20-139" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> QUINTIL_ORDER:</span>
<span id="cb20-140"><a href="#cb20-140" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> raca <span class="kw">in</span> [<span class="st">'Branca'</span>, <span class="st">'Negra'</span>]:</span>
<span id="cb20-141"><a href="#cb20-141" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df_score[(df_score[<span class="st">'quintil_exposure'</span>] <span class="op">==</span> q) <span class="op">&amp;</span> (df_score[<span class="st">'raca_agregada'</span>] <span class="op">==</span> raca)]</span>
<span id="cb20-142"><a href="#cb20-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb20-143"><a href="#cb20-143" aria-hidden="true" tabindex="-1"></a>            data_rq.append({<span class="st">'Quintil'</span>: q, <span class="st">'Raca'</span>: raca, <span class="st">'Pop'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>})</span>
<span id="cb20-144"><a href="#cb20-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-145"><a href="#cb20-145" aria-hidden="true" tabindex="-1"></a>df_rq <span class="op">=</span> pd.DataFrame(data_rq)</span>
<span id="cb20-146"><a href="#cb20-146" aria-hidden="true" tabindex="-1"></a>df_pivot_r <span class="op">=</span> df_rq.pivot(index<span class="op">=</span><span class="st">'Quintil'</span>, columns<span class="op">=</span><span class="st">'Raca'</span>, values<span class="op">=</span><span class="st">'Pop'</span>)</span>
<span id="cb20-147"><a href="#cb20-147" aria-hidden="true" tabindex="-1"></a>df_pivot_r.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax, color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'coral'</span>], edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb20-148"><a href="#cb20-148" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Populacao (milhoes)'</span>)</span>
<span id="cb20-149"><a href="#cb20-149" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'(B) Populacao por Raca e Quintil de Exposicao'</span>)</span>
<span id="cb20-150"><a href="#cb20-150" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb20-151"><a href="#cb20-151" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">'Raca'</span>)</span>
<span id="cb20-152"><a href="#cb20-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-153"><a href="#cb20-153" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-154"><a href="#cb20-154" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-155"><a href="#cb20-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-156"><a href="#cb20-156" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-157"><a href="#cb20-157" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.4 - Decomposicao Oaxaca-Blinder do gap de genero</span></span>
<span id="cb20-158"><a href="#cb20-158" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-159"><a href="#cb20-159" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-160"><a href="#cb20-160" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DECOMPOSICAO OAXACA-BLINDER DO GAP DE GENERO NA EXPOSICAO"</span>)</span>
<span id="cb20-161"><a href="#cb20-161" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-162"><a href="#cb20-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-163"><a href="#cb20-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparar dados para decomposicao</span></span>
<span id="cb20-164"><a href="#cb20-164" aria-hidden="true" tabindex="-1"></a>df_ob <span class="op">=</span> df_score[[<span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>, <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>,</span>
<span id="cb20-165"><a href="#cb20-165" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'nivel_instrucao'</span>, <span class="st">'grande_grupo'</span>, <span class="st">'regiao'</span>, <span class="st">'formal'</span>, <span class="st">'peso'</span>]].dropna().copy()</span>
<span id="cb20-166"><a href="#cb20-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-167"><a href="#cb20-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Criar dummies manualmente para controle total</span></span>
<span id="cb20-168"><a href="#cb20-168" aria-hidden="true" tabindex="-1"></a>formula_ob <span class="op">=</span> <span class="st">'exposure_score ~ C(raca_agregada) + idade + I(idade**2) + C(nivel_instrucao) + C(grande_grupo) + C(regiao) + formal'</span></span>
<span id="cb20-169"><a href="#cb20-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-170"><a href="#cb20-170" aria-hidden="true" tabindex="-1"></a>df_h <span class="op">=</span> df_ob[df_ob[<span class="st">'sexo_texto'</span>] <span class="op">==</span> <span class="st">'Homem'</span>]</span>
<span id="cb20-171"><a href="#cb20-171" aria-hidden="true" tabindex="-1"></a>df_m <span class="op">=</span> df_ob[df_ob[<span class="st">'sexo_texto'</span>] <span class="op">==</span> <span class="st">'Mulher'</span>]</span>
<span id="cb20-172"><a href="#cb20-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-173"><a href="#cb20-173" aria-hidden="true" tabindex="-1"></a>reg_h <span class="op">=</span> smf.wls(formula_ob, data<span class="op">=</span>df_h, weights<span class="op">=</span>df_h[<span class="st">'peso'</span>]).fit()</span>
<span id="cb20-174"><a href="#cb20-174" aria-hidden="true" tabindex="-1"></a>reg_m <span class="op">=</span> smf.wls(formula_ob, data<span class="op">=</span>df_m, weights<span class="op">=</span>df_m[<span class="st">'peso'</span>]).fit()</span>
<span id="cb20-175"><a href="#cb20-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-176"><a href="#cb20-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Media das variaveis explicativas</span></span>
<span id="cb20-177"><a href="#cb20-177" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> patsy</span>
<span id="cb20-178"><a href="#cb20-178" aria-hidden="true" tabindex="-1"></a>y_h, X_h <span class="op">=</span> patsy.dmatrices(formula_ob, data<span class="op">=</span>df_h, return_type<span class="op">=</span><span class="st">'dataframe'</span>)</span>
<span id="cb20-179"><a href="#cb20-179" aria-hidden="true" tabindex="-1"></a>y_m, X_m <span class="op">=</span> patsy.dmatrices(formula_ob, data<span class="op">=</span>df_m, return_type<span class="op">=</span><span class="st">'dataframe'</span>)</span>
<span id="cb20-180"><a href="#cb20-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-181"><a href="#cb20-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Medias ponderadas das Xs</span></span>
<span id="cb20-182"><a href="#cb20-182" aria-hidden="true" tabindex="-1"></a>mean_X_h <span class="op">=</span> np.average(X_h.values, axis<span class="op">=</span><span class="dv">0</span>, weights<span class="op">=</span>df_h[<span class="st">'peso'</span>].values)</span>
<span id="cb20-183"><a href="#cb20-183" aria-hidden="true" tabindex="-1"></a>mean_X_m <span class="op">=</span> np.average(X_m.values, axis<span class="op">=</span><span class="dv">0</span>, weights<span class="op">=</span>df_m[<span class="st">'peso'</span>].values)</span>
<span id="cb20-184"><a href="#cb20-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-185"><a href="#cb20-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Medias das Ys</span></span>
<span id="cb20-186"><a href="#cb20-186" aria-hidden="true" tabindex="-1"></a>mean_y_h <span class="op">=</span> weighted_mean(df_h[<span class="st">'exposure_score'</span>], df_h[<span class="st">'peso'</span>])</span>
<span id="cb20-187"><a href="#cb20-187" aria-hidden="true" tabindex="-1"></a>mean_y_m <span class="op">=</span> weighted_mean(df_m[<span class="st">'exposure_score'</span>], df_m[<span class="st">'peso'</span>])</span>
<span id="cb20-188"><a href="#cb20-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-189"><a href="#cb20-189" aria-hidden="true" tabindex="-1"></a><span class="co"># Decomposicao (referencia: coeficientes dos homens)</span></span>
<span id="cb20-190"><a href="#cb20-190" aria-hidden="true" tabindex="-1"></a>gap_total <span class="op">=</span> mean_y_m <span class="op">-</span> mean_y_h</span>
<span id="cb20-191"><a href="#cb20-191" aria-hidden="true" tabindex="-1"></a>explicado <span class="op">=</span> (mean_X_m <span class="op">-</span> mean_X_h) <span class="op">@</span> reg_h.params.values</span>
<span id="cb20-192"><a href="#cb20-192" aria-hidden="true" tabindex="-1"></a>nao_explicado <span class="op">=</span> gap_total <span class="op">-</span> explicado</span>
<span id="cb20-193"><a href="#cb20-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-194"><a href="#cb20-194" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Exposicao media homens:   </span><span class="sc">{</span>mean_y_h<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-195"><a href="#cb20-195" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Exposicao media mulheres: </span><span class="sc">{</span>mean_y_m<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-196"><a href="#cb20-196" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gap total (M - H):        </span><span class="sc">{</span>gap_total<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-197"><a href="#cb20-197" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Explicado (caracteristicas): </span><span class="sc">{</span>explicado<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>explicado<span class="op">/</span>gap_total<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-198"><a href="#cb20-198" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nao explicado (coeficientes): </span><span class="sc">{</span>nao_explicado<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>nao_explicado<span class="op">/</span>gap_total<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-199"><a href="#cb20-199" aria-hidden="true" tabindex="-1"></a>pct_explicado <span class="op">=</span> explicado<span class="op">/</span>gap_total<span class="op">*</span><span class="dv">100</span></span>
<span id="cb20-200"><a href="#cb20-200" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Interpretacao: </span><span class="sc">{</span>pct_explicado<span class="sc">:.0f}</span><span class="ss">% do gap de genero e explicado por"</span>)</span>
<span id="cb20-201"><a href="#cb20-201" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  diferencas em escolaridade, ocupacao, regiao e formalidade."</span>)</span>
<span id="cb20-202"><a href="#cb20-202" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> pct_explicado <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb20-203"><a href="#cb20-203" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  O componente explicado &gt; 100% indica que, se mulheres tivessem"</span>)</span>
<span id="cb20-204"><a href="#cb20-204" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  a mesma composicao ocupacional que homens, seu gap de exposicao"</span>)</span>
<span id="cb20-205"><a href="#cb20-205" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  seria AINDA MAIOR. Mulheres estao sub-representadas nas ocupacoes"</span>)</span>
<span id="cb20-206"><a href="#cb20-206" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  de alta exposicao apesar de possuirem caracteristicas (escolaridade)"</span>)</span>
<span id="cb20-207"><a href="#cb20-207" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  que predizem maior exposicao — evidencia de segregacao ocupacional."</span>)</span>
<span id="cb20-208"><a href="#cb20-208" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb20-209"><a href="#cb20-209" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Os </span><span class="sc">{</span><span class="bu">abs</span>(nao_explicado<span class="op">/</span>gap_total<span class="op">*</span><span class="dv">100</span>)<span class="sc">:.0f}</span><span class="ss">% restantes refletem segregacao ocupacional"</span>)</span>
<span id="cb20-210"><a href="#cb20-210" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  e diferente valoracao das mesmas caracteristicas."</span>)</span>
<span id="cb20-211"><a href="#cb20-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-212"><a href="#cb20-212" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-213"><a href="#cb20-213" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.5 - Decomposicao Oaxaca-Blinder do gap racial</span></span>
<span id="cb20-214"><a href="#cb20-214" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb20-215"><a href="#cb20-215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-216"><a href="#cb20-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DECOMPOSICAO OAXACA-BLINDER DO GAP RACIAL NA EXPOSICAO"</span>)</span>
<span id="cb20-217"><a href="#cb20-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-218"><a href="#cb20-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-219"><a href="#cb20-219" aria-hidden="true" tabindex="-1"></a>formula_ob_raca <span class="op">=</span> <span class="st">'exposure_score ~ C(sexo_texto) + idade + I(idade**2) + C(nivel_instrucao) + C(grande_grupo) + C(regiao) + formal'</span></span>
<span id="cb20-220"><a href="#cb20-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-221"><a href="#cb20-221" aria-hidden="true" tabindex="-1"></a>df_br <span class="op">=</span> df_ob[df_ob[<span class="st">'raca_agregada'</span>] <span class="op">==</span> <span class="st">'Branca'</span>]</span>
<span id="cb20-222"><a href="#cb20-222" aria-hidden="true" tabindex="-1"></a>df_ne <span class="op">=</span> df_ob[df_ob[<span class="st">'raca_agregada'</span>] <span class="op">==</span> <span class="st">'Negra'</span>]</span>
<span id="cb20-223"><a href="#cb20-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-224"><a href="#cb20-224" aria-hidden="true" tabindex="-1"></a>reg_br <span class="op">=</span> smf.wls(formula_ob_raca, data<span class="op">=</span>df_br, weights<span class="op">=</span>df_br[<span class="st">'peso'</span>]).fit()</span>
<span id="cb20-225"><a href="#cb20-225" aria-hidden="true" tabindex="-1"></a>reg_ne <span class="op">=</span> smf.wls(formula_ob_raca, data<span class="op">=</span>df_ne, weights<span class="op">=</span>df_ne[<span class="st">'peso'</span>]).fit()</span>
<span id="cb20-226"><a href="#cb20-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-227"><a href="#cb20-227" aria-hidden="true" tabindex="-1"></a>y_br, X_br <span class="op">=</span> patsy.dmatrices(formula_ob_raca, data<span class="op">=</span>df_br, return_type<span class="op">=</span><span class="st">'dataframe'</span>)</span>
<span id="cb20-228"><a href="#cb20-228" aria-hidden="true" tabindex="-1"></a>y_ne, X_ne <span class="op">=</span> patsy.dmatrices(formula_ob_raca, data<span class="op">=</span>df_ne, return_type<span class="op">=</span><span class="st">'dataframe'</span>)</span>
<span id="cb20-229"><a href="#cb20-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-230"><a href="#cb20-230" aria-hidden="true" tabindex="-1"></a>mean_X_br <span class="op">=</span> np.average(X_br.values, axis<span class="op">=</span><span class="dv">0</span>, weights<span class="op">=</span>df_br[<span class="st">'peso'</span>].values)</span>
<span id="cb20-231"><a href="#cb20-231" aria-hidden="true" tabindex="-1"></a>mean_X_ne <span class="op">=</span> np.average(X_ne.values, axis<span class="op">=</span><span class="dv">0</span>, weights<span class="op">=</span>df_ne[<span class="st">'peso'</span>].values)</span>
<span id="cb20-232"><a href="#cb20-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-233"><a href="#cb20-233" aria-hidden="true" tabindex="-1"></a>mean_y_br <span class="op">=</span> weighted_mean(df_br[<span class="st">'exposure_score'</span>], df_br[<span class="st">'peso'</span>])</span>
<span id="cb20-234"><a href="#cb20-234" aria-hidden="true" tabindex="-1"></a>mean_y_ne <span class="op">=</span> weighted_mean(df_ne[<span class="st">'exposure_score'</span>], df_ne[<span class="st">'peso'</span>])</span>
<span id="cb20-235"><a href="#cb20-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-236"><a href="#cb20-236" aria-hidden="true" tabindex="-1"></a>gap_raca_total <span class="op">=</span> mean_y_br <span class="op">-</span> mean_y_ne</span>
<span id="cb20-237"><a href="#cb20-237" aria-hidden="true" tabindex="-1"></a>explicado_raca <span class="op">=</span> (mean_X_br <span class="op">-</span> mean_X_ne) <span class="op">@</span> reg_ne.params.values</span>
<span id="cb20-238"><a href="#cb20-238" aria-hidden="true" tabindex="-1"></a>nao_explicado_raca <span class="op">=</span> gap_raca_total <span class="op">-</span> explicado_raca</span>
<span id="cb20-239"><a href="#cb20-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-240"><a href="#cb20-240" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Exposicao media brancos: </span><span class="sc">{</span>mean_y_br<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-241"><a href="#cb20-241" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Exposicao media negros:  </span><span class="sc">{</span>mean_y_ne<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-242"><a href="#cb20-242" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gap total (B - N):       </span><span class="sc">{</span>gap_raca_total<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-243"><a href="#cb20-243" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Explicado (caracteristicas): </span><span class="sc">{</span>explicado_raca<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>explicado_raca<span class="op">/</span>gap_raca_total<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-244"><a href="#cb20-244" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Nao explicado (coeficientes): </span><span class="sc">{</span>nao_explicado_raca<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>nao_explicado_raca<span class="op">/</span>gap_raca_total<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb20-245"><a href="#cb20-245" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Interpretacao: Trabalhadores brancos tem maior exposicao a IA"</span>)</span>
<span id="cb20-246"><a href="#cb20-246" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  (</span><span class="sc">{</span>gap_raca_total<span class="sc">:+.3f}</span><span class="ss">), refletindo concentracao em ocupacoes"</span>)</span>
<span id="cb20-247"><a href="#cb20-247" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  de maior qualificacao e setores mais tecnologicos."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXPOSICAO POR GENERO E RACA
======================================================================

--- Por Sexo ---
  Homem: 0.259 [IC: 0.259 - 0.259] | Pop: 54.3M
  Mulher: 0.303 [IC: 0.303 - 0.303] | Pop: 42.7M
  Gap (M-H): +0.044 | t=-1473.74, p=0.0000 ***
  d de Cohen (H-M): -0.301 (pequeno)

--- Por Raca ---
  Branca: 0.305 [IC: 0.305 - 0.305] | Pop: 41.9M
  Negra: 0.257 [IC: 0.257 - 0.257] | Pop: 54.0M
  Outras: 0.301 [IC: 0.301 - 0.302] | Pop: 1.0M
  Gap (Branca-Negra): +0.048 | t=1601.17, p=0.0000 ***
  d de Cohen (B-N): 0.330 (pequeno)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">% Alta Exp.</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Grupo</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Homem</th>
<td>0.259</td>
<td>0.259</td>
<td>0.259</td>
<td>6.688</td>
<td>54.292</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Mulher</th>
<td>0.303</td>
<td>0.303</td>
<td>0.303</td>
<td>14.397</td>
<td>42.674</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Branca</th>
<td>0.305</td>
<td>0.305</td>
<td>0.305</td>
<td>12.403</td>
<td>41.881</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Negra</th>
<td>0.257</td>
<td>0.257</td>
<td>0.257</td>
<td>8.255</td>
<td>54.046</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Outras</th>
<td>0.301</td>
<td>0.301</td>
<td>0.302</td>
<td>11.432</td>
<td>1.039</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-6-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-6-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
DECOMPOSICAO OAXACA-BLINDER DO GAP DE GENERO NA EXPOSICAO
======================================================================

  Exposicao media homens:   0.2589
  Exposicao media mulheres: 0.3028
  Gap total (M - H):        +0.0439
  Explicado (caracteristicas): +0.0542 (123.3%)
  Nao explicado (coeficientes): -0.0103 (-23.3%)

  Interpretacao: 123% do gap de genero e explicado por
  diferencas em escolaridade, ocupacao, regiao e formalidade.
  O componente explicado &gt; 100% indica que, se mulheres tivessem
  a mesma composicao ocupacional que homens, seu gap de exposicao
  seria AINDA MAIOR. Mulheres estao sub-representadas nas ocupacoes
  de alta exposicao apesar de possuirem caracteristicas (escolaridade)
  que predizem maior exposicao — evidencia de segregacao ocupacional.

======================================================================
DECOMPOSICAO OAXACA-BLINDER DO GAP RACIAL NA EXPOSICAO
======================================================================

  Exposicao media brancos: 0.3050
  Exposicao media negros:  0.2571
  Gap total (B - N):       +0.0479
  Explicado (caracteristicas): +0.0355 (74.1%)
  Nao explicado (coeficientes): +0.0124 (25.9%)

  Interpretacao: Trabalhadores brancos tem maior exposicao a IA
  (+0.048), refletindo concentracao em ocupacoes
  de maior qualificacao e setores mais tecnologicos.</code></pre>
</div>
</div>
</section>
<section id="b.-idade-e-escolaridade" class="level3" data-number="1.8">
<h3 data-number="1.8" class="anchored" data-anchor-id="b.-idade-e-escolaridade"><span class="header-section-number">1.8</span> 4b. Idade e escolaridade</h3>
<p>Exposicao media por faixa etaria e por nivel de instrucao.</p>
<p><strong>Analises:</strong> - Exposicao media por faixa etaria (5 em 5 anos) com ICs - Exposicao media por nivel de instrucao com ICs - KDE sobrepostas por nivel de instrucao - Cross-tab: faixa etaria x nivel de instrucao x exposicao media</p>
<div id="75c5cada" class="cell" data-execution_count="69">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.4b - Idade e Escolaridade</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 4b.1 - Exposicao por faixa etaria</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR FAIXA ETARIA"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>bins_idade <span class="op">=</span> [<span class="dv">14</span>, <span class="dv">19</span>, <span class="dv">24</span>, <span class="dv">29</span>, <span class="dv">34</span>, <span class="dv">39</span>, <span class="dv">44</span>, <span class="dv">49</span>, <span class="dv">54</span>, <span class="dv">59</span>, <span class="dv">64</span>, <span class="dv">100</span>]</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>labels_idade <span class="op">=</span> [<span class="st">'15-19'</span>, <span class="st">'20-24'</span>, <span class="st">'25-29'</span>, <span class="st">'30-34'</span>, <span class="st">'35-39'</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>                <span class="st">'40-44'</span>, <span class="st">'45-49'</span>, <span class="st">'50-54'</span>, <span class="st">'55-59'</span>, <span class="st">'60-64'</span>, <span class="st">'65+'</span>]</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>df_score[<span class="st">'faixa_etaria'</span>] <span class="op">=</span> pd.cut(df_score[<span class="st">'idade'</span>], bins<span class="op">=</span>bins_idade, labels<span class="op">=</span>labels_idade)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>rows_idade <span class="op">=</span> []</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> faixa <span class="kw">in</span> labels_idade:</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'faixa_etaria'</span>] <span class="op">==</span> faixa]</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    rows_idade.append({</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Faixa'</span>: faixa, <span class="st">'Exp. Media'</span>: mean_e,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>tab_idade <span class="op">=</span> pd.DataFrame(rows_idade).set_index(<span class="st">'Faixa'</span>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>display(tab_idade.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>ax.errorbar(<span class="bu">range</span>(<span class="bu">len</span>(tab_idade)), tab_idade[<span class="st">'Exp. Media'</span>],</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>            yerr<span class="op">=</span>[tab_idade[<span class="st">'Exp. Media'</span>]<span class="op">-</span>tab_idade[<span class="st">'IC Inf'</span>],</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>                  tab_idade[<span class="st">'IC Sup'</span>]<span class="op">-</span>tab_idade[<span class="st">'Exp. Media'</span>]],</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            fmt<span class="op">=</span><span class="st">'o-'</span>, capsize<span class="op">=</span><span class="dv">4</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(tab_idade)))</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>ax.set_xticklabels(tab_idade.index, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Exposicao Media'</span>)</span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Faixa Etaria'</span>)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Exposicao a IA Generativa por Faixa Etaria'</span>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a><span class="co"># 4b.2 - Exposicao por nivel de instrucao</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR NIVEL DE INSTRUCAO"</span>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar edu_simples se disponivel, senao nivel_instrucao</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>edu_col <span class="op">=</span> <span class="st">'edu_simples'</span> <span class="cf">if</span> <span class="st">'edu_simples'</span> <span class="kw">in</span> df_score.columns <span class="cf">else</span> <span class="st">'nivel_instrucao'</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>rows_edu <span class="op">=</span> []</span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> edu <span class="kw">in</span> df_score[edu_col].dropna().unique():</span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[edu_col] <span class="op">==</span> edu]</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>    rows_edu.append({</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Nivel'</span>: edu, <span class="st">'Exp. Media'</span>: mean_e,</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>        <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>tab_edu <span class="op">=</span> pd.DataFrame(rows_edu).sort_values(<span class="st">'Exp. Media'</span>).set_index(<span class="st">'Nivel'</span>)</span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>display(tab_edu.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>tab_edu_plot <span class="op">=</span> tab_edu.sort_values(<span class="st">'Exp. Media'</span>)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a>ax.barh(<span class="bu">range</span>(<span class="bu">len</span>(tab_edu_plot)), tab_edu_plot[<span class="st">'Exp. Media'</span>], color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>        xerr<span class="op">=</span>[tab_edu_plot[<span class="st">'Exp. Media'</span>]<span class="op">-</span>tab_edu_plot[<span class="st">'IC Inf'</span>],</span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>              tab_edu_plot[<span class="st">'IC Sup'</span>]<span class="op">-</span>tab_edu_plot[<span class="st">'Exp. Media'</span>]],</span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>        capsize<span class="op">=</span><span class="dv">3</span>, edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(tab_edu_plot)))</span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>ax.set_yticklabels(tab_edu_plot.index)</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposicao Media'</span>)</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Exposicao a IA Generativa por Nivel de Instrucao'</span>)</span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a><span class="co"># 4b.3 - KDE sobrepostas por nivel de instrucao</span></span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'edu_simples'</span> <span class="kw">in</span> df_score.columns:</span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>    edu_order_kde <span class="op">=</span> [<span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'Fund.Comp.'</span>, <span class="st">'Med.Comp.'</span>, <span class="st">'Sup.Comp.'</span>]</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a>    cores_edu <span class="op">=</span> [<span class="st">'#d62728'</span>, <span class="st">'#ff7f0e'</span>, <span class="st">'#2ca02c'</span>, <span class="st">'#1f77b4'</span>]</span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> edu, cor <span class="kw">in</span> <span class="bu">zip</span>(edu_order_kde, cores_edu):</span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df_score[df_score[<span class="st">'edu_simples'</span>] <span class="op">==</span> edu]</span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a>        kde <span class="op">=</span> gaussian_kde(sub[<span class="st">'exposure_score'</span>].values,</span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>                           weights<span class="op">=</span>sub[<span class="st">'peso'</span>].values <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>())</span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">0.75</span>, <span class="dv">200</span>)</span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, kde(x), color<span class="op">=</span>cor, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>edu)</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Score de Exposicao'</span>)</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">'Densidade'</span>)</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">'Distribuicao de Exposicao por Nivel de Instrucao'</span>)</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>    ax.legend()</span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a><span class="co"># 4b.4 - Cross-tab: faixa etaria x nivel de instrucao x exposicao</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'edu_simples'</span> <span class="kw">in</span> df_score.columns:</span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"CROSS-TAB: FAIXA ETARIA x EDUCACAO x EXPOSICAO MEDIA"</span>)</span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>    pivot_idade_edu <span class="op">=</span> df_score.groupby([<span class="st">'faixa_etaria'</span>, <span class="st">'edu_simples'</span>]).<span class="bu">apply</span>(</span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>        <span class="kw">lambda</span> x: weighted_mean(x[<span class="st">'exposure_score'</span>], x[<span class="st">'peso'</span>])</span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>    ).unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>    edu_order_ct <span class="op">=</span> [<span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'Fund.Comp.'</span>, <span class="st">'Med.Comp.'</span>, <span class="st">'Sup.Comp.'</span>]</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>    cols_available <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> edu_order_ct <span class="cf">if</span> c <span class="kw">in</span> pivot_idade_edu.columns]</span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cols_available:</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>        pivot_idade_edu <span class="op">=</span> pivot_idade_edu[cols_available]</span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>    display(pivot_idade_edu.<span class="bu">round</span>(<span class="dv">3</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXPOSICAO POR FAIXA ETARIA
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Faixa</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">15-19</th>
<td>0.306</td>
<td>0.306</td>
<td>0.306</td>
<td>2.555</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">20-24</th>
<td>0.304</td>
<td>0.304</td>
<td>0.305</td>
<td>10.157</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">25-29</th>
<td>0.297</td>
<td>0.297</td>
<td>0.297</td>
<td>12.220</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">30-34</th>
<td>0.291</td>
<td>0.291</td>
<td>0.291</td>
<td>12.475</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">35-39</th>
<td>0.284</td>
<td>0.284</td>
<td>0.284</td>
<td>12.754</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">40-44</th>
<td>0.273</td>
<td>0.273</td>
<td>0.273</td>
<td>12.948</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">45-49</th>
<td>0.263</td>
<td>0.263</td>
<td>0.263</td>
<td>11.682</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">50-54</th>
<td>0.255</td>
<td>0.255</td>
<td>0.255</td>
<td>9.415</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">55-59</th>
<td>0.251</td>
<td>0.251</td>
<td>0.252</td>
<td>7.297</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">60-64</th>
<td>0.253</td>
<td>0.253</td>
<td>0.253</td>
<td>4.828</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">65+</th>
<td>0.260</td>
<td>0.260</td>
<td>0.261</td>
<td>0.637</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-7-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
EXPOSICAO POR NIVEL DE INSTRUCAO
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Nivel</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Sem/Fund.Inc.</th>
<td>0.179</td>
<td>0.179</td>
<td>0.179</td>
<td>16.721</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Fund.Comp.</th>
<td>0.204</td>
<td>0.204</td>
<td>0.204</td>
<td>6.040</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Med.Inc.</th>
<td>0.218</td>
<td>0.218</td>
<td>0.218</td>
<td>5.959</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Med.Comp.</th>
<td>0.275</td>
<td>0.275</td>
<td>0.275</td>
<td>37.561</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Sup.Inc.</th>
<td>0.359</td>
<td>0.359</td>
<td>0.359</td>
<td>6.464</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Sup.Comp.</th>
<td>0.364</td>
<td>0.364</td>
<td>0.364</td>
<td>24.221</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-7-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-7-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
CROSS-TAB: FAIXA ETARIA x EDUCACAO x EXPOSICAO MEDIA
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">edu_simples</th>
<th data-quarto-table-cell-role="th">Sem/Fund.Inc.</th>
<th data-quarto-table-cell-role="th">Fund.Comp.</th>
<th data-quarto-table-cell-role="th">Med.Comp.</th>
<th data-quarto-table-cell-role="th">Sup.Comp.</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">faixa_etaria</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">15-19</th>
<td>0.173</td>
<td>0.202</td>
<td>0.333</td>
<td>0.386</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">20-24</th>
<td>0.181</td>
<td>0.200</td>
<td>0.297</td>
<td>0.383</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">25-29</th>
<td>0.172</td>
<td>0.190</td>
<td>0.279</td>
<td>0.376</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">30-34</th>
<td>0.173</td>
<td>0.196</td>
<td>0.270</td>
<td>0.374</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">35-39</th>
<td>0.174</td>
<td>0.193</td>
<td>0.269</td>
<td>0.368</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">40-44</th>
<td>0.173</td>
<td>0.199</td>
<td>0.260</td>
<td>0.358</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">45-49</th>
<td>0.177</td>
<td>0.215</td>
<td>0.257</td>
<td>0.359</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">50-54</th>
<td>0.180</td>
<td>0.211</td>
<td>0.264</td>
<td>0.347</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">55-59</th>
<td>0.185</td>
<td>0.215</td>
<td>0.269</td>
<td>0.350</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">60-64</th>
<td>0.187</td>
<td>0.220</td>
<td>0.277</td>
<td>0.357</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">65+</th>
<td>0.204</td>
<td>0.243</td>
<td>0.285</td>
<td>0.349</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="formalidade" class="level3" data-number="1.9">
<h3 data-number="1.9" class="anchored" data-anchor-id="formalidade"><span class="header-section-number">1.9</span> 5. Formalidade</h3>
<p>% formal por quintil de exposicao; exposicao media no formal vs informal.</p>
<p><strong>Analises:</strong> - Exposicao por formalidade com ICs e teste t ponderado - Investigacao do “paradoxo da formalidade”: cross-tab quintil x formalidade x renda + regressao com interacao - KDE: formal vs informal</p>
<blockquote class="blockquote">
<p><strong>Interpretação da interação:</strong> O coeficiente da interação exposição×formalidade é <strong>negativo</strong> (-1.21, p&lt;0.001). Isso significa que o retorno da exposição sobre a renda é MENOR para trabalhadores formais do que para informais. Profissionais liberais informais de alta exposição (consultores, advogados autônomos, médicos com CNPJ) capturam mais retorno da exposição à IA do que empregados formais equivalentes.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Contribuição original (formalidade):</strong> A distinção formal/informal não aparece no WP140 (irrelevante em países de alta renda onde a informalidade é marginal). No Brasil, onde ~57% da força de trabalho é informal, essa dimensão é central. A OIT tem interesse particular na questão (ILO, 2018 — Women and Men in the Informal Economy) e esta análise conecta dois temas prioritários da agenda OIT: IA generativa e informalidade.</p>
</blockquote>
<div id="6a806e49" class="cell" data-execution_count="70">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.5 - Analise de Dados - Formalidade</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.1 - Exposicao por formalidade com ICs e teste t</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO: FORMAL vs INFORMAL"</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>rows_formal <span class="op">=</span> []</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val, label <span class="kw">in</span> [(<span class="dv">1</span>, <span class="st">'Formal'</span>), (<span class="dv">0</span>, <span class="st">'Informal'</span>)]:</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'formal'</span>] <span class="op">==</span> val]</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    n_alta <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    sub_r <span class="op">=</span> sub[sub[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    mean_renda <span class="op">=</span> weighted_mean(sub_r[<span class="st">'rendimento_habitual'</span>], sub_r[<span class="st">'peso'</span>]) <span class="cf">if</span> <span class="bu">len</span>(sub_r) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    rows_formal.append({</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Tipo'</span>: label,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exp.'</span>: n_alta <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Renda Media (R$)'</span>: mean_renda,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">: Exp=</span><span class="sc">{</span>mean_e<span class="sc">:.3f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo<span class="sc">:.3f}</span><span class="ss">-</span><span class="sc">{</span>ci_hi<span class="sc">:.3f}</span><span class="ss">] | "</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Renda=R$</span><span class="sc">{</span>mean_renda<span class="sc">:,.0f}</span><span class="ss"> | Pop=</span><span class="sc">{</span>sub[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss">M"</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste t</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>sub_f <span class="op">=</span> df_score[df_score[<span class="st">'formal'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>sub_i <span class="op">=</span> df_score[df_score[<span class="st">'formal'</span>] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>t_form, p_form <span class="op">=</span> weighted_ttest_2groups(</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    sub_f[<span class="st">'exposure_score'</span>], sub_f[<span class="st">'peso'</span>],</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    sub_i[<span class="st">'exposure_score'</span>], sub_i[<span class="st">'peso'</span>]</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Gap (F-I): </span><span class="sc">{</span>rows_formal[<span class="dv">0</span>][<span class="st">'Exp. Media'</span>]<span class="op">-</span>rows_formal[<span class="dv">1</span>][<span class="st">'Exp. Media'</span>]<span class="sc">:+.3f}</span><span class="ss"> | "</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"t=</span><span class="sc">{</span>t_form<span class="sc">:.2f}</span><span class="ss">, p=</span><span class="sc">{</span>p_form<span class="sc">:.4f}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(p_form)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>tab_formal <span class="op">=</span> pd.DataFrame(rows_formal).set_index(<span class="st">'Tipo'</span>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>display(tab_formal.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.2 - KDE formal vs informal</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> val, label, cor <span class="kw">in</span> [(<span class="dv">1</span>, <span class="st">'Formal'</span>, <span class="st">'steelblue'</span>), (<span class="dv">0</span>, <span class="st">'Informal'</span>, <span class="st">'coral'</span>)]:</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'formal'</span>] <span class="op">==</span> val]</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    kde <span class="op">=</span> gaussian_kde(sub[<span class="st">'exposure_score'</span>].values,</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>                      weights<span class="op">=</span>sub[<span class="st">'peso'</span>].values <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>())</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">0.75</span>, <span class="dv">200</span>)</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    ax.plot(x, kde(x), color<span class="op">=</span>cor, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span>label)</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Score de Exposicao'</span>)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Densidade'</span>)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Distribuicao de Exposicao: Formal vs Informal (p=</span><span class="sc">{</span>p_form<span class="sc">:.4f}{</span>sig_stars(p_form)<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>ax.legend()</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.3 - Investigacao do "paradoxo": quintil x formalidade x renda</span></span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INVESTIGACAO: RENDA POR QUINTIL DE EXPOSICAO E FORMALIDADE"</span>)</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-64"><a href="#cb27-64" aria-hidden="true" tabindex="-1"></a>rows_qf <span class="op">=</span> []</span>
<span id="cb27-65"><a href="#cb27-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> q <span class="kw">in</span> QUINTIL_ORDER:</span>
<span id="cb27-66"><a href="#cb27-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> val, label <span class="kw">in</span> [(<span class="dv">1</span>, <span class="st">'Formal'</span>), (<span class="dv">0</span>, <span class="st">'Informal'</span>)]:</span>
<span id="cb27-67"><a href="#cb27-67" aria-hidden="true" tabindex="-1"></a>        sub <span class="op">=</span> df_renda[(df_renda[<span class="st">'quintil_exposure'</span>] <span class="op">==</span> q) <span class="op">&amp;</span> (df_renda[<span class="st">'formal'</span>] <span class="op">==</span> val)]</span>
<span id="cb27-68"><a href="#cb27-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb27-69"><a href="#cb27-69" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb27-70"><a href="#cb27-70" aria-hidden="true" tabindex="-1"></a>        mean_r <span class="op">=</span> weighted_mean(sub[<span class="st">'rendimento_habitual'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb27-71"><a href="#cb27-71" aria-hidden="true" tabindex="-1"></a>        rows_qf.append({</span>
<span id="cb27-72"><a href="#cb27-72" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Quintil'</span>: q, <span class="st">'Tipo'</span>: label, <span class="st">'Renda Media'</span>: mean_r,</span>
<span id="cb27-73"><a href="#cb27-73" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Pop (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span>,</span>
<span id="cb27-74"><a href="#cb27-74" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-75"><a href="#cb27-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-76"><a href="#cb27-76" aria-hidden="true" tabindex="-1"></a>tab_qf <span class="op">=</span> pd.DataFrame(rows_qf)</span>
<span id="cb27-77"><a href="#cb27-77" aria-hidden="true" tabindex="-1"></a>tab_qf_pivot <span class="op">=</span> tab_qf.pivot(index<span class="op">=</span><span class="st">'Quintil'</span>, columns<span class="op">=</span><span class="st">'Tipo'</span>, values<span class="op">=</span><span class="st">'Renda Media'</span>)</span>
<span id="cb27-78"><a href="#cb27-78" aria-hidden="true" tabindex="-1"></a>display(tab_qf_pivot.<span class="bu">round</span>(<span class="dv">0</span>))</span>
<span id="cb27-79"><a href="#cb27-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-80"><a href="#cb27-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico</span></span>
<span id="cb27-81"><a href="#cb27-81" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb27-82"><a href="#cb27-82" aria-hidden="true" tabindex="-1"></a>tab_qf_pivot.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax, color<span class="op">=</span>[<span class="st">'coral'</span>, <span class="st">'steelblue'</span>], edgecolor<span class="op">=</span><span class="st">'white'</span>)</span>
<span id="cb27-83"><a href="#cb27-83" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Renda Media (R$)'</span>)</span>
<span id="cb27-84"><a href="#cb27-84" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Renda por Quintil de Exposicao e Formalidade'</span>)</span>
<span id="cb27-85"><a href="#cb27-85" aria-hidden="true" tabindex="-1"></a>ax.yaxis.set_major_formatter(mticker.FuncFormatter(<span class="kw">lambda</span> x, _: <span class="ss">f'R$</span><span class="sc">{</span>x<span class="sc">:,.0f}</span><span class="ss">'</span>))</span>
<span id="cb27-86"><a href="#cb27-86" aria-hidden="true" tabindex="-1"></a>ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb27-87"><a href="#cb27-87" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb27-88"><a href="#cb27-88" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb27-89"><a href="#cb27-89" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb27-90"><a href="#cb27-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-91"><a href="#cb27-91" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-92"><a href="#cb27-92" aria-hidden="true" tabindex="-1"></a><span class="co"># 5.4 - Regressao com interacao exposicao x formalidade</span></span>
<span id="cb27-93"><a href="#cb27-93" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb27-94"><a href="#cb27-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Regressao: log(renda) ~ exposicao * formalidade + controles ---"</span>)</span>
<span id="cb27-95"><a href="#cb27-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-96"><a href="#cb27-96" aria-hidden="true" tabindex="-1"></a>df_reg_formal <span class="op">=</span> df_renda[[<span class="st">'rendimento_habitual'</span>, <span class="st">'exposure_score'</span>, <span class="st">'formal'</span>,</span>
<span id="cb27-97"><a href="#cb27-97" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'sexo_texto'</span>, <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>, <span class="st">'regiao'</span>]].dropna().copy()</span>
<span id="cb27-98"><a href="#cb27-98" aria-hidden="true" tabindex="-1"></a>df_reg_formal[<span class="st">'log_renda'</span>] <span class="op">=</span> np.log(df_reg_formal[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb27-99"><a href="#cb27-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-100"><a href="#cb27-100" aria-hidden="true" tabindex="-1"></a>model_formal <span class="op">=</span> smf.wls(</span>
<span id="cb27-101"><a href="#cb27-101" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_renda ~ exposure_score * formal + C(sexo_texto) + C(raca_agregada) + idade + I(idade**2) + C(regiao)'</span>,</span>
<span id="cb27-102"><a href="#cb27-102" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_reg_formal,</span>
<span id="cb27-103"><a href="#cb27-103" aria-hidden="true" tabindex="-1"></a>    weights<span class="op">=</span>df_renda.loc[df_reg_formal.index, <span class="st">'peso'</span>]</span>
<span id="cb27-104"><a href="#cb27-104" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb27-105"><a href="#cb27-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-106"><a href="#cb27-106" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  exposure_score:         </span><span class="sc">{</span>model_formal<span class="sc">.</span>params[<span class="st">'exposure_score'</span>]<span class="sc">:+.4f}</span><span class="ss"> "</span></span>
<span id="cb27-107"><a href="#cb27-107" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(p=</span><span class="sc">{</span>model_formal<span class="sc">.</span>pvalues[<span class="st">'exposure_score'</span>]<span class="sc">:.4f}{</span>sig_stars(model_formal.pvalues[<span class="st">'exposure_score'</span>])<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb27-108"><a href="#cb27-108" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  formal:                 </span><span class="sc">{</span>model_formal<span class="sc">.</span>params[<span class="st">'formal'</span>]<span class="sc">:+.4f}</span><span class="ss"> "</span></span>
<span id="cb27-109"><a href="#cb27-109" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(p=</span><span class="sc">{</span>model_formal<span class="sc">.</span>pvalues[<span class="st">'formal'</span>]<span class="sc">:.4f}{</span>sig_stars(model_formal.pvalues[<span class="st">'formal'</span>])<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb27-110"><a href="#cb27-110" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  exposure_score:formal:  </span><span class="sc">{</span>model_formal<span class="sc">.</span>params[<span class="st">'exposure_score:formal'</span>]<span class="sc">:+.4f}</span><span class="ss"> "</span></span>
<span id="cb27-111"><a href="#cb27-111" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"(p=</span><span class="sc">{</span>model_formal<span class="sc">.</span>pvalues[<span class="st">'exposure_score:formal'</span>]<span class="sc">:.4f}{</span>sig_stars(model_formal.pvalues[<span class="st">'exposure_score:formal'</span>])<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb27-112"><a href="#cb27-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  R²: </span><span class="sc">{</span>model_formal<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss"> | N: </span><span class="sc">{</span><span class="bu">int</span>(model_formal.nobs)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb27-113"><a href="#cb27-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-114"><a href="#cb27-114" aria-hidden="true" tabindex="-1"></a>coef_interacao <span class="op">=</span> model_formal.params[<span class="st">'exposure_score:formal'</span>]</span>
<span id="cb27-115"><a href="#cb27-115" aria-hidden="true" tabindex="-1"></a>direcao <span class="op">=</span> <span class="st">"MENOR"</span> <span class="cf">if</span> coef_interacao <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"MAIOR"</span></span>
<span id="cb27-116"><a href="#cb27-116" aria-hidden="true" tabindex="-1"></a>beneficiario <span class="op">=</span> <span class="st">"informais"</span> <span class="cf">if</span> coef_interacao <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">"formais"</span></span>
<span id="cb27-117"><a href="#cb27-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-118"><a href="#cb27-118" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Interpretacao: A interacao exposicao:formal e significativa"</span>)</span>
<span id="cb27-119"><a href="#cb27-119" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  (coef = </span><span class="sc">{</span>coef_interacao<span class="sc">:.4f}</span><span class="ss">, p&lt;0.001)."</span>)</span>
<span id="cb27-120"><a href="#cb27-120" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  O retorno da exposicao sobre a renda e </span><span class="sc">{</span>direcao<span class="sc">}</span><span class="ss"> para trabalhadores"</span>)</span>
<span id="cb27-121"><a href="#cb27-121" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  formais do que para informais."</span>)</span>
<span id="cb27-122"><a href="#cb27-122" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Trabalhadores </span><span class="sc">{</span>beneficiario<span class="sc">}</span><span class="ss"> de alta exposicao capturam mais retorno,"</span>)</span>
<span id="cb27-123"><a href="#cb27-123" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  possivelmente refletindo profissionais liberais autonomos (consultores,"</span>)</span>
<span id="cb27-124"><a href="#cb27-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  advogados, medicos com CNPJ) que operam na informalidade mas em"</span>)</span>
<span id="cb27-125"><a href="#cb27-125" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  ocupacoes de alta qualificacao e alta exposicao a IA."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXPOSICAO: FORMAL vs INFORMAL
======================================================================
  Formal: Exp=0.305 [IC: 0.305-0.305] | Renda=R$3,216 | Pop=41.4M
  Informal: Exp=0.258 [IC: 0.258-0.259] | Renda=R$3,519 | Pop=55.5M
  Gap (F-I): +0.046 | t=1549.24, p=0.0000 ***</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">% Alta Exp.</th>
<th data-quarto-table-cell-role="th">Renda Media (R$)</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Tipo</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Formal</th>
<td>0.305</td>
<td>0.305</td>
<td>0.305</td>
<td>14.804</td>
<td>3216.103</td>
<td>41.442</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Informal</th>
<td>0.258</td>
<td>0.258</td>
<td>0.259</td>
<td>6.555</td>
<td>3518.691</td>
<td>55.525</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-8-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
INVESTIGACAO: RENDA POR QUINTIL DE EXPOSICAO E FORMALIDADE
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Tipo</th>
<th data-quarto-table-cell-role="th">Formal</th>
<th data-quarto-table-cell-role="th">Informal</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Quintil</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q1 (Baixa)</th>
<td>2135.000</td>
<td>1919.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Q2</th>
<td>2545.000</td>
<td>2394.000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q3</th>
<td>2972.000</td>
<td>3565.000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Q4</th>
<td>3898.000</td>
<td>6058.000</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Q5 (Alta)</th>
<td>4058.000</td>
<td>4881.000</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-8-output-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Regressao: log(renda) ~ exposicao * formalidade + controles ---

  exposure_score:         +2.1301 (p=0.0000***)
  formal:                 +0.4471 (p=0.0000***)
  exposure_score:formal:  -1.2137 (p=0.0000***)
  R²: 0.2485 | N: 202,471

  Interpretacao: A interacao exposicao:formal e significativa
  (coef = -1.2137, p&lt;0.001).
  O retorno da exposicao sobre a renda e MENOR para trabalhadores
  formais do que para informais.
  Trabalhadores informais de alta exposicao capturam mais retorno,
  possivelmente refletindo profissionais liberais autonomos (consultores,
  advogados, medicos com CNPJ) que operam na informalidade mas em
  ocupacoes de alta qualificacao e alta exposicao a IA.</code></pre>
</div>
</div>
</section>
<section id="b.-augmentation-vs.-automacao" class="level3" data-number="1.10">
<h3 data-number="1.10" class="anchored" data-anchor-id="b.-augmentation-vs.-automacao"><span class="header-section-number">1.10</span> 5b. Augmentation vs.&nbsp;Automacao</h3>
<p>Comparacao entre trabalhadores em gradientes de complementaridade (G1-G2) e de transformacao radical (G3-G4), seguindo a distincao central do WP140.</p>
<p><strong>Analises:</strong> - Perfil comparativo: renda, genero, raca, escolaridade, formalidade, setor - Grafico de barras agrupadas lado a lado - Testes de diferenca entre os dois grupos</p>
<blockquote class="blockquote">
<p><strong>Referencia WP140:</strong> “The results suggest that most occupations and industries are more likely to be transformed through augmentation rather than automation” (Gmyrek et al., 2025, p.1). Esta secao investiga se esse padrao se confirma para o Brasil.</p>
</blockquote>
<div id="54819dc0" class="cell" data-execution_count="71">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.5b - Augmentation vs. Automacao</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>AUGMENTATION <span class="op">=</span> [<span class="st">'Exposed: Gradient 1'</span>, <span class="st">'Exposed: Gradient 2'</span>]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>HIGH_TRANSFORM <span class="op">=</span> [<span class="st">'Exposed: Gradient 3'</span>, <span class="st">'Exposed: Gradient 4'</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>df_score[<span class="st">'tipo_exposicao'</span>] <span class="op">=</span> np.where(</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    df_score[<span class="st">'exposure_gradient'</span>].isin(AUGMENTATION), <span class="st">'Augmentation (G1-G2)'</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    np.where(df_score[<span class="st">'exposure_gradient'</span>].isin(HIGH_TRANSFORM), <span class="st">'Alta Transformacao (G3-G4)'</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nao/Minima Exposicao'</span>))</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apenas os dois grupos de interesse</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>df_aug <span class="op">=</span> df_score[df_score[<span class="st">'tipo_exposicao'</span>].isin(</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Augmentation (G1-G2)'</span>, <span class="st">'Alta Transformacao (G3-G4)'</span>])]</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AUGMENTATION vs. ALTA TRANSFORMACAO"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>rows_tipo <span class="op">=</span> []</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> tipo <span class="kw">in</span> [<span class="st">'Augmentation (G1-G2)'</span>, <span class="st">'Alta Transformacao (G3-G4)'</span>]:</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_aug[df_aug[<span class="st">'tipo_exposicao'</span>] <span class="op">==</span> tipo]</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    sub_r <span class="op">=</span> sub[sub[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    rows_tipo.append({</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Tipo'</span>: tipo,</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: weighted_mean(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>]),</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Renda Media'</span>: weighted_mean(sub_r[<span class="st">'rendimento_habitual'</span>], sub_r[<span class="st">'peso'</span>]) <span class="cf">if</span> <span class="bu">len</span>(sub_r) <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> np.nan,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Mulheres'</span>: weighted_mean((sub[<span class="st">'sexo_texto'</span>]<span class="op">==</span><span class="st">'Mulher'</span>).astype(<span class="bu">int</span>), sub[<span class="st">'peso'</span>])<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'</span><span class="sc">% F</span><span class="st">ormal'</span>: weighted_mean(sub[<span class="st">'formal'</span>], sub[<span class="st">'peso'</span>])<span class="op">*</span><span class="dv">100</span>,</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Sup. Completo'</span>: weighted_mean(</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>            (sub[<span class="st">'edu_simples'</span>]<span class="op">==</span><span class="st">'Sup.Comp.'</span>).astype(<span class="bu">int</span>), sub[<span class="st">'peso'</span>])<span class="op">*</span><span class="dv">100</span> <span class="cf">if</span> <span class="st">'edu_simples'</span> <span class="kw">in</span> sub.columns <span class="cf">else</span> np.nan,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>tab_tipo <span class="op">=</span> pd.DataFrame(rows_tipo).set_index(<span class="st">'Tipo'</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>display(tab_tipo.<span class="bu">round</span>(<span class="dv">1</span>))</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico de barras agrupadas</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>metricas <span class="op">=</span> [<span class="st">'Renda Media'</span>, <span class="st">'% Mulheres'</span>, <span class="st">'</span><span class="sc">% F</span><span class="st">ormal'</span>, <span class="st">'% Sup. Completo'</span>]</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="bu">len</span>(metricas), figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">5</span>))</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ax, met <span class="kw">in</span> <span class="bu">zip</span>(axes, metricas):</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> [tab_tipo.loc[t, met] <span class="cf">for</span> t <span class="kw">in</span> tab_tipo.index]</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    bars <span class="op">=</span> ax.bar(<span class="bu">range</span>(<span class="bu">len</span>(vals)), vals, color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'#d62728'</span>])</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(vals)))</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels([<span class="st">'Augment.'</span>, <span class="st">'Alta Transf.'</span>], fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    ax.set_title(met, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> b, v <span class="kw">in</span> <span class="bu">zip</span>(bars, vals):</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> np.isnan(v):</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>            ax.text(b.get_x()<span class="op">+</span>b.get_width()<span class="op">/</span><span class="dv">2</span>, b.get_height()<span class="op">+</span><span class="fl">0.5</span>,</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>                    <span class="ss">f'</span><span class="sc">{</span>v<span class="sc">:.1f}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'Augmentation vs. Alta Transformacao: Perfil Comparativo'</span>, fontsize<span class="op">=</span><span class="dv">13</span>)</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Teste de diferenca</span></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>sub_aug <span class="op">=</span> df_aug[df_aug[<span class="st">'tipo_exposicao'</span>] <span class="op">==</span> <span class="st">'Augmentation (G1-G2)'</span>]</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>sub_ht <span class="op">=</span> df_aug[df_aug[<span class="st">'tipo_exposicao'</span>] <span class="op">==</span> <span class="st">'Alta Transformacao (G3-G4)'</span>]</span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>sub_aug_r <span class="op">=</span> sub_aug[sub_aug[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>sub_ht_r <span class="op">=</span> sub_ht[sub_ht[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(sub_aug_r) <span class="op">&gt;</span> <span class="dv">10</span> <span class="kw">and</span> <span class="bu">len</span>(sub_ht_r) <span class="op">&gt;</span> <span class="dv">10</span>:</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>    t_aug, p_aug <span class="op">=</span> weighted_ttest_2groups(</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>        sub_aug_r[<span class="st">'rendimento_habitual'</span>], sub_aug_r[<span class="st">'peso'</span>],</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>        sub_ht_r[<span class="st">'rendimento_habitual'</span>], sub_ht_r[<span class="st">'peso'</span>])</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>    d_aug <span class="op">=</span> weighted_cohen_d(</span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>        sub_aug_r[<span class="st">'rendimento_habitual'</span>].values, sub_aug_r[<span class="st">'peso'</span>].values,</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>        sub_ht_r[<span class="st">'rendimento_habitual'</span>].values, sub_ht_r[<span class="st">'peso'</span>].values)</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Diferenca de renda (Aug vs HT): t=</span><span class="sc">{</span>t_aug<span class="sc">:.2f}</span><span class="ss">, p=</span><span class="sc">{</span>p_aug<span class="sc">:.4f}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(p_aug)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"d de Cohen: </span><span class="sc">{</span>d_aug<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
AUGMENTATION vs. ALTA TRANSFORMACAO
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">Renda Media</th>
<th data-quarto-table-cell-role="th">% Mulheres</th>
<th data-quarto-table-cell-role="th">% Formal</th>
<th data-quarto-table-cell-role="th">% Sup. Completo</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Tipo</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Augmentation (G1-G2)</th>
<td>18.700</td>
<td>0.400</td>
<td>4179.200</td>
<td>47.100</td>
<td>44.000</td>
<td>31.900</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Alta Transformacao (G3-G4)</th>
<td>9.800</td>
<td>0.600</td>
<td>3793.100</td>
<td>62.900</td>
<td>62.800</td>
<td>44.300</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-9-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Diferenca de renda (Aug vs HT): t=181.00, p=0.0000 ***
d de Cohen: 0.072</code></pre>
</div>
</div>
</section>
<section id="setor-e-ocupacao" class="level3" data-number="1.11">
<h3 data-number="1.11" class="anchored" data-anchor-id="setor-e-ocupacao"><span class="header-section-number">1.11</span> 6. Setor e ocupacao</h3>
<p>Exposicao media por setor_agregado e por grande_grupo; concentracao em setores criticos IA.</p>
<p><strong>Analises:</strong> - Exposicao por setor com ICs e ANOVA ponderada - Exposicao por grupo ocupacional com ICs e ANOVA ponderada - Educacao DENTRO de grupos ocupacionais (cross-tab) - Heatmap regiao x setor</p>
<blockquote class="blockquote">
<p><strong>Nota metodológica:</strong> O R² elevado da ANOVA por grupo ocupacional (≈0.68) é em grande parte um artefato da construção do índice ILO, que atribui scores por ocupação ISCO a 4 dígitos. Como os grandes grupos são agrupamentos a 1 dígito dessas ocupações, a alta explicação é esperada e não constitui um achado empírico.</p>
<p>A variação de exposição DENTRO dos grupos, observada na cross-tab com educação, é mínima — confirmando que o índice é uma propriedade da ocupação, não do indivíduo. A correlação exposição-escolaridade no nível individual opera via sorting: trabalhadores mais educados acessam ocupações de maior exposição.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Conexão com WP140 (Tabela 2):</strong> O ranking ocupacional brasileiro replica a hierarquia global do WP140: Clerical Support Workers (Apoio Administrativo) é o grupo mais exposto, seguido de Professionals e Managers. Elementary Occupations está na base. A única diferença notável é que no Brasil, “Serviços e Vendedores” tem exposição relativamente alta (0.305 vs ~0.25 global), possivelmente pela estrutura do comércio brasileiro que incorpora mais tarefas administrativas/digitais nas funções de venda.</p>
</blockquote>
<div id="19161eed" class="cell" data-execution_count="72">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.6 - Analise de Dados - Setor e ocupacao</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.1 - Exposicao por setor com ICs e ANOVA</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR SETOR ECONOMICO"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>rows_setor <span class="op">=</span> []</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> setor <span class="kw">in</span> <span class="bu">sorted</span>(df_score[<span class="st">'setor_agregado'</span>].unique()):</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'setor_agregado'</span>] <span class="op">==</span> setor]</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(sub) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    n_alta <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    is_critico <span class="op">=</span> setor <span class="kw">in</span> SETORES_CRITICOS_IA</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    rows_setor.append({</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Setor'</span>: setor,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exp.'</span>: n_alta <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Critico IA'</span>: <span class="st">'*'</span> <span class="cf">if</span> is_critico <span class="cf">else</span> <span class="st">''</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>tab_setor <span class="op">=</span> pd.DataFrame(rows_setor).sort_values(<span class="st">'Exp. Media'</span>, ascending<span class="op">=</span><span class="va">False</span>).set_index(<span class="st">'Setor'</span>)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>display(tab_setor.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA ponderada via WLS</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>model_anova_setor <span class="op">=</span> smf.wls(</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(setor_agregado)'</span>,</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_score, weights<span class="op">=</span>df_score[<span class="st">'peso'</span>]</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>f_stat <span class="op">=</span> model_anova_setor.fvalue</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>f_pval <span class="op">=</span> model_anova_setor.f_pvalue</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ANOVA ponderada (setores): F=</span><span class="sc">{</span>f_stat<span class="sc">:.1f}</span><span class="ss">, p=</span><span class="sc">{</span>f_pval<span class="sc">:.2e}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(f_pval)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R²: </span><span class="sc">{</span>model_anova_setor<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss"> (variacao explicada pelos setores)"</span>)</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico setores</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>))</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>tab_plot <span class="op">=</span> tab_setor.reset_index().sort_values(<span class="st">'Exp. Media'</span>)</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#d62728'</span> <span class="cf">if</span> c <span class="op">==</span> <span class="st">'*'</span> <span class="cf">else</span> <span class="st">'steelblue'</span> <span class="cf">for</span> c <span class="kw">in</span> tab_plot[<span class="st">'Critico IA'</span>]]</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>yerr <span class="op">=</span> [tab_plot[<span class="st">'Exp. Media'</span>] <span class="op">-</span> tab_plot[<span class="st">'IC Inf'</span>], tab_plot[<span class="st">'IC Sup'</span>] <span class="op">-</span> tab_plot[<span class="st">'Exp. Media'</span>]]</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>ax.barh(tab_plot[<span class="st">'Setor'</span>], tab_plot[<span class="st">'Exp. Media'</span>], xerr<span class="op">=</span>yerr, color<span class="op">=</span>colors,</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">'white'</span>, linewidth<span class="op">=</span><span class="fl">0.5</span>, capsize<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(tab_plot.iterrows()):</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>    ax.text(row[<span class="st">'Exp. Media'</span>] <span class="op">+</span> <span class="fl">0.01</span>, i, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'Pop. (milhoes)'</span>]<span class="sc">:.1f}</span><span class="ss">M"</span>,</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposicao Media (com IC 95%)'</span>)</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Exposicao por Setor (ANOVA: F=</span><span class="sc">{</span>f_stat<span class="sc">:.0f}</span><span class="ss">, p&lt;0.001)'</span>)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>ax.axvline(weighted_mean(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>]),</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>           color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.2 - Exposicao por grupo ocupacional com ICs e ANOVA</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR GRANDE GRUPO OCUPACIONAL"</span>)</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a>df_gg <span class="op">=</span> df_score[df_score[<span class="st">'grande_grupo'</span>].notna()]</span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a>rows_grupo <span class="op">=</span> []</span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> grupo <span class="kw">in</span> <span class="bu">sorted</span>(df_gg[<span class="st">'grande_grupo'</span>].unique()):</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_gg[df_gg[<span class="st">'grande_grupo'</span>] <span class="op">==</span> grupo]</span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>    rows_grupo.append({</span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Grande Grupo'</span>: grupo,</span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>tab_grupo <span class="op">=</span> pd.DataFrame(rows_grupo).sort_values(<span class="st">'Exp. Media'</span>, ascending<span class="op">=</span><span class="va">False</span>).set_index(<span class="st">'Grande Grupo'</span>)</span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>display(tab_grupo.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a>model_anova_grupo <span class="op">=</span> smf.wls(</span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(grande_grupo)'</span>,</span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_gg, weights<span class="op">=</span>df_gg[<span class="st">'peso'</span>]</span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ANOVA ponderada (grupos): F=</span><span class="sc">{</span>model_anova_grupo<span class="sc">.</span>fvalue<span class="sc">:.1f}</span><span class="ss">, "</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"p=</span><span class="sc">{</span>model_anova_grupo<span class="sc">.</span>f_pvalue<span class="sc">:.2e}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(model_anova_grupo.f_pvalue)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R²: </span><span class="sc">{</span>model_anova_grupo<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.3 - Educacao DENTRO de grupos ocupacionais</span></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO MEDIA POR EDUCACAO DENTRO DE CADA GRUPO OCUPACIONAL"</span>)</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a>df_edu_gg <span class="op">=</span> df_gg.copy()</span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar niveis de instrucao simplificados para legibilidade</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>edu_map_simples <span class="op">=</span> {</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'1'</span>: <span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'2'</span>: <span class="st">'Sem/Fund.Inc.'</span>,</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'3'</span>: <span class="st">'Fund.Comp.'</span>, <span class="st">'4'</span>: <span class="st">'Med.Inc.'</span>,</span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>    <span class="st">'5'</span>: <span class="st">'Med.Comp.'</span>, <span class="st">'6'</span>: <span class="st">'Sup.Inc.'</span>, <span class="st">'7'</span>: <span class="st">'Sup.Comp.'</span>,</span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>df_edu_gg[<span class="st">'edu_simples'</span>] <span class="op">=</span> df_edu_gg[<span class="st">'nivel_instrucao'</span>].astype(<span class="bu">str</span>).<span class="bu">map</span>(edu_map_simples)</span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>pivot_edu <span class="op">=</span> df_edu_gg.groupby([<span class="st">'grande_grupo'</span>, <span class="st">'edu_simples'</span>]).<span class="bu">apply</span>(</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: weighted_mean(x[<span class="st">'exposure_score'</span>], x[<span class="st">'peso'</span>])</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>).unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Reordenar colunas</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>edu_order <span class="op">=</span> [<span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'Fund.Comp.'</span>, <span class="st">'Med.Inc.'</span>, <span class="st">'Med.Comp.'</span>, <span class="st">'Sup.Inc.'</span>, <span class="st">'Sup.Comp.'</span>]</span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>cols_available <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> edu_order <span class="cf">if</span> c <span class="kw">in</span> pivot_edu.columns]</span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>pivot_edu <span class="op">=</span> pivot_edu[cols_available]</span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>display(pivot_edu.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretacao: Dentro do mesmo grupo ocupacional, a exposicao"</span>)</span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"tende a ser similar independente da escolaridade, pois o indice"</span>)</span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"e atribuido por ocupacao (ISCO-08), nao por individuo."</span>)</span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a><span class="co"># Verificar matching dos setores criticos</span></span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>setores_no_df <span class="op">=</span> <span class="bu">sorted</span>(df_score[<span class="st">'setor_agregado'</span>].unique())</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>matched_setores <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> SETORES_CRITICOS_IA <span class="cf">if</span> s <span class="kw">in</span> setores_no_df]</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(matched_setores) <span class="op">&lt;</span> <span class="bu">len</span>(SETORES_CRITICOS_IA):</span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a>    unmatched <span class="op">=</span> [s <span class="cf">for</span> s <span class="kw">in</span> SETORES_CRITICOS_IA <span class="cf">if</span> s <span class="kw">not</span> <span class="kw">in</span> setores_no_df]</span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  </span><span class="ch">\u26a0</span><span class="ss"> Setores criticos sem match no df: </span><span class="sc">{</span>unmatched<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Setores disponiveis no df: </span><span class="sc">{</span>setores_no_df<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Setores criticos IA: todos </span><span class="sc">{</span><span class="bu">len</span>(matched_setores)<span class="sc">}</span><span class="ss"> encontrados no dataframe."</span>)</span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="co"># 6.4 - Heatmap regiao x setor</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>pivot_rs <span class="op">=</span> df_score.groupby([<span class="st">'regiao'</span>, <span class="st">'setor_agregado'</span>]).<span class="bu">apply</span>(</span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: weighted_mean(x[<span class="st">'exposure_score'</span>], x[<span class="st">'peso'</span>])</span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>).unstack(fill_value<span class="op">=</span>np.nan)</span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Ordenar setores por media</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>setor_order <span class="op">=</span> pivot_rs.mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>).index</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a>pivot_rs <span class="op">=</span> pivot_rs[setor_order]</span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a>sns.heatmap(pivot_rs, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, cmap<span class="op">=</span><span class="st">'YlOrRd'</span>, ax<span class="op">=</span>ax,</span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>            linewidths<span class="op">=</span><span class="fl">0.5</span>, linecolor<span class="op">=</span><span class="st">'white'</span>, cbar_kws<span class="op">=</span>{<span class="st">'label'</span>: <span class="st">'Exposicao Media'</span>})</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Exposicao Media: Regiao x Setor'</span>)</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">''</span>)</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">''</span>)</span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXPOSICAO POR SETOR ECONOMICO
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">% Alta Exp.</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
<th data-quarto-table-cell-role="th">Critico IA</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Setor</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Finanças e Seguros</th>
<td>0.509</td>
<td>0.509</td>
<td>0.509</td>
<td>53.496</td>
<td>1.566</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Informação e Comunicação</th>
<td>0.445</td>
<td>0.445</td>
<td>0.445</td>
<td>30.028</td>
<td>1.891</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Serviços Profissionais</th>
<td>0.409</td>
<td>0.409</td>
<td>0.410</td>
<td>29.587</td>
<td>4.322</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Atividades Imobiliárias</th>
<td>0.384</td>
<td>0.384</td>
<td>0.384</td>
<td>17.071</td>
<td>0.727</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Administração Pública</th>
<td>0.352</td>
<td>0.352</td>
<td>0.352</td>
<td>26.280</td>
<td>4.274</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Outros Serviços</th>
<td>0.331</td>
<td>0.331</td>
<td>0.331</td>
<td>7.279</td>
<td>19.114</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Artes e Cultura</th>
<td>0.317</td>
<td>0.316</td>
<td>0.317</td>
<td>9.281</td>
<td>1.153</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Saúde</th>
<td>0.300</td>
<td>0.300</td>
<td>0.300</td>
<td>13.714</td>
<td>6.196</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Utilidades</th>
<td>0.293</td>
<td>0.293</td>
<td>0.294</td>
<td>15.105</td>
<td>0.727</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Serviços Administrativos</th>
<td>0.292</td>
<td>0.292</td>
<td>0.292</td>
<td>18.234</td>
<td>4.558</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Educação</th>
<td>0.290</td>
<td>0.290</td>
<td>0.290</td>
<td>9.013</td>
<td>7.186</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Transporte</th>
<td>0.280</td>
<td>0.280</td>
<td>0.280</td>
<td>7.951</td>
<td>5.741</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Alojamento e Alimentação</th>
<td>0.266</td>
<td>0.266</td>
<td>0.266</td>
<td>4.414</td>
<td>5.109</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Comércio</th>
<td>0.256</td>
<td>0.256</td>
<td>0.256</td>
<td>7.156</td>
<td>3.158</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ind. Transformação</th>
<td>0.210</td>
<td>0.210</td>
<td>0.210</td>
<td>4.374</td>
<td>18.697</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Serviços Domésticos</th>
<td>0.160</td>
<td>0.160</td>
<td>0.160</td>
<td>0.000</td>
<td>5.302</td>
<td></td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Construção</th>
<td>0.146</td>
<td>0.146</td>
<td>0.147</td>
<td>2.494</td>
<td>7.244</td>
<td></td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ANOVA ponderada (setores): F=5031.9, p=0.00e+00 ***
R²: 0.2808 (variacao explicada pelos setores)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-10-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
EXPOSICAO POR GRANDE GRUPO OCUPACIONAL
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Grande Grupo</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Apoio administrativo</th>
<td>0.554</td>
<td>0.554</td>
<td>0.554</td>
<td>8.197</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Dirigentes e gerentes</th>
<td>0.400</td>
<td>0.400</td>
<td>0.400</td>
<td>3.543</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Profissionais das ciências</th>
<td>0.353</td>
<td>0.353</td>
<td>0.354</td>
<td>13.239</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Técnicos nível médio</th>
<td>0.345</td>
<td>0.345</td>
<td>0.345</td>
<td>8.990</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Serviços e vendedores</th>
<td>0.305</td>
<td>0.305</td>
<td>0.305</td>
<td>21.275</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Operadores de máquinas</th>
<td>0.223</td>
<td>0.223</td>
<td>0.223</td>
<td>9.427</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Agropecuária qualificada</th>
<td>0.174</td>
<td>0.174</td>
<td>0.174</td>
<td>4.442</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Indústria qualificada</th>
<td>0.151</td>
<td>0.151</td>
<td>0.151</td>
<td>12.711</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ocupações elementares</th>
<td>0.130</td>
<td>0.130</td>
<td>0.130</td>
<td>15.144</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ANOVA ponderada (grupos): F=53767.9, p=0.00e+00 ***
R²: 0.6759

======================================================================
EXPOSICAO MEDIA POR EDUCACAO DENTRO DE CADA GRUPO OCUPACIONAL
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">edu_simples</th>
<th data-quarto-table-cell-role="th">Sem/Fund.Inc.</th>
<th data-quarto-table-cell-role="th">Fund.Comp.</th>
<th data-quarto-table-cell-role="th">Med.Inc.</th>
<th data-quarto-table-cell-role="th">Med.Comp.</th>
<th data-quarto-table-cell-role="th">Sup.Inc.</th>
<th data-quarto-table-cell-role="th">Sup.Comp.</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">grande_grupo</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Agropecuária qualificada</th>
<td>0.174</td>
<td>0.174</td>
<td>0.173</td>
<td>0.175</td>
<td>0.176</td>
<td>0.176</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Apoio administrativo</th>
<td>0.497</td>
<td>0.494</td>
<td>0.505</td>
<td>0.542</td>
<td>0.569</td>
<td>0.582</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Dirigentes e gerentes</th>
<td>0.373</td>
<td>0.388</td>
<td>0.385</td>
<td>0.401</td>
<td>0.404</td>
<td>0.401</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Indústria qualificada</th>
<td>0.131</td>
<td>0.143</td>
<td>0.147</td>
<td>0.159</td>
<td>0.175</td>
<td>0.181</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Ocupações elementares</th>
<td>0.125</td>
<td>0.128</td>
<td>0.128</td>
<td>0.136</td>
<td>0.144</td>
<td>0.137</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Operadores de máquinas</th>
<td>0.209</td>
<td>0.219</td>
<td>0.219</td>
<td>0.226</td>
<td>0.240</td>
<td>0.238</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Profissionais das ciências</th>
<td>0.316</td>
<td>0.343</td>
<td>0.379</td>
<td>0.371</td>
<td>0.368</td>
<td>0.352</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Serviços e vendedores</th>
<td>0.293</td>
<td>0.292</td>
<td>0.293</td>
<td>0.306</td>
<td>0.312</td>
<td>0.321</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Técnicos nível médio</th>
<td>0.354</td>
<td>0.359</td>
<td>0.368</td>
<td>0.321</td>
<td>0.354</td>
<td>0.366</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretacao: Dentro do mesmo grupo ocupacional, a exposicao
tende a ser similar independente da escolaridade, pois o indice
e atribuido por ocupacao (ISCO-08), nao por individuo.

  ⚠ Setores criticos sem match no df: ['Informacao e Comunicacao', 'Financas e Seguros', 'Servicos Profissionais']
  Setores disponiveis no df: ['Administração Pública', 'Alojamento e Alimentação', 'Artes e Cultura', 'Atividades Imobiliárias', 'Comércio', 'Construção', 'Educação', 'Finanças e Seguros', 'Ind. Transformação', 'Informação e Comunicação', 'Outros Serviços', 'Saúde', 'Serviços Administrativos', 'Serviços Domésticos', 'Serviços Profissionais', 'Transporte', 'Utilidades']</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-10-output-10.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="b.-fluxo-escolaridade---ocupacao---gradiente-de-exposicao" class="level3" data-number="1.12">
<h3 data-number="1.12" class="anchored" data-anchor-id="b.-fluxo-escolaridade---ocupacao---gradiente-de-exposicao"><span class="header-section-number">1.12</span> 6b. Fluxo: Escolaridade -&gt; Ocupacao -&gt; Gradiente de Exposicao</h3>
<p>Diagrama de fluxo mostrando o sorting educacao -&gt; ocupacao -&gt; exposicao.</p>
<div id="7af16bf7" class="cell" data-execution_count="73">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.6b - Sankey: Escolaridade -&gt; Grupo Ocupacional -&gt; Gradiente</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 6b - Sankey: Escolaridade -&gt; Grupo Ocupacional -&gt; Gradiente</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Garantir edu_simples em df_score</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'edu_simples'</span> <span class="kw">not</span> <span class="kw">in</span> df_score.columns:</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    edu_map_simples <span class="op">=</span> {<span class="st">'1'</span>: <span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'2'</span>: <span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'3'</span>: <span class="st">'Fund.Comp.'</span>, <span class="st">'4'</span>: <span class="st">'Med.Inc.'</span>, <span class="st">'5'</span>: <span class="st">'Med.Comp.'</span>, <span class="st">'6'</span>: <span class="st">'Sup.Inc.'</span>, <span class="st">'7'</span>: <span class="st">'Sup.Comp.'</span>}</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    col_edu <span class="op">=</span> <span class="st">'nivel_instrucao'</span> <span class="cf">if</span> <span class="st">'nivel_instrucao'</span> <span class="kw">in</span> df_score.columns <span class="cf">else</span> <span class="st">'vd3004'</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    df_score[<span class="st">'edu_simples'</span>] <span class="op">=</span> df_score[col_edu].astype(<span class="bu">str</span>).<span class="bu">map</span>(edu_map_simples).fillna(<span class="st">'Outros'</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar fluxos</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>flows <span class="op">=</span> df_score.groupby([<span class="st">'edu_simples'</span>, <span class="st">'grande_grupo'</span>, <span class="st">'exposure_gradient'</span>])[<span class="st">'peso'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>flows <span class="op">=</span> flows[flows[<span class="st">'peso'</span>] <span class="op">&gt;</span> <span class="dv">500000</span>]  <span class="co"># filtrar fluxos pequenos</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Usar plotly para Sankey</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Construir nos e links</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    edu_cats <span class="op">=</span> <span class="bu">sorted</span>(flows[<span class="st">'edu_simples'</span>].unique())</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    gg_cats <span class="op">=</span> <span class="bu">sorted</span>(flows[<span class="st">'grande_grupo'</span>].unique())</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    grad_cats <span class="op">=</span> [g <span class="cf">for</span> g <span class="kw">in</span> GRADIENT_ORDER <span class="cf">if</span> g <span class="kw">in</span> flows[<span class="st">'exposure_gradient'</span>].unique()]</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    all_nodes <span class="op">=</span> <span class="bu">list</span>(edu_cats) <span class="op">+</span> <span class="bu">list</span>(gg_cats) <span class="op">+</span> <span class="bu">list</span>(grad_cats)</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    sources, targets, values <span class="op">=</span> [], [], []</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Edu -&gt; GG</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> flows.groupby([<span class="st">'edu_simples'</span>, <span class="st">'grande_grupo'</span>])[<span class="st">'peso'</span>].<span class="bu">sum</span>().reset_index().iterrows():</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        sources.append(all_nodes.index(row[<span class="st">'edu_simples'</span>]))</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>        targets.append(all_nodes.index(row[<span class="st">'grande_grupo'</span>]))</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        values.append(row[<span class="st">'peso'</span>] <span class="op">/</span> <span class="fl">1e6</span>)</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># GG -&gt; Gradiente</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> flows.groupby([<span class="st">'grande_grupo'</span>, <span class="st">'exposure_gradient'</span>])[<span class="st">'peso'</span>].<span class="bu">sum</span>().reset_index().iterrows():</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>        sources.append(all_nodes.index(row[<span class="st">'grande_grupo'</span>]))</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>        targets.append(all_nodes.index(row[<span class="st">'exposure_gradient'</span>]))</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        values.append(row[<span class="st">'peso'</span>] <span class="op">/</span> <span class="fl">1e6</span>)</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    fig <span class="op">=</span> go.Figure(go.Sankey(</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>        node<span class="op">=</span><span class="bu">dict</span>(label<span class="op">=</span>all_nodes, pad<span class="op">=</span><span class="dv">15</span>, thickness<span class="op">=</span><span class="dv">20</span>),</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>        link<span class="op">=</span><span class="bu">dict</span>(source<span class="op">=</span>sources, target<span class="op">=</span>targets, value<span class="op">=</span>values)))</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    fig.update_layout(title<span class="op">=</span><span class="st">'Fluxo: Escolaridade -&gt; Ocupacao -&gt; Gradiente de Exposicao'</span>,</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>                      font_size<span class="op">=</span><span class="dv">10</span>, width<span class="op">=</span><span class="dv">1200</span>, height<span class="op">=</span><span class="dv">700</span>)</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    fig.show()</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">ImportError</span>:</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"plotly nao instalado. Instalar com: %pip install plotly"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>plotly nao instalado. Instalar com: %pip install plotly</code></pre>
</div>
</div>
</section>
<section id="regiao" class="level3" data-number="1.13">
<h3 data-number="1.13" class="anchored" data-anchor-id="regiao"><span class="header-section-number">1.13</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-1" class="level3" data-number="1.14">
<h3 data-number="1.14" class="anchored" data-anchor-id="regiao-1"><span class="header-section-number">1.14</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-2" class="level3" data-number="1.15">
<h3 data-number="1.15" class="anchored" data-anchor-id="regiao-2"><span class="header-section-number">1.15</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-3" class="level3" data-number="1.16">
<h3 data-number="1.16" class="anchored" data-anchor-id="regiao-3"><span class="header-section-number">1.16</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-4" class="level3" data-number="1.17">
<h3 data-number="1.17" class="anchored" data-anchor-id="regiao-4"><span class="header-section-number">1.17</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-5" class="level3" data-number="1.18">
<h3 data-number="1.18" class="anchored" data-anchor-id="regiao-5"><span class="header-section-number">1.18</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="regiao-6" class="level3" data-number="1.19">
<h3 data-number="1.19" class="anchored" data-anchor-id="regiao-6"><span class="header-section-number">1.19</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
<blockquote class="blockquote">
<p><strong>Conexão com WP140 (dimensão geográfica):</strong> O WP140 analisa variação entre países (Figura 6, p.&nbsp;22-23) e encontra que países de maior renda per capita têm maior exposição, refletindo sua estrutura produtiva mais intensiva em serviços. Replicamos esse padrão DENTRO do Brasil: regiões de maior PIB per capita (Sudeste, Sul, Centro-Oeste) apresentam maior exposição. O DF (0.326) supera inclusive a média de high-income countries (~0.36 no WP140), refletindo a concentração de serviços públicos e profissionais qualificados.</p>
</blockquote>
<div id="e5cf59f7" class="cell" data-execution_count="74">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.7 - Analise de Dados - Regiao</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.1 - Exposicao por regiao com ICs e ANOVA</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EXPOSICAO POR REGIAO"</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>rows_regiao <span class="op">=</span> []</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> regiao <span class="kw">in</span> [<span class="st">'Norte'</span>, <span class="st">'Nordeste'</span>, <span class="st">'Centro-Oeste'</span>, <span class="st">'Sudeste'</span>, <span class="st">'Sul'</span>]:</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'regiao'</span>] <span class="op">==</span> regiao]</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    n_alta <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS)][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    n_nao <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> <span class="st">'Not Exposed'</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    rows_regiao.append({</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Regiao'</span>: regiao,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Alta Exp.'</span>: n_alta <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'% Nao Exposto'</span>: n_nao <span class="op">/</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>,</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>regiao<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>mean_e<span class="sc">:.3f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo<span class="sc">:.3f}</span><span class="ss">-</span><span class="sc">{</span>ci_hi<span class="sc">:.3f}</span><span class="ss">] | "</span></span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>          <span class="ss">f"Alta: </span><span class="sc">{</span>n_alta<span class="op">/</span>sub[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">% | Pop: </span><span class="sc">{</span>sub[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss">M"</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>tab_regiao <span class="op">=</span> pd.DataFrame(rows_regiao).set_index(<span class="st">'Regiao'</span>)</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>display(tab_regiao.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA</span></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>model_anova_reg <span class="op">=</span> smf.wls(</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(regiao)'</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_score, weights<span class="op">=</span>df_score[<span class="st">'peso'</span>]</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>).fit()</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">ANOVA ponderada (regioes): F=</span><span class="sc">{</span>model_anova_reg<span class="sc">.</span>fvalue<span class="sc">:.1f}</span><span class="ss">, "</span></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>      <span class="ss">f"p=</span><span class="sc">{</span>model_anova_reg<span class="sc">.</span>f_pvalue<span class="sc">:.2e}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(model_anova_reg.f_pvalue)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R²: </span><span class="sc">{</span>model_anova_reg<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss"> (pouca variacao explicada apenas por regiao)"</span>)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico regioes</span></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>tab_r <span class="op">=</span> tab_regiao.reset_index().sort_values(<span class="st">'Exp. Media'</span>)</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>yerr_r <span class="op">=</span> [tab_r[<span class="st">'Exp. Media'</span>] <span class="op">-</span> tab_r[<span class="st">'IC Inf'</span>], tab_r[<span class="st">'IC Sup'</span>] <span class="op">-</span> tab_r[<span class="st">'Exp. Media'</span>]]</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>ax.barh(tab_r[<span class="st">'Regiao'</span>], tab_r[<span class="st">'Exp. Media'</span>], xerr<span class="op">=</span>yerr_r, color<span class="op">=</span><span class="st">'steelblue'</span>,</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">'white'</span>, capsize<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (_, row) <span class="kw">in</span> <span class="bu">enumerate</span>(tab_r.iterrows()):</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>    ax.text(row[<span class="st">'Exp. Media'</span>] <span class="op">+</span> <span class="fl">0.003</span>, i, <span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'Pop. (milhoes)'</span>]<span class="sc">:.1f}</span><span class="ss">M"</span>,</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>            va<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Exposicao Media (com IC 95%)'</span>)</span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="ss">f'Exposicao por Regiao (ANOVA: F=</span><span class="sc">{</span>model_anova_reg<span class="sc">.</span>fvalue<span class="sc">:.0f}</span><span class="ss">, p=</span><span class="sc">{</span>model_anova_reg<span class="sc">.</span>f_pvalue<span class="sc">:.2e}</span><span class="ss">)'</span>)</span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 7.2 - Ranking estadual (UF)</span></span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RANKING ESTADUAL DE EXPOSICAO"</span>)</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>rows_uf <span class="op">=</span> []</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uf <span class="kw">in</span> <span class="bu">sorted</span>(df_score[<span class="st">'sigla_uf'</span>].unique()):</span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'sigla_uf'</span>] <span class="op">==</span> uf]</span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>    mean_e, ci_lo, ci_hi <span class="op">=</span> weighted_ci(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>    rows_uf.append({</span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>        <span class="st">'UF'</span>: uf,</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Regiao'</span>: REGIAO_MAP.get(uf, <span class="st">''</span>),</span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Exp. Media'</span>: mean_e, <span class="st">'IC Inf'</span>: ci_lo, <span class="st">'IC Sup'</span>: ci_hi,</span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Pop. (milhoes)'</span>: sub[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>tab_uf <span class="op">=</span> pd.DataFrame(rows_uf).sort_values(<span class="st">'Exp. Media'</span>, ascending<span class="op">=</span><span class="va">False</span>).set_index(<span class="st">'UF'</span>)</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>display(tab_uf.<span class="bu">round</span>(<span class="dv">3</span>))</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 5 UFs (maior exposicao):"</span>)</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uf <span class="kw">in</span> tab_uf.head(<span class="dv">5</span>).index:</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> tab_uf.loc[uf]</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>uf<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>row[<span class="st">'Regiao'</span>]<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>row[<span class="st">'Exp. Media'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Bottom 5 UFs (menor exposicao):"</span>)</span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uf <span class="kw">in</span> tab_uf.tail(<span class="dv">5</span>).index:</span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>    row <span class="op">=</span> tab_uf.loc[uf]</span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>uf<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>row[<span class="st">'Regiao'</span>]<span class="sc">}</span><span class="ss">): </span><span class="sc">{</span>row[<span class="st">'Exp. Media'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Nota: Mapas coropletas detalhados foram gerados pelo script 09"</span>)</span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(etapa1_ia_generativa/outputs/figures/mapa_c*.png)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
EXPOSICAO POR REGIAO
======================================================================
  Norte: 0.258 [IC: 0.258-0.258] | Alta: 8.4% | Pop: 7.7M
  Nordeste: 0.261 [IC: 0.261-0.261] | Alta: 8.0% | Pop: 22.2M
  Centro-Oeste: 0.282 [IC: 0.282-0.282] | Alta: 10.7% | Pop: 8.4M
  Sudeste: 0.289 [IC: 0.289-0.289] | Alta: 11.2% | Pop: 43.1M
  Sul: 0.282 [IC: 0.282-0.282] | Alta: 10.5% | Pop: 15.7M</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">% Alta Exp.</th>
<th data-quarto-table-cell-role="th">% Nao Exposto</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Regiao</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">Norte</th>
<td>0.258</td>
<td>0.258</td>
<td>0.258</td>
<td>8.376</td>
<td>59.352</td>
<td>7.722</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Nordeste</th>
<td>0.261</td>
<td>0.261</td>
<td>0.261</td>
<td>8.020</td>
<td>58.641</td>
<td>22.152</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Centro-Oeste</th>
<td>0.282</td>
<td>0.282</td>
<td>0.282</td>
<td>10.712</td>
<td>53.201</td>
<td>8.353</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Sudeste</th>
<td>0.289</td>
<td>0.289</td>
<td>0.289</td>
<td>11.171</td>
<td>50.751</td>
<td>43.088</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Sul</th>
<td>0.282</td>
<td>0.282</td>
<td>0.282</td>
<td>10.502</td>
<td>53.312</td>
<td>15.652</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
ANOVA ponderada (regioes): F=373.9, p=1.89e-321 ***
R²: 0.0072 (pouca variacao explicada apenas por regiao)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-12-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
RANKING ESTADUAL DE EXPOSICAO
======================================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Regiao</th>
<th data-quarto-table-cell-role="th">Exp. Media</th>
<th data-quarto-table-cell-role="th">IC Inf</th>
<th data-quarto-table-cell-role="th">IC Sup</th>
<th data-quarto-table-cell-role="th">Pop. (milhoes)</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">UF</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">DF</th>
<td>Centro-Oeste</td>
<td>0.326</td>
<td>0.326</td>
<td>0.326</td>
<td>1.434</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">RJ</th>
<td>Sudeste</td>
<td>0.301</td>
<td>0.300</td>
<td>0.301</td>
<td>7.663</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">SP</th>
<td>Sudeste</td>
<td>0.297</td>
<td>0.297</td>
<td>0.297</td>
<td>23.175</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">SC</th>
<td>Sul</td>
<td>0.283</td>
<td>0.283</td>
<td>0.283</td>
<td>4.278</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RR</th>
<td>Norte</td>
<td>0.282</td>
<td>0.282</td>
<td>0.283</td>
<td>0.270</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">PR</th>
<td>Sul</td>
<td>0.282</td>
<td>0.282</td>
<td>0.282</td>
<td>5.925</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RS</th>
<td>Sul</td>
<td>0.281</td>
<td>0.281</td>
<td>0.281</td>
<td>5.449</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">GO</th>
<td>Centro-Oeste</td>
<td>0.275</td>
<td>0.275</td>
<td>0.276</td>
<td>3.659</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">AP</th>
<td>Norte</td>
<td>0.275</td>
<td>0.274</td>
<td>0.275</td>
<td>0.325</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">RN</th>
<td>Nordeste</td>
<td>0.271</td>
<td>0.271</td>
<td>0.271</td>
<td>1.344</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">MT</th>
<td>Centro-Oeste</td>
<td>0.270</td>
<td>0.269</td>
<td>0.270</td>
<td>1.898</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">ES</th>
<td>Sudeste</td>
<td>0.269</td>
<td>0.269</td>
<td>0.269</td>
<td>1.935</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">AC</th>
<td>Norte</td>
<td>0.269</td>
<td>0.268</td>
<td>0.269</td>
<td>0.315</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">SE</th>
<td>Nordeste</td>
<td>0.268</td>
<td>0.268</td>
<td>0.269</td>
<td>0.874</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">MS</th>
<td>Centro-Oeste</td>
<td>0.268</td>
<td>0.268</td>
<td>0.269</td>
<td>1.362</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">TO</th>
<td>Norte</td>
<td>0.268</td>
<td>0.268</td>
<td>0.268</td>
<td>0.755</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">AM</th>
<td>Norte</td>
<td>0.268</td>
<td>0.268</td>
<td>0.268</td>
<td>1.761</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">PE</th>
<td>Nordeste</td>
<td>0.267</td>
<td>0.267</td>
<td>0.267</td>
<td>3.565</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">CE</th>
<td>Nordeste</td>
<td>0.267</td>
<td>0.267</td>
<td>0.267</td>
<td>3.555</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">MG</th>
<td>Sudeste</td>
<td>0.267</td>
<td>0.267</td>
<td>0.267</td>
<td>10.315</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">PB</th>
<td>Nordeste</td>
<td>0.262</td>
<td>0.262</td>
<td>0.262</td>
<td>1.614</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">AL</th>
<td>Nordeste</td>
<td>0.258</td>
<td>0.258</td>
<td>0.258</td>
<td>1.169</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">RO</th>
<td>Norte</td>
<td>0.256</td>
<td>0.256</td>
<td>0.257</td>
<td>0.733</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">MA</th>
<td>Nordeste</td>
<td>0.255</td>
<td>0.255</td>
<td>0.256</td>
<td>2.586</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">BA</th>
<td>Nordeste</td>
<td>0.254</td>
<td>0.254</td>
<td>0.254</td>
<td>6.141</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">PI</th>
<td>Nordeste</td>
<td>0.253</td>
<td>0.253</td>
<td>0.254</td>
<td>1.306</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">PA</th>
<td>Norte</td>
<td>0.248</td>
<td>0.248</td>
<td>0.248</td>
<td>3.562</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Top 5 UFs (maior exposicao):
  DF (Centro-Oeste): 0.326
  RJ (Sudeste): 0.301
  SP (Sudeste): 0.297
  SC (Sul): 0.283
  RR (Norte): 0.282

Bottom 5 UFs (menor exposicao):
  RO (Norte): 0.256
  MA (Nordeste): 0.255
  BA (Nordeste): 0.254
  PI (Nordeste): 0.253
  PA (Norte): 0.248

Nota: Mapas coropletas detalhados foram gerados pelo script 09
(etapa1_ia_generativa/outputs/figures/mapa_c*.png)</code></pre>
</div>
</div>
</section>
<section id="regiao-7" class="level3" data-number="1.20">
<h3 data-number="1.20" class="anchored" data-anchor-id="regiao-7"><span class="header-section-number">1.20</span> 7. Regiao</h3>
<p>Exposicao media por regiao; populacao em alta exposicao por UF/regiao.</p>
<p><strong>Analises:</strong> - Exposicao por regiao/UF com ICs e ANOVA ponderada - Referencia aos mapas coropletas (script 09) - Ranking estadual</p>
</section>
<section id="c.-decomposicao-shift-share-regional" class="level3" data-number="1.21">
<h3 data-number="1.21" class="anchored" data-anchor-id="c.-decomposicao-shift-share-regional"><span class="header-section-number">1.21</span> 7c. Decomposicao Shift-Share Regional</h3>
<p>Decomposicao da diferenca de exposicao entre regioes em efeito composicao (diferenca na estrutura setorial) e residual (diferenca dentro dos setores).</p>
<div id="1c0fdc67" class="cell" data-execution_count="75">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.7c - Decomposicao Shift-Share Regional</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 7c - Decomposicao Shift-Share: Regioes</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DECOMPOSICAO SHIFT-SHARE REGIONAL"</span>)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> shift_share(df, regiao_a, regiao_b, var_grupo<span class="op">=</span><span class="st">'setor_agregado'</span>):</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Decompoe diferenca de exposicao entre duas regioes."""</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>    da <span class="op">=</span> df[df[<span class="st">'regiao'</span>] <span class="op">==</span> regiao_a]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> df[df[<span class="st">'regiao'</span>] <span class="op">==</span> regiao_b]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    total_a, total_b <span class="op">=</span> da[<span class="st">'peso'</span>].<span class="bu">sum</span>(), db[<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>    grupos <span class="op">=</span> <span class="bu">set</span>(da[var_grupo].unique()) <span class="op">|</span> <span class="bu">set</span>(db[var_grupo].unique())</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    composicao <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> g <span class="kw">in</span> grupos:</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>        sa <span class="op">=</span> da[da[var_grupo]<span class="op">==</span>g]</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>        sb <span class="op">=</span> db[db[var_grupo]<span class="op">==</span>g]</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>        share_a <span class="op">=</span> sa[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> total_a <span class="cf">if</span> total_a <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>        share_b <span class="op">=</span> sb[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> total_b <span class="cf">if</span> total_b <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>        exp_g <span class="op">=</span> weighted_mean(df[df[var_grupo]<span class="op">==</span>g][<span class="st">'exposure_score'</span>],</span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>                              df[df[var_grupo]<span class="op">==</span>g][<span class="st">'peso'</span>])</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>        composicao <span class="op">+=</span> (share_a <span class="op">-</span> share_b) <span class="op">*</span> exp_g</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    exp_a <span class="op">=</span> weighted_mean(da[<span class="st">'exposure_score'</span>], da[<span class="st">'peso'</span>])</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    exp_b <span class="op">=</span> weighted_mean(db[<span class="st">'exposure_score'</span>], db[<span class="st">'peso'</span>])</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    total_diff <span class="op">=</span> exp_a <span class="op">-</span> exp_b</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    residual <span class="op">=</span> total_diff <span class="op">-</span> composicao</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total_diff, composicao, residual</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> par <span class="kw">in</span> [(<span class="st">'Sudeste'</span>, <span class="st">'Nordeste'</span>), (<span class="st">'Sudeste'</span>, <span class="st">'Norte'</span>), (<span class="st">'Sul'</span>, <span class="st">'Nordeste'</span>)]:</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    diff, comp, resid <span class="op">=</span> shift_share(df_score, par[<span class="dv">0</span>], par[<span class="dv">1</span>])</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span>par[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> vs </span><span class="sc">{</span>par[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Diferenca total: </span><span class="sc">{</span>diff<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> diff <span class="op">!=</span> <span class="dv">0</span>:</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Efeito composicao (setor): </span><span class="sc">{</span>comp<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>comp<span class="op">/</span>diff<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Residual: </span><span class="sc">{</span>resid<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>resid<span class="op">/</span>diff<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Efeito composicao (setor): </span><span class="sc">{</span>comp<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"  Residual: </span><span class="sc">{</span>resid<span class="sc">:+.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
DECOMPOSICAO SHIFT-SHARE REGIONAL
======================================================================

Sudeste vs Nordeste:
  Diferenca total: +0.0283
  Efeito composicao (setor): +0.0111 (39.4%)
  Residual: +0.0171 (60.6%)

Sudeste vs Norte:
  Diferenca total: +0.0306
  Efeito composicao (setor): +0.0121 (39.5%)
  Residual: +0.0185 (60.5%)

Sul vs Nordeste:
  Diferenca total: +0.0214
  Efeito composicao (setor): +0.0031 (14.4%)
  Residual: +0.0183 (85.6%)</code></pre>
</div>
</div>
</section>
<section id="b.-região-mapas" class="level3" data-number="1.22">
<h3 data-number="1.22" class="anchored" data-anchor-id="b.-região-mapas"><span class="header-section-number">1.22</span> 7b. Região (Mapas)</h3>
<p>Mapas coropléticos do Brasil por estado (UF) com base nos dados da PNADc e no índice de exposição à IA generativa (ILO WP140).</p>
<p><strong>Mapas:</strong> 1. <strong>Exposição média por estado</strong> — score médio de exposição à IA por UF. 2. <strong>População não exposta</strong> — gradiente “Not Exposed” e volume estimado (milhões) por estado. 3. <strong>População em maior exposição</strong> — gradiente 4 (Exposed: Gradient 4) e volume estimado (milhões) por estado.</p>
<p>Fonte: PNAD Contínua 3º trimestre/2025 + ILO GenAI Scores (Gmyrek et al., 2025).</p>
<div id="2f32118f" class="cell" data-execution_count="76">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.7b - Analise de Dados - Regiao (Mapas)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Instalar dependencias para mapas (executar apenas uma vez)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>pip install geobr geopandas <span class="op">--</span>quiet</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geobr</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> Normalize</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.patheffects <span class="im">as</span> pe</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 7b.1 - Dados geograficos e agregacao por estado</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Carregar malha de estados (Brasil)</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>states_gdf <span class="op">=</span> geobr.read_state(year<span class="op">=</span><span class="dv">2020</span>)</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>states_gdf[<span class="st">'abbrev_state'</span>] <span class="op">=</span> states_gdf[<span class="st">'abbrev_state'</span>].<span class="bu">str</span>.upper()</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Agregar por sigla_uf (usar df_score ja carregado no notebook)</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>rows_estado <span class="op">=</span> []</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> uf <span class="kw">in</span> df_score[<span class="st">'sigla_uf'</span>].unique():</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df_score[df_score[<span class="st">'sigla_uf'</span>] <span class="op">==</span> uf]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> sub[<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>    exp_media <span class="op">=</span> weighted_mean(sub[<span class="st">'exposure_score'</span>], sub[<span class="st">'peso'</span>])</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>    peso_not <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> <span class="st">'Not Exposed'</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>    peso_g4 <span class="op">=</span> sub[sub[<span class="st">'exposure_gradient'</span>] <span class="op">==</span> <span class="st">'Exposed: Gradient 4'</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>()</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>    rows_estado.append({</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sigla_uf'</span>: uf,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'exposicao_media'</span>: exp_media,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pct_not_exposed'</span>: (peso_not <span class="op">/</span> total <span class="op">*</span> <span class="dv">100</span>) <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'vol_not_exposed_mil'</span>: peso_not <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pct_grad4'</span>: (peso_g4 <span class="op">/</span> total <span class="op">*</span> <span class="dv">100</span>) <span class="cf">if</span> total <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'vol_grad4_mil'</span>: peso_g4 <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>agg_estado <span class="op">=</span> pd.DataFrame(rows_estado)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> states_gdf.merge(agg_estado, left_on<span class="op">=</span><span class="st">'abbrev_state'</span>, right_on<span class="op">=</span><span class="st">'sigla_uf'</span>)</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Funcao auxiliar para desenhar um mapa (exibicao no notebook)</span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_map(gdf, metric, title, cmap, label_col, fmt<span class="op">=</span><span class="st">'.1f'</span>, pct<span class="op">=</span><span class="va">True</span>, extra_label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">12</span>))</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>    vmin, vmax <span class="op">=</span> gdf[metric].<span class="bu">min</span>(), gdf[metric].<span class="bu">max</span>()</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>    gdf.plot(column<span class="op">=</span>metric, cmap<span class="op">=</span>cmap, linewidth<span class="op">=</span><span class="fl">0.8</span>, ax<span class="op">=</span>ax,</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>             edgecolor<span class="op">=</span><span class="st">'0.3'</span>, legend<span class="op">=</span><span class="va">False</span>, vmin<span class="op">=</span>vmin, vmax<span class="op">=</span>vmax)</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>    sm <span class="op">=</span> plt.cm.ScalarMappable(cmap<span class="op">=</span>cmap, norm<span class="op">=</span>Normalize(vmin<span class="op">=</span>vmin, vmax<span class="op">=</span>vmax))</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>    sm.set_array([])</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> fig.colorbar(sm, ax<span class="op">=</span>ax, shrink<span class="op">=</span><span class="fl">0.6</span>, aspect<span class="op">=</span><span class="dv">20</span>, pad<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>    cbar.set_label(<span class="st">'</span><span class="sc">% F</span><span class="st">orça de Trabalho'</span> <span class="cf">if</span> pct <span class="cf">else</span> <span class="st">'Score'</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> gdf.iterrows():</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>        c <span class="op">=</span> row.geometry.centroid</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>        v <span class="op">=</span> row[metric]</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>        vs <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>v<span class="sc">:</span>{fmt}<span class="sc">}</span><span class="ss">%"</span> <span class="cf">if</span> pct <span class="cf">else</span> <span class="ss">f"</span><span class="sc">{</span>v<span class="sc">:</span>{fmt}<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>        txt <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>row[label_col]<span class="sc">}</span><span class="ch">\n</span><span class="sc">{</span>vs<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> extra_label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> extra_label <span class="kw">in</span> row:</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>            txt <span class="op">+=</span> <span class="ss">f"</span><span class="ch">\n</span><span class="ss">(</span><span class="sc">{</span>row[extra_label]<span class="sc">:.1f}</span><span class="ss">M)"</span></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>        nv <span class="op">=</span> (v <span class="op">-</span> vmin) <span class="op">/</span> (vmax <span class="op">-</span> vmin) <span class="cf">if</span> vmax <span class="op">&gt;</span> vmin <span class="cf">else</span> <span class="fl">0.5</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>        tc <span class="op">=</span> <span class="st">'white'</span> <span class="cf">if</span> nv <span class="op">&gt;</span> <span class="fl">0.6</span> <span class="cf">else</span> <span class="st">'black'</span></span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>        ax.annotate(txt, xy<span class="op">=</span>(c.x, c.y), ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>                    fontsize<span class="op">=</span><span class="dv">9</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, color<span class="op">=</span>tc,</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>                    path_effects<span class="op">=</span>[pe.withStroke(linewidth<span class="op">=</span><span class="dv">2</span>, foreground<span class="op">=</span><span class="st">'white'</span> <span class="cf">if</span> tc <span class="op">==</span> <span class="st">'black'</span> <span class="cf">else</span> <span class="st">'black'</span>)])</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>    ax.set_title(title, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, pad<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>    fig.text(<span class="fl">0.5</span>, <span class="fl">0.02</span>, <span class="st">'Fonte: PNAD 3T/2025 + ILO GenAI Scores'</span>, ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, style<span class="op">=</span><span class="st">'italic'</span>)</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 7b.2 - Mapa 1: Exposicao media por estado</span></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>_plot_map(gdf, <span class="st">'exposicao_media'</span>,</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Exposição Média à IA por Estado – Brasil 3T/2025'</span>,</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>          <span class="st">'YlOrRd'</span>, <span class="st">'abbrev_state'</span>, <span class="st">'.3f'</span>, pct<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a><span class="co"># 7b.3 - Mapa 2: Gradiente "Nao exposto" e volume por estado</span></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a>_plot_map(gdf, <span class="st">'pct_not_exposed'</span>,</span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a>          <span class="st">'População Não Exposta à IA por Estado (%) e Volume (milhões) – Brasil 3T/2025'</span>,</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Greens'</span>, <span class="st">'abbrev_state'</span>, <span class="st">'.1f'</span>, pct<span class="op">=</span><span class="va">True</span>, extra_label<span class="op">=</span><span class="st">'vol_not_exposed_mil'</span>)</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a><span class="co"># 7b.4 - Mapa 3: Gradiente 4 (maior exposicao) e volume por estado</span></span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>_plot_map(gdf, <span class="st">'pct_grad4'</span>,</span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a>          <span class="st">'População em Maior Exposição (Gradiente 4) por Estado (%) e Volume (milhões) – Brasil 3T/2025'</span>,</span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>          <span class="st">'Reds'</span>, <span class="st">'abbrev_state'</span>, <span class="st">'.1f'</span>, pct<span class="op">=</span><span class="va">True</span>, extra_label<span class="op">=</span><span class="st">'vol_grad4_mil'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<div class="ansi-escaped-output">
<pre><span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> A new release of pip is available: <span class="ansi-red-fg">24.2</span> -&gt; <span class="ansi-green-fg">26.0.1</span>

<span class="ansi-bold">[</span><span class="ansi-blue-fg">notice</span><span class="ansi-bold">]</span> To update, run: <span class="ansi-green-fg">python3.10 -m pip install --upgrade pip</span>

Note: you may need to restart the kernel to use updated packages.
</pre>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-14-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-14-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-14-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="d.-indice-de-vulnerabilidade-composta" class="level3" data-number="1.23">
<h3 data-number="1.23" class="anchored" data-anchor-id="d.-indice-de-vulnerabilidade-composta"><span class="header-section-number">1.23</span> 7d. Indice de Vulnerabilidade Composta</h3>
<p>Trabalhadores em situacao de vulnerabilidade composta: alta exposicao + baixa escolaridade + informalidade + baixa renda.</p>
<blockquote class="blockquote">
<p>Este indicador sintetico identifica o grupo mais vulneravel aos impactos da IA generativa, combinando multiplas dimensoes de desvantagem.</p>
</blockquote>
<div id="0fe96b61" class="cell" data-execution_count="77">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.7d - Indice de Vulnerabilidade Composta</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 7d - Indice de Vulnerabilidade Composta</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"INDICE DE VULNERABILIDADE COMPOSTA A IA"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>mediana_renda_vuln <span class="op">=</span> weighted_quantile(df_renda[<span class="st">'rendimento_habitual'</span>], df_renda[<span class="st">'peso'</span>], <span class="fl">0.5</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>df_score[<span class="st">'vulneravel'</span>] <span class="op">=</span> (</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    df_score[<span class="st">'exposure_gradient'</span>].isin(HIGH_EXPOSURE_GRADIENTS) <span class="op">&amp;</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    df_score[<span class="st">'edu_simples'</span>].isin([<span class="st">'Sem/Fund.Inc.'</span>, <span class="st">'Fund.Comp.'</span>]) <span class="op">&amp;</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    (df_score[<span class="st">'formal'</span>] <span class="op">==</span> <span class="dv">0</span>)</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>).astype(<span class="bu">int</span>)</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Se renda disponivel, adicionar criterio</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>mask_renda <span class="op">=</span> df_score[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>df_score.loc[mask_renda, <span class="st">'vulneravel'</span>] <span class="op">=</span> (</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>    df_score.loc[mask_renda, <span class="st">'vulneravel'</span>] <span class="op">&amp;</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>    (df_score.loc[mask_renda, <span class="st">'rendimento_habitual'</span>] <span class="op">&lt;</span> mediana_renda_vuln)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>).astype(<span class="bu">int</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>pop_vuln <span class="op">=</span> df_score[df_score[<span class="st">'vulneravel'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>pct_vuln <span class="op">=</span> pop_vuln <span class="op">/</span> (df_score[<span class="st">'peso'</span>].<span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Trabalhadores em vulnerabilidade composta: </span><span class="sc">{</span>pop_vuln<span class="sc">:.2f}</span><span class="ss">M (</span><span class="sc">{</span>pct_vuln<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(Alta exposicao + Baixa escolaridade + Informalidade + Baixa renda)"</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela por UF</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>vuln_uf <span class="op">=</span> df_score.groupby(<span class="st">'sigla_uf'</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> g: pd.Series({</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'pct_vulneravel'</span>: g[g[<span class="st">'vulneravel'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> g[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span> <span class="cf">if</span> g[<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">0</span>,</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'vol_vulneravel'</span>: g[g[<span class="st">'vulneravel'</span>]<span class="op">==</span><span class="dv">1</span>][<span class="st">'peso'</span>].<span class="bu">sum</span>() <span class="op">/</span> <span class="fl">1e6</span>,</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>})).reset_index()</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>vuln_uf <span class="op">=</span> vuln_uf.sort_values(<span class="st">'pct_vulneravel'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Top 10 UFs por </span><span class="sc">% d</span><span class="st">e vulnerabilidade composta:"</span>)</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _, row <span class="kw">in</span> vuln_uf.head(<span class="dv">10</span>).iterrows():</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>row[<span class="st">'sigla_uf'</span>]<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>row[<span class="st">'pct_vulneravel'</span>]<span class="sc">:.1f}</span><span class="ss">% (</span><span class="sc">{</span>row[<span class="st">'vol_vulneravel'</span>]<span class="sc">:.2f}</span><span class="ss">M)"</span>)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa (se gdf disponivel da secao 7b)</span></span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>    gdf_vuln <span class="op">=</span> gdf.merge(vuln_uf, left_on<span class="op">=</span><span class="st">'abbrev_state'</span>, right_on<span class="op">=</span><span class="st">'sigla_uf'</span>)</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>    _plot_map(gdf_vuln, <span class="st">'pct_vulneravel'</span>,</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Vulnerabilidade Composta a IA por Estado</span><span class="ch">\n</span><span class="st">(Alta exposicao + Baixa escolaridade + Informal + Baixa renda)'</span>,</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Reds'</span>, <span class="st">'abbrev_state'</span>, fmt<span class="op">=</span><span class="st">'.1f'</span>, pct<span class="op">=</span><span class="va">True</span>, extra_label<span class="op">=</span><span class="st">'vol_vulneravel'</span>)</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">NameError</span>:</span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  (Mapa nao disponivel - executar secao 7b primeiro)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
INDICE DE VULNERABILIDADE COMPOSTA A IA
======================================================================

Trabalhadores em vulnerabilidade composta: 0.06M (0.1%)
(Alta exposicao + Baixa escolaridade + Informalidade + Baixa renda)

Top 10 UFs por % de vulnerabilidade composta:
  PB: 0.2% (0.00M)
  BA: 0.2% (0.01M)
  PI: 0.2% (0.00M)
  AM: 0.1% (0.00M)
  CE: 0.1% (0.00M)
  PE: 0.1% (0.00M)
  SE: 0.1% (0.00M)
  MS: 0.1% (0.00M)
  RO: 0.1% (0.00M)
  MA: 0.1% (0.00M)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="etapa_1b_analise_dados_ilo_pnadc_files/figure-html/cell-15-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analise-multivariada" class="level3" data-number="1.24">
<h3 data-number="1.24" class="anchored" data-anchor-id="analise-multivariada"><span class="header-section-number">1.24</span> 8. Analise multivariada</h3>
<p>Regressoes WLS, equacao de Mincer aumentada e testes de robustez.</p>
<p><strong>Analises:</strong> - WLS: Determinantes da exposicao (3 especificacoes com controles progressivos) - WLS Mincer: log(renda) ~ exposicao + controles (com interacoes) - Robustez: sensibilidade ao crosswalk (excluir matches 3-digit)</p>
<blockquote class="blockquote">
<p><strong>Nota metodologica:</strong> Todas as regressoes usam WLS (Weighted Least Squares) com pesos amostrais V1028 e erros-padrao robustos a heterocedasticidade (HC1). Ref: Wooldridge (2020), Cap. 8.</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Extensão do WP140:</strong> O WP140 trabalha exclusivamente com dados agregados por ocupação e não realiza análise no nível individual. A equação de Mincer aumentada com o score de exposição como regressor é uma extensão metodológica que permite: (1) controlar por características individuais (sexo, raça, idade, escolaridade); (2) estimar o “prêmio” de exposição na renda condicionando na composição da força de trabalho; (3) testar interações (exposição×formalidade, exposição×gênero). Essa abordagem segue a sugestão implícita do WP140 de que pesquisas futuras devem “explore the relationship between exposure and labour market outcomes at the individual level” (p.&nbsp;39).</p>
</blockquote>
<div id="18ca23a7" class="cell" data-execution_count="78">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.8 - Analise de Dados - Analise multivariada</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.1 - WLS: Determinantes da exposicao (3 especificacoes)</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"REGRESSAO WLS: DETERMINANTES DA EXPOSICAO A IA"</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>df_reg <span class="op">=</span> df_score[[<span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>, <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'nivel_instrucao'</span>, <span class="st">'grande_grupo'</span>, <span class="st">'regiao'</span>, <span class="st">'formal'</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'setor_agregado'</span>, <span class="st">'peso'</span>]].dropna().copy()</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Amostra para regressao: </span><span class="sc">{</span><span class="bu">len</span>(df_reg)<span class="sc">:,}</span><span class="ss"> observacoes"</span>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo 1: apenas demografia</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>m1 <span class="op">=</span> smf.wls(</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(sexo_texto, Treatment("Homem")) + C(raca_agregada, Treatment("Negra")) + '</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao)'</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_reg, weights<span class="op">=</span>df_reg[<span class="st">'peso'</span>]</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo 2: + ocupacao e regiao</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>m2 <span class="op">=</span> smf.wls(</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(sexo_texto, Treatment("Homem")) + C(raca_agregada, Treatment("Negra")) + '</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + C(grande_grupo) + C(regiao)'</span>,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_reg, weights<span class="op">=</span>df_reg[<span class="st">'peso'</span>]</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Modelo 3: + setor e formalidade</span></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>m3 <span class="op">=</span> smf.wls(</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score ~ C(sexo_texto, Treatment("Homem")) + C(raca_agregada, Treatment("Negra")) + '</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + C(grande_grupo) + C(regiao) + '</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C(setor_agregado) + formal'</span>,</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_reg, weights<span class="op">=</span>df_reg[<span class="st">'peso'</span>]</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Tabela comparativa dos 3 modelos</span></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_key_params(model, label):</span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Extrai coeficientes-chave de um modelo."""</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {}</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> model.params.index:</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>        coef <span class="op">=</span> model.params[var]</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>        se <span class="op">=</span> model.bse[var]</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>        pval <span class="op">=</span> model.pvalues[var]</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>        params[var] <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>coef<span class="sc">:+.4f}</span><span class="ss"> (</span><span class="sc">{</span>se<span class="sc">:.4f}</span><span class="ss">)</span><span class="sc">{</span>sig_stars(pval)<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> params</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Variaveis-chave para reportar</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>key_vars <span class="op">=</span> [</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'C(sexo_texto, Treatment("Homem"))[T.Mulher]'</span>, <span class="st">'Mulher (ref: Homem)'</span>),</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'C(raca_agregada, Treatment("Negra"))[T.Branca]'</span>, <span class="st">'Branca (ref: Negra)'</span>),</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'idade'</span>, <span class="st">'Idade'</span>),</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'formal'</span>, <span class="st">'Formal'</span>),</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="sc">{:&lt;30}</span><span class="st"> </span><span class="sc">{:&lt;25}</span><span class="st"> </span><span class="sc">{:&lt;25}</span><span class="st"> </span><span class="sc">{:&lt;25}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">'Variavel'</span>, <span class="st">'M1 (Demog.)'</span>, <span class="st">'M2 (+Ocup.)'</span>, <span class="st">'M3 (Completo)'</span>))</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">105</span>)</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var_name, var_label <span class="kw">in</span> key_vars:</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> []</span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> [m1, m2, m3]:</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var_name <span class="kw">in</span> m.params.index:</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> m.params[var_name]</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>            pval <span class="op">=</span> m.pvalues[var_name]</span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>            vals.append(<span class="ss">f"</span><span class="sc">{</span>coef<span class="sc">:+.4f}{</span>sig_stars(pval)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>            vals.append(<span class="st">"--"</span>)</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>var_label<span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">0</span>]<span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">1</span>]<span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">2</span>]<span class="sc">:&lt;25}</span><span class="ss">"</span>)</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">105</span>)</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'R²'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>m1<span class="sc">.</span>rsquared<span class="sc">:.4f}{</span><span class="st">''</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>m2<span class="sc">.</span>rsquared<span class="sc">:.4f}{</span><span class="st">''</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>m3<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'N'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(m1.nobs)<span class="sc">:,}{</span><span class="st">''</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(m2.nobs)<span class="sc">:,}{</span><span class="st">''</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(m3.nobs)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Significancia: * p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001"</span>)</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Modelo completo (M3) - Resumo ---"</span>)</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(m3.summary().tables[<span class="dv">1</span>])</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.2 - Equacao de Mincer com exposicao</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EQUACAO DE MINCER AUMENTADA: log(renda) ~ exposicao + controles"</span>)</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>df_mincer <span class="op">=</span> df_renda[[<span class="st">'rendimento_habitual'</span>, <span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>,</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>, <span class="st">'nivel_instrucao'</span>, <span class="st">'formal'</span>,</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'regiao'</span>, <span class="st">'setor_agregado'</span>, <span class="st">'peso'</span>]].dropna().copy()</span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>df_mincer[<span class="st">'log_renda'</span>] <span class="op">=</span> np.log(df_mincer[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Amostra Mincer: </span><span class="sc">{</span><span class="bu">len</span>(df_mincer)<span class="sc">:,}</span><span class="ss"> observacoes"</span>)</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Mincer 1: exposicao + capital humano basico</span></span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a>mincer1 <span class="op">=</span> smf.wls(</span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal'</span>,</span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_mincer, weights<span class="op">=</span>df_mincer[<span class="st">'peso'</span>]</span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Mincer 2: + controles regionais e setoriais</span></span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a>mincer2 <span class="op">=</span> smf.wls(</span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal + C(regiao) + C(setor_agregado)'</span>,</span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_mincer, weights<span class="op">=</span>df_mincer[<span class="st">'peso'</span>]</span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-106"><a href="#cb52-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-107"><a href="#cb52-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Mincer 3: + exposicao quadratica + interacoes</span></span>
<span id="cb52-108"><a href="#cb52-108" aria-hidden="true" tabindex="-1"></a>mincer3 <span class="op">=</span> smf.wls(</span>
<span id="cb52-109"><a href="#cb52-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_renda ~ exposure_score + I(exposure_score**2) + '</span></span>
<span id="cb52-110"><a href="#cb52-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">'exposure_score:C(sexo_texto) + exposure_score:formal + '</span></span>
<span id="cb52-111"><a href="#cb52-111" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-112"><a href="#cb52-112" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal + C(regiao) + C(setor_agregado)'</span>,</span>
<span id="cb52-113"><a href="#cb52-113" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_mincer, weights<span class="op">=</span>df_mincer[<span class="st">'peso'</span>]</span>
<span id="cb52-114"><a href="#cb52-114" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-115"><a href="#cb52-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-116"><a href="#cb52-116" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="sc">{:&lt;40}</span><span class="st"> </span><span class="sc">{:&lt;20}</span><span class="st"> </span><span class="sc">{:&lt;20}</span><span class="st"> </span><span class="sc">{:&lt;20}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">'Variavel'</span>, <span class="st">'Mincer 1'</span>, <span class="st">'Mincer 2'</span>, <span class="st">'Mincer 3'</span>))</span>
<span id="cb52-117"><a href="#cb52-117" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb52-118"><a href="#cb52-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-119"><a href="#cb52-119" aria-hidden="true" tabindex="-1"></a>mincer_vars <span class="op">=</span> [</span>
<span id="cb52-120"><a href="#cb52-120" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'exposure_score'</span>, <span class="st">'Exposicao'</span>),</span>
<span id="cb52-121"><a href="#cb52-121" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'I(exposure_score ** 2)'</span>, <span class="st">'Exposicao²'</span>),</span>
<span id="cb52-122"><a href="#cb52-122" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'exposure_score:C(sexo_texto)[T.Mulher]'</span>, <span class="st">'Exposicao x Mulher'</span>),</span>
<span id="cb52-123"><a href="#cb52-123" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'exposure_score:formal'</span>, <span class="st">'Exposicao x Formal'</span>),</span>
<span id="cb52-124"><a href="#cb52-124" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'C(sexo_texto)[T.Mulher]'</span>, <span class="st">'Mulher'</span>),</span>
<span id="cb52-125"><a href="#cb52-125" aria-hidden="true" tabindex="-1"></a>    (<span class="st">'formal'</span>, <span class="st">'Formal'</span>),</span>
<span id="cb52-126"><a href="#cb52-126" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-127"><a href="#cb52-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-128"><a href="#cb52-128" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var_name, var_label <span class="kw">in</span> mincer_vars:</span>
<span id="cb52-129"><a href="#cb52-129" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> []</span>
<span id="cb52-130"><a href="#cb52-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> m <span class="kw">in</span> [mincer1, mincer2, mincer3]:</span>
<span id="cb52-131"><a href="#cb52-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> var_name <span class="kw">in</span> m.params.index:</span>
<span id="cb52-132"><a href="#cb52-132" aria-hidden="true" tabindex="-1"></a>            coef <span class="op">=</span> m.params[var_name]</span>
<span id="cb52-133"><a href="#cb52-133" aria-hidden="true" tabindex="-1"></a>            pval <span class="op">=</span> m.pvalues[var_name]</span>
<span id="cb52-134"><a href="#cb52-134" aria-hidden="true" tabindex="-1"></a>            vals.append(<span class="ss">f"</span><span class="sc">{</span>coef<span class="sc">:+.4f}{</span>sig_stars(pval)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-135"><a href="#cb52-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb52-136"><a href="#cb52-136" aria-hidden="true" tabindex="-1"></a>            vals.append(<span class="st">"--"</span>)</span>
<span id="cb52-137"><a href="#cb52-137" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>var_label<span class="sc">:&lt;40}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">0</span>]<span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">1</span>]<span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span>vals[<span class="dv">2</span>]<span class="sc">:&lt;20}</span><span class="ss">"</span>)</span>
<span id="cb52-138"><a href="#cb52-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-139"><a href="#cb52-139" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">100</span>)</span>
<span id="cb52-140"><a href="#cb52-140" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'R²'</span><span class="sc">:&lt;40}</span><span class="ss"> </span><span class="sc">{</span>mincer1<span class="sc">.</span>rsquared<span class="sc">:.4f}{</span><span class="st">''</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>mincer2<span class="sc">.</span>rsquared<span class="sc">:.4f}{</span><span class="st">''</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>mincer3<span class="sc">.</span>rsquared<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-141"><a href="#cb52-141" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'N'</span><span class="sc">:&lt;40}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(mincer1.nobs)<span class="sc">:,}{</span><span class="st">''</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(mincer2.nobs)<span class="sc">:,}{</span><span class="st">''</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="bu">int</span>(mincer3.nobs)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb52-142"><a href="#cb52-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-143"><a href="#cb52-143" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpretacao</span></span>
<span id="cb52-144"><a href="#cb52-144" aria-hidden="true" tabindex="-1"></a>coef_exp <span class="op">=</span> mincer2.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-145"><a href="#cb52-145" aria-hidden="true" tabindex="-1"></a>pval_exp <span class="op">=</span> mincer2.pvalues[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-146"><a href="#cb52-146" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Interpretacao (Mincer 2):"</span>)</span>
<span id="cb52-147"><a href="#cb52-147" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Coeficiente de exposicao: </span><span class="sc">{</span>coef_exp<span class="sc">:+.4f}</span><span class="ss"> </span><span class="sc">{</span>sig_stars(pval_exp)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-148"><a href="#cb52-148" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> coef_exp <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb52-149"><a href="#cb52-149" aria-hidden="true" tabindex="-1"></a>    pct_effect <span class="op">=</span> (np.exp(coef_exp) <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb52-150"><a href="#cb52-150" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Um aumento de 0.1 no score de exposicao esta associado a"</span>)</span>
<span id="cb52-151"><a href="#cb52-151" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>pct_effect<span class="op">/</span><span class="dv">10</span><span class="sc">:.1f}</span><span class="ss">% de aumento na renda, ceteris paribus."</span>)</span>
<span id="cb52-152"><a href="#cb52-152" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-153"><a href="#cb52-153" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Exposicao nao apresenta associacao significativa com renda"</span>)</span>
<span id="cb52-154"><a href="#cb52-154" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  apos controlar por ocupacao, setor e outras caracteristicas."</span>)</span>
<span id="cb52-155"><a href="#cb52-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-156"><a href="#cb52-156" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  ATENCAO: Esta analise e cross-sectional e nao permite"</span>)</span>
<span id="cb52-157"><a href="#cb52-157" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  inferencia causal. A correlacao entre exposicao e renda"</span>)</span>
<span id="cb52-158"><a href="#cb52-158" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  reflete sorting ocupacional, nao efeito causal da IA."</span>)</span>
<span id="cb52-159"><a href="#cb52-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-160"><a href="#cb52-160" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-161"><a href="#cb52-161" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.3 - Robustez: sensibilidade ao crosswalk</span></span>
<span id="cb52-162"><a href="#cb52-162" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-163"><a href="#cb52-163" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-164"><a href="#cb52-164" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ANALISE DE ROBUSTEZ: SENSIBILIDADE AO CROSSWALK"</span>)</span>
<span id="cb52-165"><a href="#cb52-165" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-166"><a href="#cb52-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-167"><a href="#cb52-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Amostra restrita: apenas matches 4-digit</span></span>
<span id="cb52-168"><a href="#cb52-168" aria-hidden="true" tabindex="-1"></a>df_4d <span class="op">=</span> df_score[df_score[<span class="st">'match_level'</span>] <span class="op">==</span> <span class="st">'4-digit'</span>].copy()</span>
<span id="cb52-169"><a href="#cb52-169" aria-hidden="true" tabindex="-1"></a>df_4d_renda <span class="op">=</span> df_4d[(df_4d[<span class="st">'tem_renda'</span>] <span class="op">==</span> <span class="dv">1</span>)].copy()</span>
<span id="cb52-170"><a href="#cb52-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-171"><a href="#cb52-171" aria-hidden="true" tabindex="-1"></a>mean_full, ci_lo_f, ci_hi_f <span class="op">=</span> weighted_ci(df_score[<span class="st">'exposure_score'</span>], df_score[<span class="st">'peso'</span>])</span>
<span id="cb52-172"><a href="#cb52-172" aria-hidden="true" tabindex="-1"></a>mean_4d, ci_lo_4, ci_hi_4 <span class="op">=</span> weighted_ci(df_4d[<span class="st">'exposure_score'</span>], df_4d[<span class="st">'peso'</span>])</span>
<span id="cb52-173"><a href="#cb52-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-174"><a href="#cb52-174" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Amostra completa:    N=</span><span class="sc">{</span><span class="bu">len</span>(df_score)<span class="sc">:,}</span><span class="ss"> | Media=</span><span class="sc">{</span>mean_full<span class="sc">:.4f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo_f<span class="sc">:.4f}</span><span class="ss">-</span><span class="sc">{</span>ci_hi_f<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb52-175"><a href="#cb52-175" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Apenas match 4-digit: N=</span><span class="sc">{</span><span class="bu">len</span>(df_4d)<span class="sc">:,}</span><span class="ss"> | Media=</span><span class="sc">{</span>mean_4d<span class="sc">:.4f}</span><span class="ss"> [IC: </span><span class="sc">{</span>ci_lo_4<span class="sc">:.4f}</span><span class="ss">-</span><span class="sc">{</span>ci_hi_4<span class="sc">:.4f}</span><span class="ss">]"</span>)</span>
<span id="cb52-176"><a href="#cb52-176" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Diferenca: </span><span class="sc">{</span>mean_full <span class="op">-</span> mean_4d<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-177"><a href="#cb52-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-178"><a href="#cb52-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-rodar Mincer 2 com amostra restrita</span></span>
<span id="cb52-179"><a href="#cb52-179" aria-hidden="true" tabindex="-1"></a>df_mincer_4d <span class="op">=</span> df_4d_renda[[<span class="st">'rendimento_habitual'</span>, <span class="st">'exposure_score'</span>, <span class="st">'sexo_texto'</span>,</span>
<span id="cb52-180"><a href="#cb52-180" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'raca_agregada'</span>, <span class="st">'idade'</span>, <span class="st">'nivel_instrucao'</span>, <span class="st">'formal'</span>,</span>
<span id="cb52-181"><a href="#cb52-181" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'regiao'</span>, <span class="st">'setor_agregado'</span>, <span class="st">'peso'</span>]].dropna().copy()</span>
<span id="cb52-182"><a href="#cb52-182" aria-hidden="true" tabindex="-1"></a>df_mincer_4d[<span class="st">'log_renda'</span>] <span class="op">=</span> np.log(df_mincer_4d[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb52-183"><a href="#cb52-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-184"><a href="#cb52-184" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">len</span>(df_mincer_4d) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb52-185"><a href="#cb52-185" aria-hidden="true" tabindex="-1"></a>    mincer_4d <span class="op">=</span> smf.wls(</span>
<span id="cb52-186"><a href="#cb52-186" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-187"><a href="#cb52-187" aria-hidden="true" tabindex="-1"></a>        <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal + C(regiao) + C(setor_agregado)'</span>,</span>
<span id="cb52-188"><a href="#cb52-188" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_mincer_4d, weights<span class="op">=</span>df_mincer_4d[<span class="st">'peso'</span>]</span>
<span id="cb52-189"><a href="#cb52-189" aria-hidden="true" tabindex="-1"></a>    ).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-190"><a href="#cb52-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-191"><a href="#cb52-191" aria-hidden="true" tabindex="-1"></a>    coef_full <span class="op">=</span> mincer2.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-192"><a href="#cb52-192" aria-hidden="true" tabindex="-1"></a>    coef_4d <span class="op">=</span> mincer_4d.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-193"><a href="#cb52-193" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  Coef. exposicao (amostra completa): </span><span class="sc">{</span>coef_full<span class="sc">:+.4f}{</span>sig_stars(mincer2.pvalues[<span class="st">'exposure_score'</span>])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-194"><a href="#cb52-194" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Coef. exposicao (apenas 4-digit):   </span><span class="sc">{</span>coef_4d<span class="sc">:+.4f}{</span>sig_stars(mincer_4d.pvalues[<span class="st">'exposure_score'</span>])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb52-195"><a href="#cb52-195" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Diferenca: </span><span class="sc">{</span><span class="bu">abs</span>(coef_full <span class="op">-</span> coef_4d)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-196"><a href="#cb52-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-197"><a href="#cb52-197" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">abs</span>(coef_full <span class="op">-</span> coef_4d) <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb52-198"><a href="#cb52-198" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  CONCLUSAO: Resultados robustos a exclusao dos matches 3-digit."</span>)</span>
<span id="cb52-199"><a href="#cb52-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-200"><a href="#cb52-200" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  ATENCAO: Sensibilidade detectada ao crosswalk. Reportar ambos."</span>)</span>
<span id="cb52-201"><a href="#cb52-201" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-202"><a href="#cb52-202" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  Amostra 4-digit insuficiente para regressao."</span>)</span>
<span id="cb52-203"><a href="#cb52-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-204"><a href="#cb52-204" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-205"><a href="#cb52-205" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.4 - Robustez 2: Winzorizacao da renda (P1-P99)</span></span>
<span id="cb52-206"><a href="#cb52-206" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-207"><a href="#cb52-207" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-208"><a href="#cb52-208" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ROBUSTEZ 2: WINZORIZACAO DA RENDA (P1-P99)"</span>)</span>
<span id="cb52-209"><a href="#cb52-209" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-210"><a href="#cb52-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-211"><a href="#cb52-211" aria-hidden="true" tabindex="-1"></a>p1 <span class="op">=</span> df_mincer[<span class="st">'rendimento_habitual'</span>].quantile(<span class="fl">0.01</span>)</span>
<span id="cb52-212"><a href="#cb52-212" aria-hidden="true" tabindex="-1"></a>p99 <span class="op">=</span> df_mincer[<span class="st">'rendimento_habitual'</span>].quantile(<span class="fl">0.99</span>)</span>
<span id="cb52-213"><a href="#cb52-213" aria-hidden="true" tabindex="-1"></a>df_winsor <span class="op">=</span> df_mincer.copy()</span>
<span id="cb52-214"><a href="#cb52-214" aria-hidden="true" tabindex="-1"></a>df_winsor[<span class="st">'renda_winsor'</span>] <span class="op">=</span> df_winsor[<span class="st">'rendimento_habitual'</span>].clip(lower<span class="op">=</span>p1, upper<span class="op">=</span>p99)</span>
<span id="cb52-215"><a href="#cb52-215" aria-hidden="true" tabindex="-1"></a>df_winsor[<span class="st">'log_renda_w'</span>] <span class="op">=</span> np.log(df_winsor[<span class="st">'renda_winsor'</span>].clip(lower<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb52-216"><a href="#cb52-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-217"><a href="#cb52-217" aria-hidden="true" tabindex="-1"></a>mincer_winsor <span class="op">=</span> smf.wls(</span>
<span id="cb52-218"><a href="#cb52-218" aria-hidden="true" tabindex="-1"></a>    <span class="st">'log_renda_w ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-219"><a href="#cb52-219" aria-hidden="true" tabindex="-1"></a>    <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal + C(regiao) + C(setor_agregado)'</span>,</span>
<span id="cb52-220"><a href="#cb52-220" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_winsor, weights<span class="op">=</span>df_winsor[<span class="st">'peso'</span>]</span>
<span id="cb52-221"><a href="#cb52-221" aria-hidden="true" tabindex="-1"></a>).fit(cov_type<span class="op">=</span><span class="st">'HC1'</span>)</span>
<span id="cb52-222"><a href="#cb52-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-223"><a href="#cb52-223" aria-hidden="true" tabindex="-1"></a>coef_orig <span class="op">=</span> mincer2.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-224"><a href="#cb52-224" aria-hidden="true" tabindex="-1"></a>coef_winsor <span class="op">=</span> mincer_winsor.params[<span class="st">'exposure_score'</span>]</span>
<span id="cb52-225"><a href="#cb52-225" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Coef. exposicao (original):     </span><span class="sc">{</span>coef_orig<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-226"><a href="#cb52-226" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Coef. exposicao (winsorizado):  </span><span class="sc">{</span>coef_winsor<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-227"><a href="#cb52-227" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Diferenca: </span><span class="sc">{</span><span class="bu">abs</span>(coef_orig <span class="op">-</span> coef_winsor)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-228"><a href="#cb52-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-229"><a href="#cb52-229" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">abs</span>(coef_orig <span class="op">-</span> coef_winsor) <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb52-230"><a href="#cb52-230" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  CONCLUSAO: Resultados robustos a winzorizacao da renda."</span>)</span>
<span id="cb52-231"><a href="#cb52-231" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-232"><a href="#cb52-232" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  ATENCAO: Sensibilidade detectada. Reportar ambos os resultados."</span>)</span>
<span id="cb52-233"><a href="#cb52-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-234"><a href="#cb52-234" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-235"><a href="#cb52-235" aria-hidden="true" tabindex="-1"></a><span class="co"># 8.5 - Robustez 3: Cluster por UPA (se disponivel)</span></span>
<span id="cb52-236"><a href="#cb52-236" aria-hidden="true" tabindex="-1"></a><span class="co"># ======================================================================</span></span>
<span id="cb52-237"><a href="#cb52-237" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-238"><a href="#cb52-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ROBUSTEZ 3: ERROS-PADRAO CLUSTERIZADOS POR UPA"</span>)</span>
<span id="cb52-239"><a href="#cb52-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb52-240"><a href="#cb52-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-241"><a href="#cb52-241" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'upa'</span> <span class="kw">in</span> df_mincer.columns <span class="kw">or</span> <span class="st">'UPA'</span> <span class="kw">in</span> df_mincer.columns:</span>
<span id="cb52-242"><a href="#cb52-242" aria-hidden="true" tabindex="-1"></a>    upa_col <span class="op">=</span> <span class="st">'upa'</span> <span class="cf">if</span> <span class="st">'upa'</span> <span class="kw">in</span> df_mincer.columns <span class="cf">else</span> <span class="st">'UPA'</span></span>
<span id="cb52-243"><a href="#cb52-243" aria-hidden="true" tabindex="-1"></a>    mincer_cluster <span class="op">=</span> smf.wls(</span>
<span id="cb52-244"><a href="#cb52-244" aria-hidden="true" tabindex="-1"></a>        <span class="st">'log_renda ~ exposure_score + C(sexo_texto) + C(raca_agregada) + '</span></span>
<span id="cb52-245"><a href="#cb52-245" aria-hidden="true" tabindex="-1"></a>        <span class="st">'idade + I(idade**2) + C(nivel_instrucao) + formal + C(regiao) + C(setor_agregado)'</span>,</span>
<span id="cb52-246"><a href="#cb52-246" aria-hidden="true" tabindex="-1"></a>        data<span class="op">=</span>df_mincer, weights<span class="op">=</span>df_mincer[<span class="st">'peso'</span>]</span>
<span id="cb52-247"><a href="#cb52-247" aria-hidden="true" tabindex="-1"></a>    ).fit(cov_type<span class="op">=</span><span class="st">'cluster'</span>, cov_kwds<span class="op">=</span>{<span class="st">'groups'</span>: df_mincer[upa_col]})</span>
<span id="cb52-248"><a href="#cb52-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-249"><a href="#cb52-249" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">  SE (HC1):    </span><span class="sc">{</span>mincer2<span class="sc">.</span>bse[<span class="st">'exposure_score'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-250"><a href="#cb52-250" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  SE (Cluster): </span><span class="sc">{</span>mincer_cluster<span class="sc">.</span>bse[<span class="st">'exposure_score'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb52-251"><a href="#cb52-251" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Razao: </span><span class="sc">{</span>mincer_cluster<span class="sc">.</span>bse[<span class="st">'exposure_score'</span>]<span class="op">/</span>mincer2<span class="sc">.</span>bse[<span class="st">'exposure_score'</span>]<span class="sc">:.2f}</span><span class="ss">x"</span>)</span>
<span id="cb52-252"><a href="#cb52-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-253"><a href="#cb52-253" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> mincer_cluster.bse[<span class="st">'exposure_score'</span>] <span class="op">&gt;</span> mincer2.bse[<span class="st">'exposure_score'</span>] <span class="op">*</span> <span class="fl">1.5</span>:</span>
<span id="cb52-254"><a href="#cb52-254" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  ATENCAO: SEs clusterizados substancialmente maiores."</span>)</span>
<span id="cb52-255"><a href="#cb52-255" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"  HC1 subestima incerteza. Reportar ambos."</span>)</span>
<span id="cb52-256"><a href="#cb52-256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb52-257"><a href="#cb52-257" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  SEs clusterizados similares aos HC1. Resultados robustos."</span>)</span>
<span id="cb52-258"><a href="#cb52-258" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-259"><a href="#cb52-259" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">  </span><span class="ch">\u26a0</span><span class="st"> Variavel UPA nao encontrada no dataframe."</span>)</span>
<span id="cb52-260"><a href="#cb52-260" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  Adicionar na etapa 1a (preparacao de dados) para permitir"</span>)</span>
<span id="cb52-261"><a href="#cb52-261" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  clusterizacao dos erros-padrao."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
REGRESSAO WLS: DETERMINANTES DA EXPOSICAO A IA
======================================================================
Amostra para regressao: 206,230 observacoes

Variavel                       M1 (Demog.)               M2 (+Ocup.)               M3 (Completo)            
---------------------------------------------------------------------------------------------------------
Mulher (ref: Homem)            +0.0215***                -0.0098***                +0.0008                  
Branca (ref: Negra)            +0.0207***                +0.0114***                +0.0076***               
Idade                          -0.0056***                -0.0015***                -0.0010***               
Formal                         --                        --                        +0.0024***               
---------------------------------------------------------------------------------------------------------
R²                             0.2255                     0.6832                     0.7430
N                              206,230                     206,230                     206,230

Significancia: * p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001

--- Modelo completo (M3) - Resumo ---
==================================================================================================================
                                                     coef    std err          z      P&gt;|z|      [0.025      0.975]
------------------------------------------------------------------------------------------------------------------
Intercept                                          0.1863      0.003     56.111      0.000       0.180       0.193
C(sexo_texto, Treatment("Homem"))[T.Mulher]        0.0008      0.001      1.276      0.202      -0.000       0.002
C(raca_agregada, Treatment("Negra"))[T.Branca]     0.0076      0.001     14.084      0.000       0.007       0.009
C(raca_agregada, Treatment("Negra"))[T.Outras]     0.0081      0.003      3.207      0.001       0.003       0.013
C(nivel_instrucao)[T.2]                           -0.0012      0.001     -0.803      0.422      -0.004       0.002
C(nivel_instrucao)[T.3]                            0.0006      0.002      0.361      0.718      -0.003       0.004
C(nivel_instrucao)[T.4]                           -0.0001      0.002     -0.072      0.943      -0.003       0.003
C(nivel_instrucao)[T.5]                            0.0083      0.002      5.488      0.000       0.005       0.011
C(nivel_instrucao)[T.6]                            0.0236      0.002     12.571      0.000       0.020       0.027
C(nivel_instrucao)[T.7]                            0.0272      0.002     15.756      0.000       0.024       0.031
C(grande_grupo)[T.Apoio administrativo]            0.3551      0.001    248.030      0.000       0.352       0.358
C(grande_grupo)[T.Dirigentes e gerentes]           0.1805      0.001    162.184      0.000       0.178       0.183
C(grande_grupo)[T.Indústria qualificada]          -0.0281      0.001    -41.772      0.000      -0.029      -0.027
C(grande_grupo)[T.Ocupações elementares]          -0.0461      0.001    -72.707      0.000      -0.047      -0.045
C(grande_grupo)[T.Operadores de máquinas]          0.0277      0.001     32.260      0.000       0.026       0.029
C(grande_grupo)[T.Profissionais das ciências]      0.1687      0.002    110.685      0.000       0.166       0.172
C(grande_grupo)[T.Serviços e vendedores]           0.0995      0.001     93.891      0.000       0.097       0.102
C(grande_grupo)[T.Técnicos nível médio]            0.1545      0.001    121.685      0.000       0.152       0.157
C(regiao)[T.Nordeste]                              0.0015      0.001      2.052      0.040    6.63e-05       0.003
C(regiao)[T.Norte]                                -0.0001      0.001     -0.123      0.902      -0.002       0.002
C(regiao)[T.Sudeste]                              -0.0003      0.001     -0.381      0.703      -0.002       0.001
C(regiao)[T.Sul]                                  -0.0016      0.001     -2.034      0.042      -0.003   -5.74e-05
C(setor_agregado)[T.Alojamento e Alimentação]      0.0044      0.002      2.623      0.009       0.001       0.008
C(setor_agregado)[T.Artes e Cultura]              -0.0355      0.003    -13.931      0.000      -0.041      -0.031
C(setor_agregado)[T.Atividades Imobiliárias]       0.0219      0.003      7.121      0.000       0.016       0.028
C(setor_agregado)[T.Comércio]                      0.0337      0.002     19.883      0.000       0.030       0.037
C(setor_agregado)[T.Construção]                   -0.0300      0.001    -21.076      0.000      -0.033      -0.027
C(setor_agregado)[T.Educação]                     -0.0599      0.001    -40.005      0.000      -0.063      -0.057
C(setor_agregado)[T.Finanças e Seguros]            0.1069      0.003     37.617      0.000       0.101       0.112
C(setor_agregado)[T.Ind. Transformação]           -0.0025      0.001     -1.759      0.079      -0.005       0.000
C(setor_agregado)[T.Informação e Comunicação]      0.0863      0.002     39.678      0.000       0.082       0.091
C(setor_agregado)[T.Outros Serviços]               0.0461      0.001     31.649      0.000       0.043       0.049
C(setor_agregado)[T.Saúde]                        -0.0662      0.002    -40.158      0.000      -0.069      -0.063
C(setor_agregado)[T.Serviços Administrativos]     -0.0012      0.002     -0.719      0.472      -0.004       0.002
C(setor_agregado)[T.Serviços Domésticos]          -0.0069      0.001     -4.990      0.000      -0.010      -0.004
C(setor_agregado)[T.Serviços Profissionais]        0.0335      0.002     18.265      0.000       0.030       0.037
C(setor_agregado)[T.Transporte]                    0.0282      0.002     16.360      0.000       0.025       0.032
C(setor_agregado)[T.Utilidades]                    0.0152      0.003      4.819      0.000       0.009       0.021
idade                                             -0.0010      0.000     -7.505      0.000      -0.001      -0.001
I(idade ** 2)                                   1.266e-05   1.56e-06      8.136      0.000    9.61e-06    1.57e-05
formal                                             0.0024      0.001      4.422      0.000       0.001       0.003
==================================================================================================================

======================================================================
EQUACAO DE MINCER AUMENTADA: log(renda) ~ exposicao + controles
======================================================================
Amostra Mincer: 202,471 observacoes

Variavel                                 Mincer 1             Mincer 2             Mincer 3            
----------------------------------------------------------------------------------------------------
Exposicao                                +0.5248***           +0.3927***           +3.6870***          
Exposicao²                               --                   --                   -4.1069***          
Exposicao x Mulher                       --                   --                   -0.0581             
Exposicao x Formal                       --                   --                   -0.8083***          
Mulher                                   -0.3688***           -0.3248***           -0.2784***          
Formal                                   +0.2030***           +0.1667***           +0.3952***          
----------------------------------------------------------------------------------------------------
R²                                       0.3425                0.4078                0.4222
N                                        202,471                202,471                202,471

Interpretacao (Mincer 2):
  Coeficiente de exposicao: +0.3927 ***
  Um aumento de 0.1 no score de exposicao esta associado a
  4.8% de aumento na renda, ceteris paribus.

  ATENCAO: Esta analise e cross-sectional e nao permite
  inferencia causal. A correlacao entre exposicao e renda
  reflete sorting ocupacional, nao efeito causal da IA.

======================================================================
ANALISE DE ROBUSTEZ: SENSIBILIDADE AO CROSSWALK
======================================================================

  Amostra completa:    N=206,230 | Media=0.2783 [IC: 0.2782-0.2783]
  Apenas match 4-digit: N=203,617 | Media=0.2781 [IC: 0.2781-0.2782]
  Diferenca: +0.0001

  Coef. exposicao (amostra completa): +0.3927***
  Coef. exposicao (apenas 4-digit):   +0.3970***
  Diferenca: 0.0043

  CONCLUSAO: Resultados robustos a exclusao dos matches 3-digit.

======================================================================
ROBUSTEZ 2: WINZORIZACAO DA RENDA (P1-P99)
======================================================================
  Coef. exposicao (original):     +0.3927
  Coef. exposicao (winsorizado):  +0.3842
  Diferenca: 0.0085

  CONCLUSAO: Resultados robustos a winzorizacao da renda.

======================================================================
ROBUSTEZ 3: ERROS-PADRAO CLUSTERIZADOS POR UPA
======================================================================

  ⚠ Variavel UPA nao encontrada no dataframe.
  Adicionar na etapa 1a (preparacao de dados) para permitir
  clusterizacao dos erros-padrao.</code></pre>
</div>
</div>
</section>
<section id="sintese-e-conclusoes" class="level3" data-number="1.25">
<h3 data-number="1.25" class="anchored" data-anchor-id="sintese-e-conclusoes"><span class="header-section-number">1.25</span> 9. Sintese e conclusoes</h3>
<p>Resumo dos principais achados, comparacao com a literatura e limitacoes.</p>
<blockquote class="blockquote">
<p><strong>Limitações adicionais identificadas:</strong> 7. Crosswalk COD→ISCO-08 introduz erro de medida; o índice ILO foi construído para ISCO-08 e a conversão pode gerar mismatches (teste de robustez com matches 4-digit mitiga parcialmente) 8. O índice ILO reflete a capacidade tecnológica de 2024/2025; a rápida evolução da IA generativa pode torná-lo defasado 9. Erros-padrão tratam amostra como SRS; valores reais podem ser maiores com desenho amostral complexo</p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Posicionamento do Brasil no contexto global (WP140):</strong> O Brasil se posiciona como caso típico de país de renda média-alta: exposição média (0.278) ligeiramente inferior à média global (0.30) e consistente com o grupo upper-middle-income (~0.29). A proporção de trabalhadores em alta exposição (10.1%) está abaixo de países de alta renda (~20%) mas acima de países de baixa renda (~5%). As extensões originais desta dissertação — raça, formalidade, análise regional e equação de Mincer — preenchem lacunas deixadas pelo WP140 para o contexto de países em desenvolvimento.</p>
</blockquote>
<div id="04clh57wbda4" class="cell" data-execution_count="79">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Etapa 1b.9 - Sintese e conclusoes</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SINTESE DOS PRINCIPAIS ACHADOS"</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"""</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="ss">ETAPA 1 - Analise Descritiva da Exposicao a IA Generativa no Brasil</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="ss">=====================================================================</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="ss">Dados: PNADc Q3/</span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss"> | </span><span class="sc">{</span><span class="bu">len</span>(df)<span class="sc">:,}</span><span class="ss"> observacoes | </span><span class="sc">{</span>df[<span class="st">'peso'</span>]<span class="sc">.</span><span class="bu">sum</span>()<span class="op">/</span><span class="fl">1e6</span><span class="sc">:.1f}</span><span class="ss"> milhoes de trabalhadores</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="ss">Indice: ILO WP140 (Gmyrek, Berg &amp; Cappelli, 2025) | 427 ocupacoes ISCO-08</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="ss">1. PERFIL DA EXPOSICAO</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Exposicao media: </span><span class="sc">{</span>mean_geral<span class="sc">:.3f}</span><span class="ss"> [IC 95%: </span><span class="sc">{</span>ci_lo_geral<span class="sc">:.3f}</span><span class="ss">-</span><span class="sc">{</span>ci_hi_geral<span class="sc">:.3f}</span><span class="ss">]</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Inferior a media global (0.30), refletindo estrutura ocupacional brasileira</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span><span class="sc">{</span>pct_alta<span class="sc">:.1f}</span><span class="ss">% da forca de trabalho em alta exposicao (Gradientes 3-4)</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Gini da exposicao: </span><span class="sc">{</span>gini_exp<span class="sc">:.3f}</span><span class="ss"> (desigualdade moderada)</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="ss">2. DESIGUALDADE E RENDA</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Trabalhadores mais expostos ganham mais (razao Q5/Q1 = </span><span class="sc">{</span>renda_q5<span class="op">/</span>renda_q1<span class="sc">:.2f}</span><span class="ss">x)</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="ss">   - ATENCAO: relacao nao-monotonica (Q4 &gt; Q5 em renda)</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Relacao exposicao-renda nao-linear (LOWESS revela curvatura)</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Indice de concentracao: </span><span class="sc">{</span>conc_index<span class="sc">:+.4f}</span><span class="ss"> (exposicao concentrada nos mais ricos)</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Regressao quantilica sugere efeito heterogeneo ao longo da distribuicao</span></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="ss">3. GENERO E RACA</span></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Mulheres mais expostas que homens (</span><span class="sc">{</span>gap_sexo<span class="sc">:+.3f}</span><span class="ss">, p&lt;0.001)</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Brancos mais expostos que negros (</span><span class="sc">{</span>gap_raca<span class="sc">:+.3f}</span><span class="ss">, p&lt;0.001)</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Oaxaca-Blinder: gaps explicados principalmente por segregacao ocupacional</span></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a><span class="ss">4. FORMALIDADE</span></span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Formais mais expostos que informais (gap significativo)</span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Interacao exposicao x formalidade: retorno MENOR para formais</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Informais de alta exposicao capturam mais retorno (profissionais liberais)</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a><span class="ss">5. SETOR E OCUPACAO</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Setores criticos: Financas, TI, Servicos Profissionais</span></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Apoio administrativo e mais exposto dos grandes grupos</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a><span class="ss">   - ANOVA confirma: setor e ocupacao explicam maior parte da variancia</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a><span class="ss">6. REGIAO</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Sudeste lidera, Norte menor exposicao</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Variacao regional modesta (R² baixo na ANOVA por regiao)</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a><span class="ss">7. ANALISE MULTIVARIADA</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="ss">   - WLS: sexo, escolaridade e ocupacao sao os principais preditores</span></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Mincer: exposicao associada positivamente a renda (ceteris paribus)</span></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="ss">   - Robustez: resultados estaveis excluindo matches 3-digit</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="ss">LIMITACOES</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a><span class="ss">----------</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="ss">1. Analise cross-sectional (Q3/</span><span class="sc">{</span>PNAD_ANO<span class="sc">}</span><span class="ss">) - nao permite inferencia causal</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="ss">2. Indice global (OIT) aplicado ao Brasil - pode nao capturar especificidades locais</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a><span class="ss">3. Exposicao != impacto - mede potencial, nao efeito realizado</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a><span class="ss">4. Erros-padrao podem ser subestimados (amostra tratada como SRS)</span></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a><span class="ss">5. 0.8% das observacoes sem match no crosswalk COD-ISCO08</span></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a><span class="ss">6. Variavel de renda ausente para ~1.1 milhao de trabalhadores</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a><span class="ss">7. Crosswalk COD-&gt;ISCO-08 introduz erro de medida; teste com matches 4-digit mitiga parcialmente</span></span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a><span class="ss">8. Indice ILO reflete capacidade tecnologica de 2024/2025; pode estar defasado</span></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a><span class="ss">9. Erros-padrao tratam amostra como SRS; valores reais podem ser maiores</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a><span class="ss">"""</span>)</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"FIM DA ETAPA 1b - ANALISE DESCRITIVA"</span>)</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>======================================================================
SINTESE DOS PRINCIPAIS ACHADOS
======================================================================

ETAPA 1 - Analise Descritiva da Exposicao a IA Generativa no Brasil
=====================================================================
Dados: PNADc Q3/2025 | 207,901 observacoes | 97.8 milhoes de trabalhadores
Indice: ILO WP140 (Gmyrek, Berg &amp; Cappelli, 2025) | 427 ocupacoes ISCO-08

1. PERFIL DA EXPOSICAO
   - Exposicao media: 0.278 [IC 95%: 0.278-0.278]
   - Inferior a media global (0.30), refletindo estrutura ocupacional brasileira
   - 10.1% da forca de trabalho em alta exposicao (Gradientes 3-4)
   - Gini da exposicao: 0.295 (desigualdade moderada)

2. DESIGUALDADE E RENDA
   - Trabalhadores mais expostos ganham mais (razao Q5/Q1 = 2.23x)
   - ATENCAO: relacao nao-monotonica (Q4 &gt; Q5 em renda)
   - Relacao exposicao-renda nao-linear (LOWESS revela curvatura)
   - Indice de concentracao: +0.0810 (exposicao concentrada nos mais ricos)
   - Regressao quantilica sugere efeito heterogeneo ao longo da distribuicao

3. GENERO E RACA
   - Mulheres mais expostas que homens (+0.044, p&lt;0.001)
   - Brancos mais expostos que negros (+0.048, p&lt;0.001)
   - Oaxaca-Blinder: gaps explicados principalmente por segregacao ocupacional

4. FORMALIDADE
   - Formais mais expostos que informais (gap significativo)
   - Interacao exposicao x formalidade: retorno MENOR para formais
   - Informais de alta exposicao capturam mais retorno (profissionais liberais)

5. SETOR E OCUPACAO
   - Setores criticos: Financas, TI, Servicos Profissionais
   - Apoio administrativo e mais exposto dos grandes grupos
   - ANOVA confirma: setor e ocupacao explicam maior parte da variancia

6. REGIAO
   - Sudeste lidera, Norte menor exposicao
   - Variacao regional modesta (R² baixo na ANOVA por regiao)

7. ANALISE MULTIVARIADA
   - WLS: sexo, escolaridade e ocupacao sao os principais preditores
   - Mincer: exposicao associada positivamente a renda (ceteris paribus)
   - Robustez: resultados estaveis excluindo matches 3-digit

LIMITACOES
----------
1. Analise cross-sectional (Q3/2025) - nao permite inferencia causal
2. Indice global (OIT) aplicado ao Brasil - pode nao capturar especificidades locais
3. Exposicao != impacto - mede potencial, nao efeito realizado
4. Erros-padrao podem ser subestimados (amostra tratada como SRS)
5. 0.8% das observacoes sem match no crosswalk COD-ISCO08
6. Variavel de renda ausente para ~1.1 milhao de trabalhadores
7. Crosswalk COD-&gt;ISCO-08 introduz erro de medida; teste com matches 4-digit mitiga parcialmente
8. Indice ILO reflete capacidade tecnologica de 2024/2025; pode estar defasado
9. Erros-padrao tratam amostra como SRS; valores reais podem ser maiores

======================================================================
FIM DA ETAPA 1b - ANALISE DESCRITIVA
======================================================================</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>